functional_requirements:
  - id: FR-0000
    description: |
      The system shall provide a password‑less authentication flow that
      delivers a one‑time magic link via email or SMS, or a biometric
      prompt on supported devices, allowing the patient to log in with a
      single click or biometric confirmation.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given a registered patient email or phone number, when the patient requests login, then the system must send a magic link or biometric prompt within 30 seconds.
      - Given the magic link is clicked, when the link is within its validity period, then the patient must be authenticated and redirected to the appointment dashboard.
      - Given the magic link is expired or invalid, when the patient attempts to use it, then the system must display a clear error message and offer to resend the link.
    edge_cases:
      - The patient clicks the magic link after the 15‑minute expiry window.
      - The patient receives multiple simultaneous magic links due to repeated requests.
      - The patient attempts to use the link from a different device or browser.
    dependencies:
      - FR-0008

  - id: FR-0001
    description: |
      The system shall enforce multi‑factor authentication (MFA) by sending a one‑time code via SMS or email, which the patient must enter within 5 minutes to complete login.
    priority: High
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given the patient has completed the magic link step, when MFA is required, then the system must send a 6‑digit code within 30 seconds.
      - Given the patient enters the correct MFA code, when the code is verified, then the patient is fully authenticated and redirected to the dashboard.
      - Given the patient enters an incorrect MFA code three times, when the third attempt fails, then the system must lock the account for 15 minutes and display an error message.
    edge_cases:
      - The patient receives the MFA code but loses network connectivity before entering it.
      - The patient enters the MFA code after the 5‑minute expiry window.
      - The patient receives multiple MFA codes due to repeated requests.
    dependencies:
      - FR-0000

  - id: FR-0002
    description: |
      The system shall integrate with the existing OAuth 2.0 provider to obtain an access token, store it securely, and establish a user session upon successful authentication.
    priority: High
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given the patient has authenticated via magic link or biometric, when the system requests an OAuth 2.0 token, then the provider must return a short‑lived access token within 1 second.
      - Given the access token is received, when the system validates it, then a secure session cookie must be issued with a 30‑minute idle timeout.
    edge_cases:
      - The OAuth provider responds with an error (e.g., invalid_grant).
      - The token is expired or revoked before the session is established.
      - The network between the portal and OAuth provider is intermittent.
    dependencies:
      - FR-0000

  - id: FR-0003
    description: |
      The system shall grant the patient immediate access to their appointment data after successful authentication, without requiring additional navigation steps.
    priority: Medium
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given the patient is authenticated, when the system redirects to the dashboard, then the appointment list must be rendered and fully interactive within 1 second.
    edge_cases:
      - The appointment data service is temporarily unavailable.
      - The patient has no scheduled appointments; the system must display an appropriate message.
    dependencies:
      - FR-0000
      - FR-0002

  - id: FR-0004
    description: |
      The system shall maintain an immutable audit log for all login attempts, magic link generation, MFA steps, and subsequent data access events, retaining logs for 24 months.
    priority: High
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given any login event, when it occurs, then an audit record containing timestamp, user ID, event type, IP address, and outcome must be written to the audit store within 2 seconds.
      - Given the audit store, when queried for a specific user’s login history, then the system must return all events in chronological order within 5 seconds.
    edge_cases:
      - The audit store experiences a write failure; the system must retry and flag the incident.
      - An attacker attempts to tamper with log entries; the system must detect and prevent tampering.
    dependencies:
      - FR-0000
      - FR-0001
      - FR-0002

  - id: FR-0005
    description: |
      The system shall provide clear, user‑friendly error messages for all failure scenarios encountered during login, including expired links, invalid credentials, MFA failures, and service outages.
    priority: Medium
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given any error during the login flow, when the error occurs, then the system must display a concise message that indicates the issue and suggests next steps.
    edge_cases:
      - The error message contains sensitive information (e.g., IP address).
      - The error message is displayed in a language not supported by the user’s locale.
    dependencies:
      - FR-0000
      - FR-0001

  - id: FR-0006
    description: |
      The system shall enforce rate limiting on login attempts, allowing a maximum of 5 failed attempts per user per 15‑minute window, after which the account is locked for 15 minutes.
    priority: High
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given a user makes 5 consecutive failed login attempts, when the sixth attempt occurs, then the system must lock the account and return an error indicating lockout duration.
      - Given the lockout period expires, when the user attempts to log in again, then the system must allow a new attempt.
    edge_cases:
      - An attacker uses multiple IP addresses to bypass the limit.
      - The user’s legitimate login attempt is mistakenly counted due to a transient failure.
    dependencies:
      - FR-0000

  - id: FR-0007
    description: |
      The system shall enforce a session idle timeout of 30 minutes, after which the user must re‑authenticate to continue accessing appointment data.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given a user is idle for 30 minutes, when the next request is made, then the system must redirect to the login page.
      - Given a user logs out explicitly, when the session cookie is deleted, then subsequent requests must require re‑authentication.
    edge_cases:
      - The user’s device time is set incorrectly, causing premature session expiration.
      - The user’s session is hijacked; the system must detect and invalidate it.
    dependencies:
      - FR-0000
      - FR-0002

  - id: FR-0008
    description: |
      The system shall integrate with a compliant email and SMS gateway to deliver magic links and MFA codes, ensuring delivery within 30 seconds.
    priority: High
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given the system requests delivery of a magic link or MFA code, when the gateway responds, then the message must be delivered to the patient’s email or phone within 30 seconds.
      - Given the gateway reports a delivery failure, when the system receives the failure notification, then it must retry once and inform the user of the delay.
    edge_cases:
      - The patient’s email address is in a temporary mailbox that rejects messages.
      - The patient’s phone number is unreachable due to network outages.
    dependencies: []


  - id: FR-0009
    description: The system must display real‑time appointment slots for a selected provider and specialty, filtered by date and time window.
    priority: Critical
    related_usecase:
      - USE_CASE-0002
    acceptance_criteria:
      - Given a patient selects a provider, specialty, date, and time window, when the availability screen loads, then the system displays all slots that are currently available and match the filtering criteria.
      - Given the scheduling API returns a 200 response, when the client renders the slots, then the UI shows the slot list within 2 seconds of receiving the data.
    edge_cases:
      - The scheduling API returns no available slots – the UI must display a “No slots available” message.
      - The scheduling API returns an error (5xx) – the UI must show an error banner and retry every 30 seconds.
      - The provider ID is invalid – the UI must display “Provider not found” and prompt the user to select another provider.
    dependencies: []

  - id: FR-0010
    description: For each slot displayed, the system must show the provider’s profile, credentials, and office location.
    priority: High
    related_usecase:
      - USE_CASE-0002
    acceptance_criteria:
      - Given a slot is displayed, when the user hovers or taps the slot, then the provider’s profile picture, name, specialty, and office address are visible.
    edge_cases:
      - Provider profile image fails to load – a default avatar is shown.
      - Provider credentials are missing – the system displays “Credentials not available”.
    dependencies:
      - FR-0009

  - id: FR-0011
    description: The system must allow a patient to select an available slot to initiate a booking or appointment request.
    priority: Critical
    related_usecase:
      - USE_CASE-0002
    acceptance_criteria:
      - Given a patient selects a slot, when the “Book” action is triggered, then the system navigates to a confirmation screen with the selected slot details.
    edge_cases:
      - The slot is double‑booked between selection and confirmation – the system must detect the conflict, notify the patient, and refresh the slot list.
      - The patient attempts to book a slot that has just expired – the system must reject the request and prompt to select another slot.
    dependencies:
      - FR-0009

  - id: FR-0012
    description: The system must present a confirmation view that displays the selected slot details and includes a secure “Book” button to finalize the appointment.
    priority: High
    related_usecase:
      - USE_CASE-0002
    acceptance_criteria:
      - Given the patient has selected a slot, when the confirmation screen loads, then the slot date, time, provider, and location are shown and a “Book” button is enabled.
      - When the patient taps the “Book” button, the system submits a booking request to the scheduling engine and displays a success or failure message.
    edge_cases:
      - The booking request fails due to network timeout – the UI shows a retry option.
      - The booking request is rejected by the scheduling engine (e.g., slot already taken) – the system displays an error and offers alternative slots.
    dependencies:
      - FR-0011

  - id: FR-0013
    description: The system must auto‑refresh slot data every 5 seconds or provide a pull‑to‑refresh gesture to fetch the latest availability.
    priority: High
    related_usecase:
      - USE_CASE-0002
    acceptance_criteria:
      - Given the availability screen is open, when 5 seconds elapse, then the client automatically fetches the latest slot data and updates the UI.
      - When the user performs a pull‑to‑refresh gesture, the client immediately fetches fresh data and updates the UI.
    edge_cases:
      - The client loses network connectivity during auto‑refresh – the UI indicates “Offline” and pauses auto‑refresh until connectivity is restored.
      - The scheduling API throttles requests – the client implements exponential back‑off and retries after the throttle window.
    dependencies:
      - FR-0009

  - id: FR-0014
    description: The system must support displaying slots in the patient’s local time zone and optionally convert to provider’s time zone for traveling patients.
    priority: Medium
    related_usecase:
      - USE_CASE-0002
    acceptance_criteria:
      - Given a patient in a different time zone selects a provider in another time zone, when the slots are displayed, then times are converted to the patient’s local time zone.
      - When the patient opts to view provider time zone, the UI shows both time zones side by side.
    edge_cases:
      - Daylight‑saving time change occurs between the client’s time zone and provider’s time zone – the system correctly adjusts slot times.
      - The patient’s device time zone is incorrectly set – the system provides a “Sync time” prompt.
    dependencies:
      - FR-0009

  - id: FR-0015
    description: |
      Provide a patient‑facing UI that displays all upcoming appointments and allows the
      patient to select one for rescheduling. The UI must present a calendar or date/time
      picker for choosing a new slot.
    priority: Critical
    related_usecase:
      - USER_STORY-0004
    acceptance_criteria:
      - "Given a logged‑in patient, when they navigate to **My Appointments**, then they see a list of all upcoming appointments."
      - "Given a patient selects an appointment to reschedule, when they click **Reschedule**, then a calendar view with available slots is displayed."
    edge_cases:
      - "No upcoming appointments: the UI should display a friendly message such as *‘You have no upcoming appointments’*."
      - "Patient tries to reschedule an appointment that is already cancelled or in the past: the system should disable the reschedule option."
    dependencies: []

  - id: FR-0016
    description: |
      Perform a real‑time availability check for the selected new slot before confirming the reschedule. The system must query the provider’s schedule and any external calendars to ensure the slot is free.
    priority: Critical
    related_usecase:
      - USER_STORY-0004
    acceptance_criteria:
      - "Given a patient selects a new slot, when they submit the request, then the system verifies the slot is available and proceeds."
      - "Given a slot is already booked, when the patient submits, then the system displays an error and prompts for a different time."
    edge_cases:
      - "The slot becomes unavailable after the patient selects it but before submission due to another booking."
      - "Time zone differences cause a slot to appear available locally but not globally."
    dependencies: []

  - id: FR-0017
    description: |
      Enforce the reschedule window by preventing changes to an appointment less than 24 hours before its scheduled time. The system must compare the new requested time against the original appointment timestamp.
    priority: Critical
    related_usecase:
      - USER_STORY-0004
    acceptance_criteria:
      - "Given a patient selects a new date/time less than 24 hours before the original appointment, when they submit, then the system rejects the request with a clear message."
      - "Given a patient selects a new date/time exactly 24 hours before, when they submit, then the system accepts the request."
    edge_cases:
      - "Daylight Saving Time transition affecting the 24‑hour calculation."
      - "Appointment scheduled at 23:59:59 local time; new time is 00:00:00 next day."
    dependencies: []

  - id: FR-0018
    description: |
      Detect and prevent scheduling conflicts by ensuring the provider does not have overlapping appointments. The system must check the provider’s calendar for any appointment that would clash with the new slot.
    priority: Critical
    related_usecase:
      - USER_STORY-0004
    acceptance_criteria:
      - "Given a patient selects a slot that overlaps with another appointment for the same provider, when they submit, then the system rejects the request."
      - "Given the slot is free, the system accepts the reschedule."
    edge_cases:
      - "Provider has multiple appointments back‑to‑back; a new slot that starts at the end of one and overlaps the next should be flagged."
      - "Recurring appointments: the system must check all occurrences."
    dependencies: []

  - id: FR-0019
    description: |
      Automatically notify the patient and the provider of the updated appointment details via email, SMS, and/or portal notification immediately after a successful reschedule.
    priority: Critical
    related_usecase:
      - USER_STORY-0004
    acceptance_criteria:
      - "Given a reschedule is confirmed, when the system processes the update, then an email, SMS, and portal notification are sent to both patient and provider."
      - "Given the notification channel is unavailable (e.g., email server down), the system logs the failure and retries within 5 minutes."
    edge_cases:
      - "Patient’s email address is invalid; the system should still send SMS if available."
      - "Provider is on a different time zone; timestamps in notifications must be converted appropriately."
    dependencies: []

  - id: FR-0020
    description: |
      Maintain an audit trail that logs every reschedule attempt, including old time, new time, user ID, timestamp, and outcome (success, failure, manual override).
    priority: High
    related_usecase:
      - USER_STORY-0004
    acceptance_criteria:
      - "Given a reschedule request, when it is processed, then an audit record is created with all required fields."
      - "Given the audit log is queried, it returns the most recent 100 entries for a given patient."
    edge_cases:
      - "Audit logging service is temporarily unavailable; the system should queue the log entry and retry."
      - "Log entry exceeds size limits; the system truncates or splits the record."
    dependencies: []

  - id: FR-0021
    description: |
      Provide a manual override path for staff to intervene when the system cannot automatically process a reschedule (e.g., due to conflicting constraints or system errors).
    priority: Medium
    related_usecase:
      - USER_STORY-0004
    acceptance_criteria:
      - "Given a staff member accesses the reschedule request in the admin panel, when they choose **Override**, then they can confirm or modify the appointment details."
      - "Given an override is performed, the system logs the staff action in the audit trail."
    edge_cases:
      - "Multiple staff members attempt to override the same request simultaneously; the system serializes the operations."
      - "Staff override conflicts with an external calendar integration; the system resolves the conflict by priority rules."
    dependencies: []

  - id: FR-0022
    description: |
      Allow patients to cancel a pending reschedule request before it is finalized, restoring the original appointment time.
    priority: Medium
    related_usecase:
      - USER_STORY-0004
    acceptance_criteria:
      - "Given a patient has a pending reschedule, when they click **Cancel Reschedule**, then the request is cancelled and the original appointment is restored."
      - "Given the cancellation is processed, the system sends a cancellation notification to the patient."
    edge_cases:
      - "Patient attempts to cancel after the system has already confirmed the new appointment; the system returns an error."
      - "Cancellation request is received during a system outage; the system queues the cancellation for processing once the service is restored."
    dependencies: []

  - id: FR-00023
    description: The system must send an appointment reminder to the patient via the patient’s chosen channel (email, SMS, or app push) before the scheduled appointment time.
    priority: Critical
    related_usecase:
      - USE_CASE-0005
    acceptance_criteria:
      - Given a patient with a confirmed appointment, when the scheduled reminder window is reached, then a reminder message is dispatched to the patient’s chosen channel.
      - Given the reminder is sent, then the system records a delivery attempt with a timestamp and status (sent, queued, failed).
    edge_cases:
      - Patient’s chosen channel is temporarily unavailable (e.g., network outage); the system must retry up to 3 times with exponential back‑off.
      - Patient’s email address is invalid; the system must log the failure and flag the appointment for manual review.
    dependencies: []

  - id: FR-00024
    description: The reminder message must include a clear reply option that allows the patient to indicate attendance status (“Yes, I will attend” / “No, I will not attend”).
    priority: High
    related_usecase:
      - USE_CASE-0005
    acceptance_criteria:
      - Given a reminder is received, when the patient selects an option, then the system receives the reply within the channel’s supported mechanisms (SMS reply, email link, push tap).
    edge_cases:
      - Patient replies with an unsupported text; the system must ignore and log the attempt.
      - Patient replies after the appointment time; the system should still record the reply but mark it as late.
    dependencies:
      - FR-00023

  - id: FR-00025
    description: The system must capture and store the patient’s reply with a timestamp and update the appointment record to reflect attendance status.
    priority: High
    related_usecase:
      - USE_CASE-0005
    acceptance_criteria:
      - Given a patient replies “No”, when the reply is received, then the appointment record is updated to “Cancelled” and the patient’s status is set to “Not Attending”.
      - Given a patient replies “Yes”, when the reply is received, then the appointment record is updated to “Attending”.
    edge_cases:
      - Duplicate replies for the same appointment; the system must accept the first and ignore subsequent ones, logging duplicates.
      - System crash during reply processing; the reply must be persisted to a durable queue to be processed after recovery.
    dependencies:
      - FR-00024

  - id: FR-00026
    description: If a patient replies “No”, the system must trigger a follow‑up workflow (e.g., send a cancellation confirmation email or initiate a phone call to reschedule).
    priority: Medium
    related_usecase:
      - USE_CASE-0005
    acceptance_criteria:
      - Given a “No” reply, when the system processes it, then a cancellation confirmation message is sent to the patient and the clinic staff is notified via the admin dashboard.
    edge_cases:
      - Follow‑up workflow fails; the system must retry once and then alert staff manually.
      - Patient’s phone number is missing; the system should log the inability to call and send an email instead.
    dependencies:
      - FR-00025

  - id: FR-00027
    description: Patients must be able to set or change their preferred reminder channel in their patient portal.
    priority: High
    related_usecase:
      - USE_CASE-0005
    acceptance_criteria:
      - Given a patient logs into their portal, when they select a channel and save, then the system updates the patient profile and uses the new channel for future reminders.
    edge_cases:
      - Patient selects a channel that is not HIPAA‑compliant; the system must reject the selection and provide an error message.
      - Patient attempts to change channel during an active reminder window; the system should queue the change for the next appointment.
    dependencies: []

  - id: FR-00028
    description: Patients must be able to opt‑in or opt‑out of reminder notifications for each channel.
    priority: High
    related_usecase:
      - USE_CASE-0005
    acceptance_criteria:
      - Given a patient opts out of SMS reminders, when an appointment is scheduled, then the system does not send an SMS reminder but continues to send via other opted‑in channels.
    edge_cases:
      - Patient opts out of all channels; the system must log the opt‑out and refuse to send any reminders, flagging the appointment for manual follow‑up.
      - Opt‑in status changes after a reminder has been queued; the system must cancel the queued message if the patient opts out before delivery.
    dependencies:
      - FR-00027

  - id: FR-00029
    description: Administrators must have an interface to configure reminder templates, send windows (e.g., 48 h, 24 h, 1 h before appointment), and channel preferences for each clinic.
    priority: Critical
    related_usecase:
      - USE_CASE-0005
    acceptance_criteria:
      - Given an admin logs into the dashboard, when they edit a template, then the new template is stored and applied to future reminders.
      - Given an admin sets a new send window, then the system schedules reminders accordingly for all upcoming appointments.
    edge_cases:
      - Admin enters an invalid time window (e.g., negative hours); the system must validate and reject the input.
      - Template contains placeholders that do not map to appointment data; the system must render a placeholder value or flag the error.
    dependencies: []

  - id: FR-00030
    description: The system must log every reminder sent, delivery status, and patient reply for audit and compliance purposes.
    priority: Critical
    related_usecase:
      - USE_CASE-0005
    acceptance_criteria:
      - Given a reminder is sent, then a log entry is created with unique identifier, channel, timestamp, and status.
      - Given a reply is received, then a log entry is created with reply content, timestamp, and patient identifier.
    edge_cases:
      - Log write failure; the system must buffer the log locally and retry until successful.
      - Log retention policy changes; the system must archive or purge logs according to new policy without data loss.
    dependencies: []



  - id: FR-0031
    description: The system shall display a user‑friendly interface that shows the current reminder channel (SMS or In‑App) and frequency (Immediate, 24 hrs before, 1 week before, or Custom time) for each reminder type.
    priority: Critical
    related_usecase:
      - USE_CASE-0006
    acceptance_criteria:
      - Given a patient is authenticated and navigates to the Preferences page, when the page loads, then the current channel and frequency for each reminder type are displayed correctly.
      - Given the Preferences page is loaded, when the patient selects a different reminder type, then the corresponding channel and frequency options update accordingly.
    edge_cases:
      - The patient has no previously set preferences; the system must show default values.
      - The patient’s account is missing a phone number; SMS options should be disabled with an explanatory tooltip.
    dependencies: []

  - id: FR-0032
    description: The system shall allow the patient to change the reminder channel and frequency for each reminder type, and to save or cancel those changes.
    priority: Critical
    related_usecase:
      - USE_CASE-0006
    acceptance_criteria:
      - Given a patient is on the Preferences page, when they select a new channel and frequency and click “Save”, then the changes are persisted and a confirmation banner appears.
      - Given a patient clicks “Cancel”, then any unsaved changes are discarded and the page reverts to the last persisted state.
    edge_cases:
      - The patient attempts to save without selecting a channel; an inline validation error is shown.
      - The patient selects a frequency that conflicts with business rules (e.g., custom time set to a past date); the system shows an appropriate error.
    dependencies:
      - FR-0031

  - id: FR-0033
    description: The system shall validate the phone number format for SMS channel selection and require verification before the preference can be saved.
    priority: High
    related_usecase:
      - USE_CASE-0006
    acceptance_criteria:
      - Given a patient enters a phone number, when the input loses focus, then the system validates the format against the national standard and displays an error for invalid formats.
      - Given a patient enters a valid phone number, when they click “Send Verification Code”, then a verification SMS is sent and the UI indicates “Verification pending”.
      - Given the patient enters the correct verification code, when they click “Save”, then the phone number is marked verified and the preference is persisted.
    edge_cases:
      - The patient enters a phone number already associated with another account; the system blocks the change with an error.
      - The verification code is entered incorrectly three times; the system locks the field for 5 minutes.
    dependencies:
      - FR-0032

  - id: FR-0034
    description: The system shall persist the patient’s communication preferences to the database and expose them to the messaging engine for all future reminders.
    priority: Critical
    related_usecase:
      - USE_CASE-0006
    acceptance_criteria:
      - Given a patient has saved new preferences, when the system writes to the database, then a record exists with the correct channel, frequency, and timestamp.
      - Given a patient’s preferences are updated, when the messaging engine queries the patient profile, then it receives the latest preferences.
    edge_cases:
      - The database write fails due to a transient error; the system retries up to 3 times before displaying an error.
      - The patient’s session times out during the save; the system preserves the data and redirects to the login page upon re‑authentication.
    dependencies:
      - FR-0032

  - id: FR-0035
    description: The system shall allow patients to update their communication preferences at any time without restriction.
    priority: High
    related_usecase:
      - USE_CASE-0006
    acceptance_criteria:
      - Given a patient is on any page of the portal, when they navigate to Preferences, they can edit and save changes without needing to log in again.
    edge_cases:
      - The patient is on an older version of the app that does not support the new UI; the system redirects them to the latest version or provides a fallback.
    dependencies:
      - FR-0031

  - id: FR-0036
    description: The system shall prepopulate default preferences using data from USER_STORY-0001 (e.g., default channel SMS, frequency Immediate) during first‑time setup or when no prior preferences exist.
    priority: Medium
    related_usecase:
      - USE_CASE-0006
    acceptance_criteria:
      - Given a patient has no stored preferences, when they visit the Preferences page, then the default channel and frequency are displayed automatically.
      - Given a patient has stored preferences, when they visit the Preferences page, then those preferences are displayed instead of defaults.
    edge_cases:
      - The default channel is unavailable (e.g., SMS service down); the system falls back to In‑App with a warning.
    dependencies:
      - FR-0031



  - id: FR-0031
    description: The system shall display a consolidated, paginated list of all patient appointments, including upcoming and past appointments, with each row showing the appointment date, time, provider name, and current status.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a patient is authenticated and navigates to the Appointment page, when the page loads, then the list displays all appointments with date, time, provider, and status, and each row is clickable.
      - Given the appointment list contains more than 50 entries, when the user scrolls, then pagination controls appear and load the next set of appointments within 2 seconds.
    edge_cases:
      - No appointments exist for the patient.
      - Appointment entries contain null or malformed provider data.
      - Timezone conversion errors causing incorrect display of appointment times.
    dependencies: []

  - id: FR-0032
    description: The system shall allow a patient to view detailed information for a selected appointment, including location, preparation notes, reminders, and status updates, with cancellation reasons displayed if applicable.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a patient clicks on an appointment row, when the details page loads, then all specified fields (date, time, provider, status, location, notes, reminders) are displayed accurately.
      - Given the appointment status is “Cancelled”, when the details page loads, then the cancellation reason is shown in a prominent alert box.
    edge_cases:
      - Appointment data missing optional fields (e.g., preparation notes).
      - Status field contains an unexpected value (e.g., “Rescheduled” not defined in UI).
      - Provider information is unavailable or has changed since the appointment was created.
    dependencies:
      - FR-0031

  - id: FR-0033
    description: The system shall provide filter options (Upcoming, Past, Provider) and sorting options (Date Ascending/Descending, Provider Name, Status) on the appointment list page.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a patient selects “Upcoming” from the filter dropdown, when the filter is applied, then only appointments with a future date are displayed.
      - Given a patient selects “Sort by Date Descending”, when the sort is applied, then the first row shows the most recent appointment.
    edge_cases:
      - User applies multiple filters simultaneously that result in zero matches.
      - Sorting by status when status values are missing for some appointments.
      - Provider filter list is empty due to data sync delay.
    dependencies:
      - FR-0031

  - id: FR-0034
    description: The system shall refresh appointment data in real time or on-demand when changes occur in the EHR, ensuring the UI reflects the latest state within 5 seconds of the change.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given an appointment status changes in the EHR, when the patient views the appointment list or detail page, then the updated status appears within 5 seconds.
      - Given the patient manually clicks “Refresh”, when the refresh action completes, then the appointment list is updated to the current EHR state.
    edge_cases:
      - Network latency or outage delays the update beyond 5 seconds.
      - Simultaneous updates to the same appointment by multiple clinicians.
      - EHR update fails and the system must display an error notification.
    dependencies:
      - FR-0031
      - FR-0032

  - id: FR-0035
    description: The system shall enable patients to access the appointment details page within no more than 3 clicks from the login screen.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a patient logs in, when the patient navigates to the appointment list and then selects an appointment, then the details page is reached within 3 clicks.
      - Given the patient uses a mobile device, when the navigation flow follows the same pattern, then the details page is still reachable within 3 taps.
    edge_cases:
      - Pop‑up modals or mandatory security prompts add an extra click.
      - Navigation menu is collapsed by default, requiring an additional click to expand.
    dependencies:
      - FR-0031

  - id: FR-0042
    description: The portal must display a list of the patient’s upcoming appointments, including appointment ID, date, time, and provider name.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given the patient is logged in, when the patient navigates to the appointments page, then the page must display a table with at least the columns: Appointment ID, Date, Time, Provider.
      - Given the patient has no upcoming appointments, when the patient navigates to the appointments page, then a message “No upcoming appointments” must be displayed.
    edge_cases:
      - The patient has more than 50 appointments (pagination or lazy loading must still function).
      - Appointment times are in different time zones; the displayed time must be converted to the patient’s local time zone.
      - The patient’s session has expired; the system must redirect to login before displaying the list.
    dependencies: []

  - id: FR-0043
    description: The patient must be able to initiate a cancellation of an appointment by clicking a “Cancel” button next to the desired appointment.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given the patient is viewing the appointment list, when the patient clicks the “Cancel” button for an appointment, then a confirmation dialog must appear.
      - The confirmation dialog must contain the appointment details and a single “Confirm Cancellation” button.
    edge_cases:
      - The patient clicks “Cancel” on an appointment that is already canceled; the system must show an error “Appointment already canceled”.
      - The patient clicks “Cancel” on an appointment that belongs to another patient; the system must deny the action with “Access denied”.
      - The patient clicks “Cancel” but the network fails; the system must retry once and then display a retryable error message.
    dependencies:
      - FR-0042

  - id: FR-0044
    description: The system must display a modal confirmation dialog that requires the patient to explicitly confirm the cancellation.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given the patient has clicked “Cancel”, when the confirmation dialog appears, then it must contain the appointment details and a “Confirm Cancellation” button.
      - The dialog must be dismissible by clicking outside the modal or pressing the “Cancel” button in the dialog.
    edge_cases:
      - The dialog fails to render due to a CSS bug; the system must fallback to a plain text confirmation prompt.
      - The patient presses the “Confirm Cancellation” button twice; the system must ignore the second request and not cancel twice.
    dependencies:
      - FR-0043

  - id: FR-0045
    description: Upon confirmation, the system must update the appointment status to “canceled” in the backend and release the time slot for re‑booking.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given the patient confirms cancellation, when the request reaches the server, then the appointment status must be set to “canceled” and the slot must become available for other patients.
      - The update must be atomic; if any part fails, the status must remain unchanged and an error returned to the client.
    edge_cases:
      - The appointment was already canceled by another user; the system must return an error and not double‑cancel.
      - The scheduling system is temporarily unavailable; the cancellation request must be retried up to 3 times before failing.
    dependencies:
      - FR-0044

  - id: FR-0046
    description: The system must send a notification (email and/or SMS) to the patient and the provider informing them of the cancellation.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given the appointment has been successfully canceled, when the server processes the cancellation, then an email and/or SMS must be sent to both the patient and provider containing the appointment ID, date, time, and cancellation confirmation.
      - The notification must be sent asynchronously and not delay the client response.
    edge_cases:
      - The patient’s email address is invalid; the system must log the failure and proceed without blocking the cancellation.
      - The provider’s phone number is missing; the system must skip SMS but still send email.
    dependencies:
      - FR-0045

  - id: FR-0047
    description: The system must record an audit trail entry for every cancellation, including timestamp, user ID, appointment ID, and action performed.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a cancellation occurs, when the server logs the event, then an audit record must be stored with the fields: timestamp, user_id, appointment_id, action="canceled".
      - The audit record must be immutable and retrievable by an admin audit query.
    edge_cases:
      - The audit database is temporarily unavailable; the system must queue the audit entry and retry until successful without affecting the cancellation flow.
      - Duplicate cancellation requests (e.g., double click) must result in a single audit record.
    dependencies:
      - FR-0045

  - id: FR-0048
    description: The portal must provide a “Cancellation History” view where patients can see all past cancellations with details.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given the patient navigates to “Cancellation History”, when the page loads, then it must list all appointments that have status “canceled” for that patient, sorted by cancellation date descending.
      - Each record must show appointment ID, original date/time, provider, cancellation date/time, and notification status.
    edge_cases:
      - The patient has no cancellation history; the page must display “No cancellations found”.
      - The patient’s account has been merged with another; the history must reflect both accounts’ cancellations.
    dependencies:
      - FR-0045

  - id: FR-0042
    description: Encrypt all patient data at rest using AES‑256 before storage.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given patient data is stored, when a storage API is called, then the data is encrypted with AES‑256 and the plaintext is not present in the database.
      - Given a patient record is retrieved, when the data is read, then it is automatically decrypted and presented in cleartext to the authorized user.
    edge_cases:
      - Attempting to read the raw database file directly should yield unreadable, encrypted bytes.
      - Bulk export of patient data must still apply AES‑256 encryption and provide a decryption key only to authorized roles.
    dependencies: []

  - id: FR-0043
    description: Encrypt all network transmissions with TLS 1.2 or higher.
    priority: Critical
    related_usecase:
      - USE_CASE-0002
    acceptance_criteria:
      - Given a client initiates a connection, when the server accepts the connection, then the TLS handshake uses protocol version 1.2 or newer.
      - Given a data transfer occurs, when the payload is captured on the network, then the ciphertext cannot be decrypted without the session keys.
    edge_cases:
      - Attempting to force a TLS 1.0 handshake should be rejected by the server.
      - Legacy browsers that only support TLS 1.1 must be denied access to the portal.
    dependencies: []

  - id: FR-0044
    description: Implement role‑based access control (RBAC) with least‑privilege policies for all patient data.
    priority: Critical
    related_usecase:
      - USE_CASE-0003
    acceptance_criteria:
      - Given a user with role “Doctor”, when they request a patient record, then the request is granted.
      - Given a user with role “Receptionist”, when they request a patient record, then the request is denied with a 403 Forbidden response.
    edge_cases:
      - A user with multiple roles (e.g., Doctor and Admin) should only receive the most permissive access defined by the union of roles.
      - Role changes must propagate within 5 seconds of update; a request made after role update should reflect the new permissions immediately.
    dependencies: []

  - id: FR-0045
    description: Maintain an immutable audit trail that logs every access, modification, and deletion event for patient data.
    priority: Critical
    related_usecase:
      - USE_CASE-0004
    acceptance_criteria:
      - Given an event occurs (read, write, delete), when the event is logged, then an audit record containing timestamp, user ID, action, and affected record ID is created and cannot be altered thereafter.
      - Given the audit log is queried, then all entries are returned in chronological order and include cryptographic hashes linking each record to the previous one.
    edge_cases:
      - Concurrent access to the same record by multiple users must result in separate audit entries without race conditions.
      - Attempts to delete or modify audit records must be blocked and logged as a separate “audit tampering” event.
    dependencies: [FR-0042, FR-0043, FR-0044]

  - id: FR-0046
    description: Provide secure deletion mechanisms that ensure patient data is irrecoverable after deletion.
    priority: Critical
    related_usecase:
      - USE_CASE-0005
    acceptance_criteria:
      - Given a patient record is deleted, when the storage subsystem is queried for the raw data, then the data is either overwritten or marked as unrecoverable.
      - Given a forensic recovery attempt is performed on a deleted record, then the recovery tool reports the data as unreadable or missing.
    edge_cases:
      - Deleting a record that has been replicated to a backup must trigger a secure wipe on all replicas.
      - A user with elevated privileges attempting to delete a non‑existent record should receive a 404 Not Found without revealing existence of the data.
    dependencies: [FR-0042]

  - id: FR-0047
    description: Create an incident reporting workflow that automatically alerts, creates tickets, captures evidence, and escalates when a security incident is detected.
    priority: Critical
    related_usecase:
      - USE_CASE-0006
    acceptance_criteria:
      - Given an anomalous activity is detected, when the system processes the event, then an email alert is sent to the security team, a ticket is created in the incident management system, and relevant logs are attached.
      - Given a duplicate incident is reported within 30 minutes, when the system processes it, then it is merged with the existing incident to avoid duplication.
    edge_cases:
      - If the email service is down, the system must queue the alert and retry until successful.
      - If the ticketing system is unreachable, the incident must still be logged locally and retried once connectivity is restored.
    dependencies: [FR-0044, FR-0045]

  - id: FR-0048
    description: Enforce multi‑factor authentication (MFA) for all privileged roles (e.g., Admin, Doctor, Compliance Officer).
    priority: Critical
    related_usecase:
      - USE_CASE-0007
    acceptance_criteria:
      - Given a privileged user attempts to log in, when the MFA challenge is presented, then the user must provide a valid second factor before access is granted.
      - Given a privileged user attempts to log in without completing MFA, then the login attempt is denied with a 401 Unauthorized response.
    edge_cases:
      - A user who has lost their second factor device must be able to use a backup code to complete authentication.
      - MFA token expiry should trigger a prompt for re‑authentication before the session expires.
    dependencies: [FR-0044]

  - id: FR-0042
    description: |
      The portal shall implement lazy loading for all non‑critical images and components
      so that only visible content is fetched during the initial page load.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a patient opens any portal page, when the page is rendered, then only images within the viewport are requested immediately.
      - Given a patient scrolls to the bottom of the page, when the viewport enters the lazy‑load zone, then the corresponding images are fetched and displayed.
    edge_cases:
      - The page contains an image with a very small file size that loads before the viewport; it should still be lazy‑loaded if marked non‑critical.
      - The user scrolls faster than the network can deliver images; the images should still appear in order without breaking layout.
    dependencies: []

  - id: FR-0043
    description: |
      The portal shall cache all static assets (CSS, JS, images) on a CDN with a
      Cache‑Control header of max‑age 2592000 seconds (30 days) and must purge
      assets immediately when they are updated.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a static asset is requested, when the CDN receives the request, then it serves the asset with a Cache‑Control header of max‑age 2592000.
      - Given a new version of an asset is deployed, when the asset URL changes, then the CDN serves the new asset without stale content.
    edge_cases:
      - The CDN is temporarily unreachable; the origin should still serve the asset with the same Cache‑Control header.
      - The asset is updated but the URL remains the same; the CDN must invalidate the cache within 5 minutes.
    dependencies: []

  - id: FR-0044
    description: |
      The portal’s API endpoints used for appointment availability and booking
      shall be optimized to reduce payload size, enable HTTP/2 multiplexing,
      and cache GET responses for 60 seconds.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a patient requests appointment availability, when the API responds, then the payload contains only required fields (no redundant metadata).
      - Given a GET request is repeated within 60 seconds, when the API is called, then the cached response is returned with a 200 status.
    edge_cases:
      - The API receives an invalid date format; it must return a 400 error with a clear message.
      - The cache expires during a high‑traffic period; the system must still serve the latest data without delay.
    dependencies: []

  - id: FR-0045
    description: |
      The portal shall use responsive design principles to serve mobile‑optimized
      assets (e.g., lower‑resolution images, compressed CSS) based on the
      viewport width.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a patient accesses the portal from a device with width <= 480px, when the page loads, then the served CSS is the mobile variant and images are 50% of the desktop resolution.
      - Given a patient accesses the portal from a device with width > 1200px, when the page loads, then the served CSS is the desktop variant and images are full resolution.
    edge_cases:
      - The device reports a non‑standard viewport width (e.g., 1024.7px); the system should round to the nearest breakpoint.
      - The user resizes the browser window after the page has loaded; the page should not re‑request assets but adapt layout via CSS media queries.
    dependencies: []

  - id: FR-0046
    description: |
      The portal shall expose a real‑time performance monitoring widget that
      displays page load time and error rate per user session to internal
      dashboards.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given a patient completes a booking session, when the session ends, then a payload containing page load time and error count is sent to the monitoring endpoint.
      - Given the monitoring endpoint receives data, then the dashboard updates within 10 seconds to reflect the latest metrics.
    edge_cases:
      - The monitoring endpoint is temporarily unavailable; the widget should queue data locally and retry every 30 seconds.
      - The session ends abruptly (e.g., network drop); the widget should still attempt to send the last known metrics.
    dependencies: []

  - id: FR-0047
    description: |
      The portal shall provide graceful degradation: if the CDN is unreachable,
      the origin server must serve cached assets for up to 5 seconds before
      retrying the CDN.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given the CDN is unreachable, when the browser requests a static asset, then the origin serves the cached asset with a 200 status within 5 seconds.
      - Given the CDN becomes reachable after 4 seconds, when the browser requests a static asset, then the CDN serves the asset without additional delay.
    edge_cases:
      - The CDN outage lasts longer than 5 seconds; the origin should continue to serve assets until the CDN recovers.
      - The asset is not cached at the origin; the origin should fetch from the CDN once it becomes available.
    dependencies: []

  - id: FR-0062
    description: The system must display the backend‑suggested appointment slot to the patient alongside any previously selected slots.
    priority: Critical
    related_usecase:
      - USE_CASE-0012
    acceptance_criteria:
      - Given the patient is on the booking screen, when the backend returns a suggested slot, then the UI shows the slot in a clearly labeled “Suggested Slot” section.
      - Given the suggested slot is unavailable, when the backend returns no suggestion, then the UI shows “No suggestion available” and hides the suggestion section.
    edge_cases:
      - The backend returns a malformed slot object (missing time or date).
      - The UI fails to render the suggestion due to a JavaScript error.
    dependencies: []

  - id: FR-0063
    description: The system must allow the patient to accept the suggested slot with a single tap/click.
    priority: Critical
    related_usecase:
      - USE_CASE-0012
    acceptance_criteria:
      - Given the suggested slot is displayed, when the patient taps the “Accept” button, then the system submits the slot as the final selection to the backend.
      - Given the patient accepts, then a success confirmation message “Appointment confirmed” is shown.
    edge_cases:
      - The patient taps “Accept” but the network disconnects before the request reaches the backend.
      - The slot has already been booked by another patient by the time the acceptance request is processed.
    dependencies:
      - FR-0062

  - id: FR-0064
    description: The system must allow the patient to override the suggested slot by selecting an alternative date/time from the calendar or list.
    priority: Critical
    related_usecase:
      - USE_CASE-0012
    acceptance_criteria:
      - Given the suggested slot is displayed, when the patient selects a different slot and taps “Confirm”, then the system submits the new slot as the final selection to the backend.
      - Given the patient overrides, then the UI updates to show the newly selected slot in the “Selected Slot” area.
    edge_cases:
      - The patient selects a slot outside clinic operating hours.
      - The patient selects a slot that is already booked by another patient.
    dependencies:
      - FR-0062

  - id: FR-0065
    description: The system must validate the chosen slot against clinic availability and business rules before persisting it.
    priority: Critical
    related_usecase:
      - USE_CASE-0012
    acceptance_criteria:
      - Given a slot is submitted, when the backend receives the request, then it checks that the slot is not double‑booked, is within operating hours, and is in the future.
      - Given the validation passes, then the backend returns a 200 OK with the confirmed slot details.
      - Given the validation fails, then the backend returns a 409 Conflict with a descriptive error message.
    edge_cases:
      - The validation service experiences a timeout.
      - The slot falls exactly on the boundary of clinic closing time.
    dependencies:
      - FR-0063
      - FR-0064

  - id: FR-0066
    description: The system must persist the final appointment selection in the backend appointment database.
    priority: Critical
    related_usecase:
      - USE_CASE-0012
    acceptance_criteria:
      - Given a validated slot, when the backend receives the confirmation request, then it inserts or updates the appointment record in the database.
      - Given the persistence succeeds, then the backend returns a 201 Created with the appointment ID.
      - Given the persistence fails (e.g., DB error), then the backend returns a 500 Internal Server Error.
    edge_cases:
      - The database is temporarily unavailable.
      - The appointment ID already exists due to a duplicate request.
    dependencies:
      - FR-0065

  - id: FR-0067
    description: The system must provide a confirmation UI to the patient after successful booking.
    priority: High
    related_usecase:
      - USE_CASE-0012
    acceptance_criteria:
      - Given the booking is successful, then the UI displays a modal or banner with “Your appointment is confirmed for <date/time>”.
      - Given the booking is successful, then an email and/or SMS confirmation is sent to the patient.
    edge_cases:
      - The confirmation modal fails to render due to CSS conflict.
      - The email/SMS service is unavailable, but the UI still shows confirmation.
    dependencies:
      - FR-0066

  - id: FR-0068
    description: The system must provide a rollback/undo option that allows the patient to cancel or change the booking within 30 seconds after confirmation.
    priority: Medium
    related_usecase:
      - USE_CASE-0012
    acceptance_criteria:
      - Given the patient receives the confirmation, when they tap “Undo” within 30 seconds, then the system cancels the appointment and updates the UI to “Appointment cancelled”.
      - Given the patient taps “Undo” after 30 seconds, then the system displays “Undo period expired”.
    edge_cases:
      - The patient attempts to undo after the appointment has already been processed by a downstream system.
      - The undo request fails due to network error.
    dependencies:
      - FR-0067

  - id: FR-0062
    description: >
      The system must provide a Conflict Check Service that receives a proposed reservation
      (doctor ID, start time, duration) and compares it against live doctor calendars
      and existing appointments to determine if an overlap exists.
    priority: Critical
    related_usecase:
      - USE_CASE-0001  # Booking Process
    acceptance_criteria:
      - "Given a pending reservation with a doctor ID, start time, and duration, when the
        Conflict Check Service receives the reservation, then it returns a status of
        'pass' if no overlapping appointment exists."
      - "Given a pending reservation that overlaps with an existing appointment, when the
        service checks, then it returns a status of 'fail' and includes details of the
        overlapping appointment(s)."
    edge_cases:
      - "The reservation starts exactly at the end time of an existing appointment
        (should be considered non-conflicting)."
      - "The reservation has zero duration (should be treated as invalid and fail)."
    dependencies: []

  - id: FR-0063
    description: >
      The system must confirm a booking in a single atomic transaction only after a
      successful conflict check, ensuring no partial commits occur.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - "Given a conflict check passes, when the booking is confirmed, then the reservation
        is persisted in the database within a single transaction with no partial commits."
      - "Given a conflict check fails, when the booking is attempted, then no reservation
        is persisted in the database."
    edge_cases:
      - "A transaction rollback occurs due to a database error after the conflict check
        passes."
      - "Two concurrent booking attempts for the same slot are processed; only one
        succeeds."
    dependencies:
      - FR-0062

  - id: FR-0064
    description: >
      The system must return a clear pass/fail status and, if failed, a list of overlapping
      appointment details to the caller (UI or API client).
    priority: High
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - "When the conflict check completes, the API returns HTTP 200 with a JSON body
        containing a 'status' field set to 'pass' or 'fail'."
      - "If 'status' is 'fail', the JSON body includes an array of overlapping
        appointments with doctor ID, start time, and duration."
    edge_cases:
      - "The network latency causes the client to time out before receiving the response."
      - "The client receives a malformed JSON response."
    dependencies:
      - FR-0062

  - id: FR-0065
    description: >
      The system must implement retry and fallback logic when the Conflict Check Service
      is unavailable, attempting up to three retries with exponential back‑off before
      flagging the booking for manual review.
    priority: Medium
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - "When the Conflict Check Service returns HTTP 503, the system retries the
        request up to three times with exponential back‑off."
      - "If all retries fail, the booking attempt is flagged for manual review and
        the user receives a notification."
    edge_cases:
      - "The service remains unavailable beyond the retry limit."
      - "The retry logic itself fails due to a programming error."
    dependencies:
      - FR-0062

  - id: FR-0066
    description: >
      The system must expose a REST API endpoint `/bookings` that accepts a booking
      payload, triggers the conflict check, and returns the result to the caller.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - "A POST request to `/bookings` with a valid payload returns HTTP 200 and
        invokes the Conflict Check Service."
      - "If the payload is invalid (missing doctor ID, improper time format), the
        API returns HTTP 400 with an error message."
    edge_cases:
      - "The payload contains a start time in a different time zone; the system must
        normalize to UTC before checking."
      - "The payload references a non‑existent doctor ID."
    dependencies:
      - FR-0062
      - FR-0064

  - id: FR-0067
    description: >
      The system must log each conflict check attempt with timestamp, user ID, doctor
      ID, appointment window, result, and conflict details (if any).
    priority: High
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - "For every conflict check request, a log entry is written containing
        the fields: timestamp, user_id, doctor_id, start_time, end_time, status,
        and conflict_details."
      - "Log entries are stored in a searchable log store with a retention policy
        of 90 days."
    edge_cases:
      - "The logging subsystem is temporarily unavailable; the system must not
        fail the booking process."
      - "Log entries exceed the storage quota; older entries are archived."
    dependencies:
      - FR-0062

  - id: FR-0068
    description: >
      The system must complete the conflict check within one second for 99.5% of
      booking attempts, ensuring real‑time responsiveness.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - "Latency of the Conflict Check Service is measured; 99.5% of requests
        complete within 1 second."
      - "If latency exceeds 1 second, the system logs a warning and the user
        receives a 'delayed response' notification."
    edge_cases:
      - "High load causes occasional requests to exceed 1 second."
      - "Network partition delays communication with the calendar service."
    dependencies:
      - FR-0062

  - id: FR-0069
    description: >
      The system must ensure the conflict detection algorithm executes within a single
      database transaction to guarantee data consistency.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - "All reads and writes performed by the conflict detection algorithm are
        encapsulated in a single transaction that is either fully committed or
        fully rolled back."
      - "Audit logs confirm that no partial transaction states are persisted."
    edge_cases:
      - "Long-running transaction causes a deadlock; the system retries or aborts."
      - "The database connection pool is exhausted during a transaction."
    dependencies:
      - FR-0063

  - id: FR-0077
    description: The system must load and validate all admin‑defined rules that govern crowd limits, appointment length, and other scheduling constraints before any conflict resolution is attempted.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given the rules repository contains valid rules, when the engine starts, then it must load all rules into memory without errors.
      - Given the rules repository contains an invalid rule, when the engine starts, then it must log the error and skip that rule without crashing.
    edge_cases:
      - The rules repository is unreachable; the engine should retry up to 3 times and fail gracefully.
      - Duplicate rule definitions; the engine must detect and log a conflict, using the most recent version.
    dependencies: []

  - id: FR-0078
    description: The engine must fetch live availability data from the calendar service and historical usage patterns from the analytics store within 5 seconds of a conflict trigger.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given a conflict trigger, when the engine requests availability, then it receives the data in ≤5 s.
      - Given a failure to retrieve historical patterns, when the engine proceeds, then it logs the failure and continues using only live availability.
    edge_cases:
      - The calendar service returns a 500 error; the engine must retry once and then fail the resolution.
      - The analytics store returns incomplete data; the engine must use a default fallback pattern.
    dependencies:
      - FR-0077

  - id: FR-0079
    description: The system must detect all overlapping or conflicting appointments across the affected resources based on the loaded rules and the retrieved availability data.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given a set of appointments, when the engine processes them, then it identifies all pairs that violate crowd or length constraints.
      - Given no conflicts, when the engine processes appointments, then it reports zero conflicts.
    edge_cases:
      - Appointments with null end times; the engine must treat them as open‑ended and flag as conflict.
      - Time zone mismatches; the engine must normalize all times to UTC before comparison.
    dependencies:
      - FR-0077
      - FR-0078

  - id: FR-0080
    description: The engine must compute and return the next best available slot that satisfies crowd, length, and admin‑defined rules, prioritizing minimal deviation from the original requested time.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given a conflict, when the engine generates a slot, then the slot starts no earlier than the original requested time minus 15 min and no later than requested time plus 120 min.
      - Given multiple candidate slots, when the engine selects one, then it chooses the one with the smallest crowd density.
    edge_cases:
      - No slot available within the 2‑hour window; the engine must return a “no available slot” response.
      - The selected slot conflicts with a newly created appointment due to a race condition; the engine must retry resolution.
    dependencies:
      - FR-0079

  - id: FR-0081
    description: The system must apply the resolution atomically, updating or adjusting bookings in a single transaction to avoid double‑booking.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given a resolved slot, when the engine commits the changes, then no two appointments overlap for the same resource.
      - Given a transaction failure, when the engine attempts to commit, then it rolls back all changes and logs the failure.
    edge_cases:
      - Concurrent resolution attempts for the same appointment; the engine must serialize and prevent double booking.
      - Database deadlock; the engine must detect and retry the transaction up to 2 times.
    dependencies:
      - FR-0080

  - id: FR-0082
    description: The engine must trigger notifications (email/SMS/webhook) to affected users and administrators immediately after a conflict is resolved.
    priority: High
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given a successful resolution, when the engine sends notifications, then all recipients receive the message within 10 s.
      - Given a notification failure, when the engine attempts to send, then it retries twice before logging the failure.
    edge_cases:
      - Recipient email address is invalid; the engine must log the error and continue.
      - Webhook endpoint returns 429; the engine must back‑off and retry after the specified delay.
    dependencies:
      - FR-0081

  - id: FR-0083
    description: The system must maintain an immutable audit trail for every conflict, resolution decision, and slot adjustment for compliance and traceability.
    priority: High
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given any resolution action, when the engine logs the event, then the audit record includes timestamp, user IDs, original and new slot details, and rule identifiers.
      - Given a query for an audit record, when the audit service is accessed, then it returns the exact event data within 2 s.
    edge_cases:
      - Audit storage failure; the engine must buffer the record and retry asynchronously.
      - Duplicate audit entries; the engine must detect and discard duplicates based on a unique hash.
    dependencies:
      - FR-0080
      - FR-0081

  - id: FR-0084
    description: The engine must expose a RESTful API endpoint `/resolve-conflict` that accepts a conflict payload and returns the resolved slot or error message.
    priority: Medium
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given a valid conflict payload, when the API is called, then it returns HTTP 200 with the resolved slot data.
      - Given an invalid payload, when the API is called, then it returns HTTP 400 with descriptive error details.
    edge_cases:
      - API call with missing authentication; the engine returns HTTP 401.
      - Payload size exceeds 1 MB; the engine returns HTTP 413.
    dependencies:
      - FR-0077
      - FR-0078
      - FR-0079
      - FR-0080
      - FR-0081
      - FR-0082
      - FR-0083

  - id: FR-0085
    description: The engine must support dynamic updates to admin‑defined rules via an authenticated admin API, propagating changes to all in‑memory rule caches within 10 s.
    priority: Low
    related_usecase:
      - USE_CASE-0002
    acceptance_criteria:
      - Given an admin submits a rule update, when the API processes it, then the new rule is persisted and the in‑memory cache is refreshed within 10 s.
      - Given a rule conflict during update, when the API processes it, then it rejects the update with HTTP 409 and a detailed message.
    edge_cases:
      - Concurrent rule updates for the same rule; the engine must serialize and apply the last write.
      - Update fails due to database lock; the engine retries once before failing.
    dependencies:
      - FR-0077

  - id: FR-0077
    description: |
      The system shall expose a secure API endpoint `/appointments/{id}/cancel` that allows a patient or a doctor to cancel a scheduled appointment.
    priority: Critical
    related_usecase:
      - USE_CASE-0015
    acceptance_criteria:
      - Given a valid appointment ID and an authenticated user with role Patient or Doctor, when the user sends a DELETE request to `/appointments/{id}/cancel`, then the system responds with HTTP 200 and a JSON body containing `{"status":"cancelled","appointmentId":"{id}"}`.
      - Given an unauthenticated request, when the user attempts to cancel an appointment, then the system responds with HTTP 401 Unauthorized.
      - Given a user attempting to cancel an appointment that does not belong to them, then the system responds with HTTP 403 Forbidden.
    edge_cases:
      - The appointment ID does not exist in the database.
      - The user has already cancelled the appointment (duplicate cancellation).
      - The appointment has already passed (past appointment cancellation policy).
    dependencies: []

  - id: FR-0078
    description: |
      Upon successful cancellation, the system shall immediately mark the corresponding time slot as available in the resource calendar, making it eligible for new bookings.
    priority: High
    related_usecase:
      - USE_CASE-0015
    acceptance_criteria:
      - Given a cancelled appointment, when the cancellation is processed, then the slot in the calendar becomes `free` within 1 second and can be booked by another user.
      - Given a cancelled appointment, when the slot status is queried, then the status returned is `free`.
    edge_cases:
      - The slot was already free due to a prior cancellation.
      - Concurrent cancellation requests for the same slot.
    dependencies:
      - FR-0077

  - id: FR-0079
    description: |
      The system shall update crowdedness and resource utilization metrics within 2 seconds after a cancellation.
    priority: High
    related_usecase:
      - USE_CASE-0015
    acceptance_criteria:
      - Given a cancelled appointment, when the cancellation is processed, then the metrics service receives an update event within 2 seconds.
      - Given the metrics service, when it processes the event, then the updated metrics are persisted and queryable within 2 seconds.
    edge_cases:
      - Metrics service is temporarily unavailable.
      - Multiple cancellations occur in rapid succession.
    dependencies:
      - FR-0077
      - FR-0078

  - id: FR-0080
    description: |
      The system shall persist an audit record for every cancellation, capturing user ID, appointment ID, timestamp, and optional cancellation reason.
    priority: Medium
    related_usecase:
      - USE_CASE-0015
    acceptance_criteria:
      - Given a cancellation request, when the cancellation is processed, then an audit log entry is created in the audit table with all required fields.
      - The audit log entry is searchable by appointment ID, user ID, or date range via an API endpoint `/audit?appointmentId={id}&userId={uid}&from={date}&to={date}`.
    edge_cases:
      - Cancellation reason is omitted.
      - Audit log service experiences a transient failure.
    dependencies:
      - FR-0077

  - id: FR-0081
    description: |
      The system shall return a confirmation response and send a notification (email/SMS/push) to both the patient and the doctor confirming the slot release.
    priority: Medium
    related_usecase:
      - USE_CASE-0015
    acceptance_criteria:
      - Given a successful cancellation, the API returns HTTP 200 with a confirmation message.
      - A notification is sent to both parties within 5 seconds of cancellation.
      - The notification content includes the appointment ID, original scheduled time, and confirmation that the slot is now free.
    edge_cases:
      - Notification service is down.
      - User has opted out of certain notification channels.
    dependencies:
      - FR-0077
      - FR-0078

  - id: FR-0082
    description: |
      The system shall handle cancellation failures gracefully, ensuring idempotency and providing clear error messages to the user.
    priority: Medium
    related_usecase:
      - USE_CASE-0015
    acceptance_criteria:
      - Given a network failure during cancellation, when the request is retried, the system processes it idempotently and returns the same result as the first attempt.
      - Given a cancellation that fails due to an internal error, the API returns HTTP 500 with a user‑friendly error message.
      - The system logs the failure details for later analysis.
    edge_cases:
      - Duplicate cancellation requests with different timestamps.
      - Cancellation request with malformed payload.
    dependencies:
      - FR-0077

  - id: FR-0092
    description: >
      Detect when a patient misses a scheduled appointment by monitoring the
      appointment start time against a configurable grace period and mark the
      appointment as a no‑show if the patient has not checked in.
    priority: Critical
    related_usecase:
      - USE_CASE-0016
    acceptance_criteria:
      - "Given an appointment scheduled for 10:00 AM and a grace period of 15 min,
        if the patient has not checked in by 10:15 AM, the system marks the
        appointment status as NO_SHOW."
      - "Given an appointment scheduled for 10:00 AM and a grace period of 15 min,
        if the patient checks in at 10:12 AM, the system does not mark it as
        NO_SHOW."
    edge_cases:
      - "System clock is skewed by more than ±5 min, causing incorrect detection."
      - "Patient checks in via a manual override after the grace period but before
        the detection job runs."
    dependencies:
      - []

  - id: FR-0093
    description: >
      Generate up to five alternative appointment slots for a missed appointment,
      prioritizing slots that preserve the provider’s current day schedule,
      respect room/equipment constraints, and fall within clinic operating
      hours.
    priority: High
    related_usecase:
      - USE_CASE-0016
    acceptance_criteria:
      - "Given a no‑show appointment for Dr. Smith, the system proposes at least
        three future slots within the next 30 days that do not conflict with
        existing appointments or resource constraints."
      - "The first proposed slot must be the earliest available slot that
        satisfies all constraints."
    edge_cases:
      - "No available slots within the next 30 days; system returns an empty list."
      - "Provider’s schedule is fully booked for the next week; system skips
        those days."
    dependencies:
      - FR-0092

  - id: FR-0094
    description: >
      Notify the patient of the no‑show status and present the suggested
      reschedule options via SMS, email, or push notification, and provide an
      immediate acceptance or decline action.
    priority: Critical
    related_usecase:
      - USE_CASE-0016
    acceptance_criteria:
      - "Given a patient with a no‑show, the system sends an SMS within 10 min
        containing the top three suggested slots and a link to accept or
        decline."
      - "If the patient clicks the acceptance link, the system creates a new
        appointment with the chosen slot and updates the patient’s record."
    edge_cases:
      - "Patient’s phone number is invalid; system logs the failure and retries
        up to 3 times."
      - "Patient declines all suggested slots; system prompts the patient to
        pick a custom time or contact staff."
    dependencies:
      - FR-0093

  - id: FR-0095
    description: >
      Log all no‑show detection events, notification attempts, patient
      responses, and final appointment changes in a tamper‑evident audit trail
      that is accessible for compliance reporting.
    priority: High
    related_usecase:
      - USE_CASE-0016
    acceptance_criteria:
      - "Each log entry contains a timestamp, appointment ID, patient ID,
        event type (DETECTED, NOTIFIED, ACCEPTED, DECLINED, RESCHEDULED),
        and any relevant metadata."
      - "Audit logs are immutable and stored in an encrypted database."
    edge_cases:
      - "System crash during logging; system retries logging until success."
      - "Log storage quota exceeded; system archives old logs and deletes
        entries older than 365 days."
    dependencies:
      - FR-0092
      - FR-0093
      - FR-0094

  - id: FR-0096
    description: >
      Provide an administrative dashboard that displays no‑show counts,
      auto‑reschedule attempt rates, acceptance rates, and provider
      performance metrics, with drill‑down to individual appointment details.
    priority: Medium
    related_usecase:
      - USE_CASE-0016
    acceptance_criteria:
      - "Dashboard shows a bar chart of no‑show rates per provider for the
        selected month."
      - "Clicking on a provider’s chart filters the table to that provider’s
        appointments."
    edge_cases:
      - "Data refresh fails; dashboard displays last successful snapshot
        with a warning message."
      - "User has no permission to view provider metrics; system shows
        access denied."
    dependencies:
      - FR-0095

  - id: FR-0097
    description: >
      Allow clinicians or administrators to manually approve, reject, or modify
      a suggested reschedule slot before it is sent to the patient.
    priority: Medium
    related_usecase:
      - USE_CASE-0016
    acceptance_criteria:
      - "Given a suggested slot, the clinician can click ‘Approve’ and the
        system immediately sends the notification to the patient."
      - "Given a suggested slot, the clinician can click ‘Reject’ and the
        system removes it from the patient’s options."
    edge_cases:
      - "Clinician rejects all suggested slots; system prompts to create a
        custom slot."
      - "Clinician changes the slot after the patient has already accepted;
        system cancels the accepted appointment and reschedules."
    dependencies:
      - FR-0093

  - id: FR-0098
    description: >
      Provide a configuration interface to set the grace period for no‑show
      detection, with a default of 15 minutes and a maximum of 60 minutes.
    priority: Low
    related_usecase:
      - USE_CASE-0016
    acceptance_criteria:
      - "Admin can set the grace period to any value between 5 minutes and
        60 minutes; the system validates the input."
      - "Changing the grace period takes effect for new appointments only."
    edge_cases:
      - "Admin sets grace period to 0 minutes; system defaults to 15 minutes."
      - "Grace period is set to a value that conflicts with existing
        appointments; system warns the admin."
    dependencies:
      - []

  - id: FR-0991
    description: |
      Provide a secure web UI that allows a Clinic Administrator to create, edit, and delete conflict resolution rules
      for crowd level, session length, and alternative doctor preferences.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - "Given the administrator is authenticated and authorized, when they navigate to the Rule‑Management page, then the page loads within 2 s and displays all existing rules."
      - "Given a new rule is submitted with valid threshold values, when the form is saved, then the rule is persisted and visible in the rule list."
    edge_cases:
      - "Submitting a rule with a threshold value outside the allowed range (e.g., crowd level > 100) should display an inline error message and prevent saving."
      - "Attempting to delete a rule that is currently referenced by an active appointment should prompt a confirmation and block deletion until the appointment is resolved."
    dependencies: []

  - id: FR-0992
    description: |
      Validate rule input syntax and semantic constraints before activation, ensuring thresholds are numeric, within defined bounds, and logically consistent.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - "Given an input field for crowd level threshold, when the value is non‑numeric, then an error message is shown and the form cannot be submitted."
      - "Given session length threshold is set to 0, then the system rejects the rule with a message explaining that minimum session length must be > 0."
    edge_cases:
      - "Entering a threshold value of exactly the maximum allowed value should be accepted."
      - "Providing a negative threshold should trigger a validation error."
    dependencies:
      - FR-0991

  - id: FR-0993
    description: |
      Allow administrators to enable or disable individual conflict resolution rules without affecting system availability or ongoing appointments.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - "Given a rule is toggled off, when the system processes a new conflict, then the disabled rule is ignored in the decision logic."
      - "Given a rule is toggled on, when the next conflict occurs, then the rule is applied immediately."
    edge_cases:
      - "Toggling a rule that is part of a cascading dependency (e.g., alternative doctor preference) should not cause a cascading failure."
      - "Rapidly toggling a rule on and off should not produce race conditions in the rule engine."
    dependencies:
      - FR-0991

  - id: FR-0994
    description: |
      Ensure that any change to a rule (create, update, delete, enable/disable) is propagated to the conflict‑resolution engine within 1 s and is reflected in subsequent conflict decisions.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - "Given a rule change is committed, when a conflict is resolved 0.5 s later, then the new rule state is considered in the decision."
      - "Given the rule engine receives an update, then it acknowledges receipt within 1 s."
    edge_cases:
      - "If the rule engine is temporarily unavailable, the change should be queued and applied once the engine is back online."
      - "Simultaneous changes from two administrators should be serialized to avoid inconsistent state."
    dependencies:
      - FR-0991
      - FR-0993

  - id: FR-0995
    description: |
      Maintain an audit trail for all rule changes, recording who made the change, the timestamp, the rule state before and after, and the operation type (create, update, delete, toggle).
    priority: High
    related_usecase: []
    acceptance_criteria:
      - "Given a rule is modified, when an audit log query is performed, then the change record appears with all required fields."
      - "Given an administrator deletes a rule, then the audit trail contains the deleted rule’s previous configuration."
    edge_cases:
      - "If an audit log entry fails to write due to a database outage, the system should retry and ensure eventual consistency."
      - "Audit entries must be immutable; any attempt to modify an audit record should be rejected."
    dependencies:
      - FR-0991

  - id: FR-0996
    description: |
      Apply rule updates without any service interruption, ensuring zero downtime for the rule‑management interface and the conflict‑resolution engine.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - "Given the system is serving active appointments, when a rule change is applied, then no appointment scheduling request receives a 503 error."
      - "Given the rule‑management UI is accessed during an update, then the UI remains responsive and functional."
    edge_cases:
      - "If the update process takes longer than expected, the system should display a transient loading indicator but still accept new requests."
      - "Concurrent updates should not block each other from being applied."
    dependencies:
      - FR-0991
      - FR-0994

  - id: FR-0997
    description: |
      Provide a rollback mechanism that restores the last known good configuration if a rule update fails during deployment.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - "Given a rule update fails, when the rollback is triggered, then the system reverts to the previous rule state and the change is logged in the audit trail."
      - "Given a rollback occurs, then subsequent conflict decisions use the restored rule configuration."
    edge_cases:
      - "If the rollback itself fails, the system should alert an administrator and retain the last stable state."
      - "Rollback should not affect unrelated rules."
    dependencies:
      - FR-0996
      - FR-0995

  - id: FR-0106
    description: The system must capture every conflict detection event, storing a unique event ID, conflict type, affected record identifiers, and the initiating user or process.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a conflict detection occurs, when the event is processed, then a new audit log entry is created with a unique UUID, conflict type, list of affected record IDs, and initiator metadata.
      - Given a detection event with missing optional fields, when processed, then the log entry is still created with default or null values for those fields.
    edge_cases:
      - Event with duplicate UUID should be rejected and logged as a warning.
      - Event containing an extremely large list of record IDs (e.g., >10,000) should be truncated to the maximum allowed size and logged with a truncation notice.
    dependencies: []

  - id: FR-0107
    description: The system must capture every conflict resolution event, storing a unique event ID, resolution action, resolver metadata, and resolution outcome.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a conflict resolution occurs, when the event is processed, then a new audit log entry is created with a unique UUID, resolution action, resolver user/process, and outcome status.
      - Given a resolution event with a missing outcome, when processed, then the outcome defaults to “unknown” and a warning is recorded.
    edge_cases:
      - Duplicate resolution events for the same conflict should be detected and ignored, with a warning logged.
      - Resolution events referencing a non‑existent conflict ID should result in an error log entry and no audit record creation.
    dependencies: []

  - id: FR-0108
    description: Each audit log entry must be timestamped with UTC time in ISO 8601 format, accurate to the millisecond.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given any audit log entry, when it is written, then its timestamp field equals the system clock UTC value in ISO 8601 format (e.g., “2026-02-17T14:23:45.123Z”).
      - Given a system clock skew > 1 second, the audit entry still records the correct UTC timestamp, and a clock‑sync warning is logged.
    edge_cases:
      - System clock changes during event processing should not alter the timestamp of the already created entry.
      - Events generated during daylight‑saving transitions should still use UTC and not local time.
    dependencies: []

  - id: FR-0109
    description: Audit log entries must be persisted in a durable, transactional storage system (e.g., relational database table or append‑only file) that guarantees 100 % durability.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a new audit entry, when the system writes it, then the entry is immediately persisted to durable storage and can be retrieved in a subsequent read operation.
      - Given a system crash after an event is logged, when the system restarts, then the event remains present and retrievable.
    edge_cases:
      - Storage node failure during write should trigger retry logic and eventual consistency without data loss.
      - Disk full condition should cause the write to fail gracefully with an error log and alert.
    dependencies: []

  - id: FR-0110
    description: Administrators must be able to search and filter audit logs by date range, event type, user, and affected record ID.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given an admin performs a search with a date range of 2025‑01‑01 to 2025‑12‑31, then the system returns all events within that range.
      - Given an admin filters by event type “conflict resolution”, then only resolution events are returned.
    edge_cases:
      - Search with no matching records should return an empty result set and a “no results” message.
      - Search parameters exceeding system limits (e.g., date range > 5 years) should return an error and prompt the user to narrow the range.
    dependencies: []

  - id: FR-0111
    description: The system must provide export functionality for audit logs in CSV and JSON formats, supporting pagination and full‑dataset export.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given an admin selects “Export to CSV”, then a CSV file containing all selected audit entries is returned and can be downloaded.
      - Given an admin selects “Export to JSON”, then a JSON array of audit entries is returned and can be downloaded.
    edge_cases:
      - Exporting more than 1 million records should stream the data to avoid memory exhaustion.
      - Export of a filtered set with no records should return an empty file with a header row.
    dependencies: []

  - id: FR-0112
    description: The system must enforce a retention policy that retains audit logs for at least five years, after which logs are archived securely and cannot be modified.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a log entry older than five years, when the retention job runs, then the entry is moved to an archival storage and marked immutable.
      - Given an attempt to delete a log entry older than five years, the system rejects the operation with an error message.
    edge_cases:
      - System clock changes that affect age calculations should not prematurely archive entries.
      - Archival storage failure should trigger a retry and alert.
    dependencies: []

  - id: FR-0113
    description: Audit logs must be tamper‑evident, implemented via a hash chain where each log entry includes the hash of the previous entry.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a sequence of audit entries, the hash of entry N must be a cryptographic hash of entry N‑1’s content plus entry N’s content.
      - Given an attempt to modify a log entry, the hash chain verification fails and an alert is generated.
    edge_cases:
      - First entry in the chain should use a predefined genesis hash value.
      - In case of log compaction, the hash chain must be recomputed for the affected segment.
    dependencies: []

  - id: FR-0114
    description: Only users with the “Audit Admin” role may read audit logs; all other users are denied access.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a user with the “Audit Admin” role requests a log view, then access is granted.
      - Given a user without the role requests a log view, then access is denied and an audit entry is created for the denied attempt.
    edge_cases:
      - A user with multiple roles including “Audit Admin” still has access.
      - Role changes while a session is active should not immediately revoke access until the next authentication.
    dependencies: []

  - id: FR-0115
    description: The system shall capture the patient’s IANA time‑zone identifier either through explicit user selection or inference from the patient’s device/browser.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a patient accessing the scheduling page, when the patient selects a time‑zone from a drop‑down list, then the selected IANA identifier must be stored in the session.
      - Given a patient accesses the scheduling page without selecting a time‑zone, when the system infers the time‑zone from the device/browser, then the inferred IANA identifier must be stored in the session.
    edge_cases:
      - Patient selects an unsupported or invalid IANA time‑zone string (e.g., "Invalid/Zone").
      - Browser does not provide time‑zone information and the patient does not select one.
    dependencies: []

  - id: FR-0116
    description: The system shall convert a patient‑selected local appointment time to the clinic’s configured local time‑zone and display the converted time to the patient for confirmation.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given the patient’s original datetime and time‑zone, when the system performs the conversion, then the resulting datetime must be in the clinic’s time‑zone.
      - Given the patient confirms the appointment, the converted datetime must be persisted in the appointment record.
    edge_cases:
      - Appointment time falls on a daylight‑saving time transition boundary.
      - Appointment time falls on a leap second (e.g., 23:59:60 UTC).
    dependencies:
      - FR-0115

  - id: FR-0117
    description: The system shall persist both the patient’s original datetime (with time‑zone information) and the converted clinic‑local datetime in the appointment record.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given an appointment is created, when the record is queried, then both original and converted datetimes are present and correctly formatted.
    edge_cases:
      - Database write failure during persistence.
      - Time‑zone data missing in the appointment payload.
    dependencies:
      - FR-0116

  - id: FR-0118
    description: The system shall validate time‑zone conversions through automated unit tests covering at least 95 % of active IANA zones, including DST transitions and leap seconds.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - All unit tests must pass with 100 % correct conversion results.
      - Test coverage report must indicate ≥95 % coverage of IANA zones.
    edge_cases:
      - New IANA zones added after deployment without corresponding tests.
    dependencies: []

  - id: FR-0119
    description: The system shall provide graceful error handling and fallback when a patient’s time‑zone cannot be determined.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given the time‑zone is unknown, when the patient attempts to schedule, then the system prompts the patient to select a time‑zone or defaults to the clinic’s time‑zone with a warning message.
      - The appointment can still be created after fallback selection.
    edge_cases:
      - Patient repeatedly fails to provide a valid time‑zone.
    dependencies:
      - FR-0115

  - id: FR-0120
    description: The system shall expose a RESTful API endpoint `/convert-timezone` that accepts a datetime and IANA time‑zone, returns the converted datetime in the clinic’s time‑zone, and supports batch conversion for up to 100 entries per request.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - POST `/convert-timezone` with valid payload returns 200 OK and correct conversion within 10 ms.
      - POST with invalid time‑zone returns 400 Bad Request with descriptive error.
      - Batch request with 100 entries processes all conversions successfully.
    edge_cases:
      - Payload exceeds maximum size (e.g., >100 entries).
      - Mixed valid and invalid time‑zones in batch.
    dependencies:
      - FR-0116

  - id: FR-0121
    description: Detect loss of connectivity to the external doctor calendar service and transition the system into offline mode.
    priority: Critical
    related_usecase:
      - USER_STORY-0020
    acceptance_criteria:
      - Given the system is connected to the doctor calendar service, when the network fails, then the system must detect the loss within 2 seconds and enter offline mode.
      - Given the system is in offline mode, then all subsequent scheduling actions must be marked as pending until reconnection.
    edge_cases:
      - Connectivity drops during a scheduling change; the change must still be captured locally without data corruption.
      - Temporary blips (less than 2 seconds) should not trigger offline mode.
    dependencies: []

  - id: FR-0122
    description: Capture and persist all scheduling changes locally while the system is offline.
    priority: Critical
    related_usecase:
      - USER_STORY-0020
    acceptance_criteria:
      - Given the system is offline, when a user creates, updates, or deletes an appointment, then the change must be written to a local persistent store within 200 ms.
      - Given a change is persisted locally, then it must be retrievable in the original order for replay.
    edge_cases:
      - The local storage becomes full; the system must reject new changes with a clear error message.
      - The system receives malformed appointment data; it must validate and reject with a descriptive error.
    dependencies:
      - FR-0121

  - id: FR-0123
    description: Maintain a per-doctor queue of pending changes, preserving the order of operations.
    priority: High
    related_usecase:
      - USER_STORY-0020
    acceptance_criteria:
      - Given multiple pending changes for the same doctor, then the queue must reflect the exact sequence of user actions.
      - Given a change is queued, then its metadata (timestamp, user id, operation type) must be stored.
    edge_cases:
      - Simultaneous changes from multiple devices for the same doctor; the system must merge them without loss.
      - A change for a doctor that has been removed from the system must be flagged as invalid during replay.
    dependencies:
      - FR-0122

  - id: FR-0124
    description: Detect reconnection to the doctor calendar service and automatically trigger replay of queued changes in original order.
    priority: Critical
    related_usecase:
      - USER_STORY-0020
    acceptance_criteria:
      - Given the system regains connectivity, then it must begin replaying queued changes within 1 second of reconnection.
      - Given a change is replayed, then the system must confirm success with the external service before removing it from the queue.
    edge_cases:
      - Reconnection occurs while a replay is in progress; the system must queue new changes without interrupting current replay.
      - External service rejects a change; the system must log the failure and proceed to the next change.
    dependencies:
      - FR-0121
      - FR-0123

  - id: FR-0125
    description: Verify replay success, handle failures with a retry mechanism, and flag changes that exceed retry limits for manual intervention.
    priority: Critical
    related_usecase:
      - USER_STORY-0020
    acceptance_criteria:
      - Given a replay attempt fails, then the system must retry up to 3 times before marking the change as failed.
      - Given a change fails after 3 attempts, then it must be moved to a “Failed” queue and an alert generated.
    edge_cases:
      - Network flaps during retry; the system must not double‑count attempts.
      - The external service returns a transient error (HTTP 5xx); the system must treat it as retryable.
    dependencies:
      - FR-0124

  - id: FR-0126
    description: Prevent duplicate appointments during replay by detecting and discarding changes that would create duplicates.
    priority: High
    related_usecase:
      - USER_STORY-0020
    acceptance_criteria:
      - Given a change would result in an appointment identical to an existing one, then the system must skip replaying that change and log the duplication.
      - Given a change is skipped due to duplication, then it must still be removed from the pending queue.
    edge_cases:
      - Time zone differences cause apparent duplicates; the system must normalize times before comparison.
      - Concurrent replays from multiple devices; duplicates must be detected across all queues.
    dependencies:
      - FR-0125

  - id: FR-0127
    description: Provide an audit trail of all replayed changes, including success, failure, and duplicate skips, accessible to administrators.
    priority: Medium
    related_usecase:
      - USER_STORY-0020
    acceptance_criteria:
      - Given any replayed change, then an audit record must exist with timestamp, operation type, outcome, and error details if any.
      - Given an administrator requests the audit trail, then the system must return the records within 2 seconds for up to 10,000 entries.
    edge_cases:
      - Audit logs become corrupted; the system must detect corruption and alert an administrator.
      - Large volumes of logs (over 10,000 entries) must still be retrievable within the time constraint.
    dependencies:
      - FR-0125

  - id: FR-0128
    description: Allow users to manually trigger replay of pending changes or cancel them before replay.
    priority: Low
    related_usecase:
      - USER_STORY-0020
    acceptance_criteria:
      - Given a user initiates a manual replay, then the system must process the queue immediately, overriding automatic triggers.
      - Given a user cancels a pending change, then the change must be removed from the queue and marked as cancelled in the audit trail.
    edge_cases:
      - User cancels a change that is currently being replayed; the system must wait until replay completes before marking cancelled.
      - Multiple users attempt to cancel the same change simultaneously; the system must handle concurrency without data loss.
    dependencies:
      - FR-0123

  - id: FR-0129
    description: The system must trigger a push, email, or SMS notification immediately when a slot is confirmed.
    priority: Critical
    related_usecase:
      - USE_CASE-0001  # Slot Confirmation
    acceptance_criteria:
      - Given a slot is confirmed, when the confirmation event is processed, then a notification is queued for all registered channels.
      - Given a notification is queued, when the delivery service processes it, then the notification is sent to the patient and doctor within the system‑defined delivery window.
    edge_cases:
      - The patient’s phone number is missing; the system should log the failure and skip SMS but still send email/push if available.
      - The notification service is temporarily unavailable; the system should retry up to 3 times before marking as failed.
    dependencies:
      - FR-0132  # Channel preference configuration

  - id: FR-0130
    description: The system must trigger a push, email, or SMS notification immediately when a slot is changed (date, time, or other attributes).
    priority: Critical
    related_usecase:
      - USE_CASE-0002  # Slot Change
    acceptance_criteria:
      - Given a slot change event, when the event is processed, then a notification containing the updated slot details is queued for all registered channels.
      - Given the notification is sent, when the patient or doctor acknowledges receipt, the system records the acknowledgment timestamp.
    edge_cases:
      - The change is a no‑op (e.g., same date/time); the system should not send a notification.
      - The patient has disabled notifications for that doctor; the system should respect the preference and skip sending.
    dependencies:
      - FR-0132
      - FR-0133

  - id: FR-0131
    description: The system must trigger a push, email, or SMS notification immediately when a slot is resolved (canceled or marked as no‑show).
    priority: Critical
    related_usecase:
      - USE_CASE-0003  # Slot Resolution
    acceptance_criteria:
      - Given a slot resolution event, when the event is processed, then a notification indicating the resolution is queued for all registered channels.
      - Given the notification is sent, when the patient or doctor acknowledges receipt, the system records the acknowledgment timestamp.
    edge_cases:
      - The slot was already canceled earlier; the system should not send a duplicate notification.
      - The patient’s contact details are invalid; the system should log and retry after 30 minutes.
    dependencies:
      - FR-0132
      - FR-0133

  - id: FR-0132
    description: The system must allow patients and doctors to configure preferred notification channels (push, email, SMS) and opt‑out of specific channels during registration or via settings.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a user accesses the notification settings page, when they select or deselect channels, then the system persists the preference.
      - Given a user has opted out of SMS, when a notification is triggered, then the system does not queue SMS for that user.
    edge_cases:
      - The user selects all channels but only one contact detail is valid; the system should still attempt delivery on valid channels.
      - The user changes preferences after a notification is queued; the system should respect the preference at send time, not at queue time.
    dependencies: []

  - id: FR-0133
    description: The system must record and expose acknowledgment status for each notification sent to patients and doctors.
    priority: Medium
    related_usecase:
      - USE_CASE-0004  # Notification Acknowledgment
    acceptance_criteria:
      - Given a notification is sent, when the recipient clicks the acknowledgment link or replies, then the system records the acknowledgment with a timestamp.
      - Given a notification is not acknowledged within 24 hours, the system flags it as “unacknowledged” for reporting purposes.
    edge_cases:
      - The acknowledgment link is clicked after the notification has expired; the system should still record the acknowledgment but mark it as “late”.
      - The recipient clicks multiple times; the system should record only the first acknowledgment.
    dependencies:
      - FR-0130
      - FR-0131

  - id: FR-0134
    description: |
      The system must automatically trigger a recalculation of the crowd level metric immediately after any booking or cancellation event.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a booking or cancellation event is persisted, when the event is processed, then the crowd metric calculation routine is invoked.
      - Given the calculation routine completes, when the metric is stored, then the new value is persisted in the metric store with a timestamp.
    edge_cases:
      - The event payload is missing required booking identifiers; the system should log the error and skip calculation.
      - Duplicate booking/cancellation events arrive; the calculation should be idempotent and not double‑count.
      - Calculation fails due to temporary data store unavailability; the system should retry once and then mark the metric as stale for a short grace period.
    dependencies: []

  - id: FR-0135
    description: |
      The system must broadcast the updated crowd metric to all dependent services (booking interface, analytics dashboard, and any third‑party APIs) within the same transaction as the metric persistence.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a new metric is persisted, when the broadcast routine runs, then each registered service receives a message containing the metric value and timestamp.
      - Given a broadcast message is sent, when the receiving service acknowledges, then the acknowledgment is logged and the metric is considered delivered.
    edge_cases:
      - A dependent service is temporarily unreachable; the system should queue the message and retry with exponential back‑off.
      - The broadcast payload exceeds size limits; the system should truncate or split the payload and log the incident.
      - Message delivery fails after maximum retries; an alert is generated and the metric is marked as pending delivery.
    dependencies:
      - FR-0134

  - id: FR-0136
    description: |
      Subsequent slot selection queries performed by users must read the most recent crowd metric, ensuring that availability reflects the current crowd level.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a user opens the slot selection UI after a booking/cancellation event, when the UI requests availability, then it receives data that incorporates the latest metric value.
      - Given the metric store contains a fresh metric, when a slot check is performed, then no stale metric (older than 5 seconds) is used.
    edge_cases:
      - Network latency causes a delay in fetching the metric; the UI should display a loading indicator and retry automatically.
      - The metric store returns no value (e.g., during initialization); the system should default to a conservative availability assumption and display a warning.
      - Concurrent slot checks from multiple devices; the system must serialize reads to avoid race conditions.
    dependencies:
      - FR-0135

  - id: FR-0137
    description: |
      If the metric calculation fails or the broadcast cannot be completed within a 30‑second grace period, the system must fall back to the most recently successful metric and trigger an operational alert.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a calculation or broadcast failure persists beyond 30 seconds, when the fallback mechanism activates, then the last known good metric is used for all subsequent slot checks.
      - Given the fallback is activated, when an alert is sent, then the alert contains the event ID, failure reason, and timestamp.
    edge_cases:
      - The last known good metric is older than 5 minutes; the system should still use it but flag the data as potentially stale.
      - Multiple failures occur in rapid succession; the system should avoid alert flooding by aggregating alerts within a 5‑minute window.
      - The fallback metric is corrupted; the system must detect corruption and revert to a default safe state (e.g., assume full capacity).
    dependencies:
      - FR-0134

  - id: FR-0138
    description: |
      The system must log every crowd metric update event, including source event ID, calculation status, latency, and any errors, for audit and troubleshooting purposes.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given a metric update process completes, when the log entry is created, then it contains the event ID, timestamp, metric value, status (success/failure), and latency in milliseconds.
      - Given a log entry is stored, when a compliance audit is performed, then the entry is retrievable within 24 hours.
    edge_cases:
      - Log storage is temporarily unavailable; the system should buffer logs and retry persistence.
      - Log entry size exceeds limits; the system should truncate non-essential fields and flag the truncation.
      - Duplicate log entries due to retry logic; the system should deduplicate based on event ID and timestamp.
    dependencies:
      - FR-0134

  - id: FR-0139
    description: The system must encrypt all patient data at rest using AES‑256 before it is written to persistent storage.
    priority: Critical
    related_usecase:
      - USE_CASE-0024
    acceptance_criteria:
      - Given patient data is submitted, when the system stores the data, then the stored representation must be encrypted with AES‑256.
      - Given a data retrieval request, when the data is read from storage, then it must be decrypted correctly to its original form.
    edge_cases:
      - If the encryption key is unavailable, the system must reject the write operation and return an error code 503.
      - If the data size exceeds the maximum block size, the system must chunk the data and encrypt each chunk independently.
    dependencies: []

  - id: FR-0140
    description: The system must encrypt all appointment data at rest using AES‑256 before it is written to persistent storage.
    priority: Critical
    related_usecase:
      - USE_CASE-0024
    acceptance_criteria:
      - Given appointment data is submitted, when the system stores the data, then the stored representation must be encrypted with AES‑256.
      - Given an appointment retrieval request, when the data is read from storage, then it must be decrypted correctly to its original form.
    edge_cases:
      - If the encryption key is unavailable, the system must reject the write operation and return an error code 503.
      - If the appointment data contains large binary attachments, the system must encrypt each attachment separately.
    dependencies: []

  - id: FR-0141
    description: The system must protect all patient and appointment data in transit by using TLS 1.2 or higher for every network channel.
    priority: Critical
    related_usecase:
      - USE_CASE-0024
    acceptance_criteria:
      - Given a client initiates a request, when the server responds, then the connection must use TLS 1.2+ with a valid server certificate.
      - Given a data transfer between micro‑services, when the data is sent, then the channel must enforce TLS 1.2+ and reject any downgrade attempts.
    edge_cases:
      - If a client does not support TLS 1.2, the system must terminate the connection with an appropriate error.
      - If the server certificate expires, the system must refuse the connection until a valid certificate is installed.
    dependencies: []

  - id: FR-0142
    description: The system must manage encryption keys via a secure Key Management Service (KMS) that supports automatic key rotation.
    priority: Critical
    related_usecase:
      - USE_CASE-0024
    acceptance_criteria:
      - Given a new encryption key is required, when the system requests it from the KMS, then the KMS must return a key that is compliant with AES‑256.
      - Given the system is configured for automatic rotation, when the rotation period elapses, then the KMS must rotate the key without manual intervention.
    edge_cases:
      - If the KMS is temporarily unavailable, the system must queue the key request and retry until the KMS is reachable.
      - If the KMS returns a key that does not meet the required strength, the system must reject the key and log an alert.
    dependencies: []

  - id: FR-0143
    description: The system must enforce key rotation every 90 days and retain revoked keys for 24 months.
    priority: High
    related_usecase:
      - USE_CASE-0024
    acceptance_criteria:
      - Given the current key age exceeds 90 days, when a new operation is performed, then the system must use the rotated key.
      - Given a key is revoked, when a request for that key is made, then the system must return the most recent active key and retain the revoked key for audit purposes.
    edge_cases:
      - If the rotation schedule is missed due to system downtime, the system must trigger an alert and rotate immediately upon recovery.
      - If a revoked key is needed for data recovery, the system must provide the key within a defined recovery window.
    dependencies:
      - FR-0142

  - id: FR-0144
    description: The system must restrict decryption rights to authorized roles only, enforcing role‑based access control.
    priority: Critical
    related_usecase:
      - USE_CASE-0024
    acceptance_criteria:
      - Given a user with role “Data Analyst” requests decryption, when the system checks permissions, then it must allow decryption if the role is authorized.
      - Given a user with an unauthorized role requests decryption, when the system checks permissions, then it must deny access and log the attempt.
    edge_cases:
      - If role assignments are updated while a decryption session is active, the system must invalidate the session.
      - If a role is misconfigured to have decryption rights, the system must detect the anomaly during audit.
    dependencies: []

  - id: FR-0145
    description: The system must log all encryption, decryption, and key‑management events in a tamper‑proof audit trail.
    priority: Critical
    related_usecase:
      - USE_CASE-0024
    acceptance_criteria:
      - Given an encryption event occurs, when the system logs the event, then the log entry must include a timestamp, user ID, operation type, key ID, and a cryptographic hash of the operation.
      - Given a decryption event occurs, when the system logs the event, then the log entry must be appended to the immutable log store.
    edge_cases:
      - If the audit log store is temporarily unavailable, the system must buffer logs locally and flush them once the store is reachable.
      - If a log entry fails integrity verification, the system must flag the entry and prevent further writes until resolved.
    dependencies: []

  - id: FR-0146
    description: The system must provide a compliance report that verifies 100 % of patient and appointment data are encrypted at rest and in transit.
    priority: High
    related_usecase:
      - USE_CASE-0024
    acceptance_criteria:
      - Given a report request, when the system generates the report, then it must list all data entities and indicate encryption status for both rest and transit.
      - Given the report is exported, when a compliance audit reviews it, then the audit must confirm that all listed entities are marked as encrypted.
    edge_cases:
      - If new data types are added after report generation, the system must flag the report as out‑of‑date and require regeneration.
      - If a data entity fails encryption verification, the report must highlight the entity with a remediation suggestion.
    dependencies:
      - FR-0139
      - FR-0140
      - FR-0141

  - id: FR-0147
    description: The system must ensure all external integrations (EHR, billing, analytics) use secure channels compliant with TLS 1.2+.
    priority: High
    related_usecase:
      - USE_CASE-0024
    acceptance_criteria:
      - Given an integration endpoint is configured, when the system initiates a connection, then it must negotiate TLS 1.2+ and verify the endpoint’s certificate chain.
      - Given an integration fails to provide TLS 1.2+, when the system attempts a connection, then it must reject the connection and log the failure.
    edge_cases:
      - If an integration endpoint temporarily supports only TLS 1.1, the system must queue the request until the endpoint upgrades.
      - If certificate revocation is detected, the system must terminate the connection and alert administrators.
    dependencies: []

  - id: FR-0148
    description: The system shall display all upcoming appointments in a calendar view (month, week, and day modes) when the scheduler opens the calendar.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given the scheduler opens the calendar, when the view loads, then all appointments scheduled for the next 30 days are visible in the selected view mode.
      - Given the scheduler has no appointments scheduled for the next 30 days, when the calendar loads, then a message “No upcoming appointments” is displayed.
    edge_cases:
      - The system receives an empty appointment list from the API.
      - The API returns appointments with missing start or end times.
    dependencies: []

  - id: FR-0149
    description: The system shall highlight any appointments that conflict (overlap in time) for the same resource within the calendar view.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given two appointments for the same resource overlap in time, when the calendar renders, then both appointments are visually marked with a conflict indicator (e.g., red border).
      - Given no overlapping appointments exist for a resource, when the calendar renders, then no conflict indicators are shown for that resource.
    edge_cases:
      - Appointments that start or end at the same time as another appointment.
      - Overlaps that span midnight or daylight‑saving time changes.
    dependencies:
      - FR-0148

  - id: FR-0150
    description: The system shall allow the scheduler to switch between month, week, and day calendar views.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given the scheduler clicks the “Week” view button, when the view changes, then the calendar displays a 7‑day grid centered on the current date.
      - Given the scheduler selects a date in month view, when the day view button is clicked, then the calendar displays the 24‑hour grid for that date.
    edge_cases:
      - Switching views when the calendar is still loading data.
      - Switching views on a device with a screen width below 768px.
    dependencies:
      - FR-0148

  - id: FR-0151
    description: The system shall provide filtering capabilities by resource, date range, and appointment status.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given the scheduler selects a resource from the filter dropdown, when the filter is applied, then only appointments for that resource are displayed.
      - Given the scheduler sets a start and end date, when the filter is applied, then only appointments within that range are displayed.
    edge_cases:
      - The scheduler selects a future date range that contains no appointments.
      - The scheduler applies multiple filters simultaneously (resource + status + date range).
    dependencies:
      - FR-0148

  - id: FR-0152
    description: The system shall provide a search bar that allows the scheduler to search appointments by patient name or notes.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given the scheduler types “John Doe” into the search bar, when the search is executed, then only appointments containing “John Doe” in the patient name or notes are displayed.
      - Given the scheduler clears the search input, when the search is executed, then all appointments are displayed again.
    edge_cases:
      - The search input contains special characters or SQL injection attempts.
      - The scheduler searches for a term that matches no appointments.
    dependencies:
      - FR-0148

  - id: FR-0153
    description: The system shall automatically detect and notify the scheduler of any conflicts within 5 minutes of opening the calendar view.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given the scheduler opens the calendar, when conflicts are detected, then a notification banner appears within 5 minutes stating “Conflicts detected: X appointments”.
      - Given there are no conflicts, when the scheduler opens the calendar, then no conflict notification banner is shown.
    edge_cases:
      - The scheduler opens the calendar during a network outage; conflict detection must still be attempted using cached data.
      - The scheduler opens the calendar immediately after a conflict resolution; the notification should not appear until a new conflict is detected.
    dependencies:
      - FR-0148
      - FR-0149

  - id: FR-0154
    description: The system shall cache appointment data on the client side for 30 seconds to reduce API calls.
    priority: Low
    related_usecase: []
    acceptance_criteria:
      - Given the scheduler opens the calendar, when the data is fetched, then the response is stored in local storage with a timestamp.
      - Given the scheduler opens the calendar again within 30 seconds, when the calendar loads, then the cached data is used instead of making a new API request.
    edge_cases:
      - The cached data expires exactly at the moment the scheduler opens the calendar.
      - The cached data is corrupted or incomplete.
    dependencies:
      - FR-0148

  - id: FR-0155
    description: The system shall provide full keyboard navigation and screen reader support for all interactive elements in the calendar view.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given the scheduler focuses on the calendar grid, when the user presses the arrow keys, then the focus moves to the adjacent date cell.
      - Given the scheduler uses a screen reader, when the calendar loads, then all appointment entries are announced with patient name, time, and resource.
    edge_cases:
      - The scheduler uses a custom keyboard shortcut that conflicts with the calendar navigation.
      - The scheduler navigates to a date cell that contains no appointments.
    dependencies:
      - FR-0148

  - id: FR-0156
    description: The system shall provide an appointment detail modal that opens on click, showing patient name, attending staff, notes, and status, read‑only for schedulers.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given the scheduler clicks an appointment cell, when the modal opens, then it displays all appointment details and a “Close” button.
      - Given the scheduler is a scheduler role, when the modal opens, then all fields are read‑only and no edit buttons are visible.
    edge_cases:
      - The scheduler clicks an appointment cell that has missing notes.
      - The scheduler opens the modal on a touch device; modal must be accessible via tap.
    dependencies:
      - FR-0148

  - id: FR-0157
    description: The system shall display the resource name and appointment status within each calendar cell for quick reference.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given an appointment cell contains a doctor’s name and status “Confirmed”, when the cell is rendered, then the doctor’s name and status label are visible.
      - Given an appointment cell contains multiple appointments, when the cell is rendered, then a “+N more” indicator appears with a tooltip listing the additional appointments.
    edge_cases:
      - The appointment status is “Cancelled” but the cell still shows the appointment; it must be visually distinguished (e.g., gray text).
      - The resource name is longer than the cell width; text must truncate with ellipsis.
    dependencies:
      - FR-0148

  - id: FR-0158
    description: The system shall provide a manual refresh button that re‑fetches appointment data from the scheduling API.
    priority: Low
    related_usecase: []
    acceptance_criteria:
      - Given the scheduler clicks the “Refresh” button, when the action is performed, then the calendar data is re‑fetched and the view is updated.
      - Given the scheduler clicks the “Refresh” button while a previous refresh is still in progress, when the action is performed, then the new request is queued and executed after the current one completes.
    edge_cases:
      - The scheduler clicks refresh during a network outage; the system must display an error message and retain the current view.
      - The scheduler clicks refresh rapidly multiple times; the system must debounce the requests.
    dependencies:
      - FR-0148

  - id: FR-0159
    description: The system shall provide a searchable, paginated dropdown list of providers for the user to select from when filtering the schedule.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given the user is on the schedule view, when the provider dropdown is opened, then the list of providers is displayed and searchable by name or ID.
      - Given the user types a provider name, when the search input changes, then the list updates in real‑time to match the query.
    edge_cases:
      - The provider list is empty – the system should display “No providers available” and disable the filter button.
      - The provider name contains special characters – the system must escape or encode input to prevent injection attacks.
    dependencies: []

  - id: FR-0160
    description: The system shall provide a start date and end date picker that allows the user to select a contiguous date range for filtering appointments.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given the user is on the schedule view, when the date picker is opened, then a calendar UI is displayed allowing selection of a start and end date.
      - Given the user selects a start date after the end date, when the filter is applied, then an error message “Start date must be before end date” is shown and the filter is not applied.
    edge_cases:
      - The user selects a date range that spans more than 90 days – the system should warn “Large date ranges may affect performance” and allow the user to proceed.
      - The user selects a date outside the supported calendar range – the system should clamp to the nearest valid date and notify the user.
    dependencies: []

  - id: FR-0161
    description: The system shall apply the selected provider and date range to the schedule view, displaying only appointments that match both criteria.
    priority: Critical
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given a provider and a valid date range are selected, when the filter button is clicked, then the schedule view updates to show only matching appointments.
      - Given no appointments match the filter, when the filter is applied, then the view displays “No appointments found for the selected criteria.”
    edge_cases:
      - The filter is applied while the network is down – the system should retry automatically up to 3 times and then display an error message.
      - The provider selection is changed after a date range is set – the system should reapply the filter with the new provider.
    dependencies:
      - FR-0159
      - FR-0160

  - id: FR-0162
    description: The system shall persist the filter settings for the duration of the user session and optionally store them in user preferences for future sessions.
    priority: High
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given a user applies a filter, when the user navigates away from the schedule page and returns within the same session, then the previous filter settings are restored automatically.
      - Given the user chooses to save preferences, when the filter is applied, then the settings are stored and applied on subsequent logins.
    edge_cases:
      - The session expires before the user returns – the system should prompt to reapply the filter.
      - The user logs in from a different device – the stored preferences should not override the device-specific session settings.
    dependencies:
      - FR-0161

  - id: FR-0163
    description: The system shall provide a “Clear Filter” action that resets all filter controls to their default state and reloads the full appointment schedule.
    priority: Medium
    related_usecase:
      - USE_CASE-0001
    acceptance_criteria:
      - Given a filter is active, when the user clicks “Clear Filter”, then the provider dropdown resets to “All Providers”, the date range resets to the default, and the full schedule is displayed.
      - Given the user has unsaved filter changes, when the user clicks “Clear Filter”, then no changes are persisted until a new filter is applied.
    edge_cases:
      - The user clicks “Clear Filter” while a filter request is in progress – the system should cancel the request and reset the UI immediately.
      - The “Clear Filter” button is disabled when no filter is active – the system should reflect this state.
    dependencies:
      - FR-0161

  - id: FR-0164
    description: |
      The system must allow a Clinic Scheduler to drag an existing appointment
      element from its current time slot to any other available time slot on
      the calendar interface.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given an appointment is displayed on the calendar,
        When the user clicks and holds the appointment,
        Then the appointment element follows the cursor and can be released into a different slot.
      - Given the user drags an appointment outside the calendar bounds,
        When the user releases the mouse button,
        Then the appointment returns to its original slot.
    edge_cases:
      - Dragging an appointment to a slot that is disabled due to maintenance.
      - Dragging an appointment to a slot that is already fully booked.
    dependencies: []

  - id: FR-0165
    description: |
      The system must validate the target time slot upon drop, ensuring that the
      doctor, patient, and room are all available, and reject the drop if any
      constraint is violated.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a user drops an appointment into a new slot,
        When the system checks availability,
        Then the appointment is rescheduled if all constraints are satisfied.
      - Given a user drops an appointment into a conflicting slot,
        When the system detects a conflict,
        Then the drop is rejected and an error message is displayed.
    edge_cases:
      - Dropping into a slot that becomes unavailable between drag start and drop.
      - Dropping into a slot that crosses a daylight‑saving time boundary.
    dependencies:
      - FR-0164

  - id: FR-0166
    description: |
      During the drag operation the system must provide real‑time visual feedback,
      highlighting available slots, indicating conflicts, and showing a preview
      of the appointment duration.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a user drags an appointment over the calendar,
        When the cursor hovers over a time slot,
        Then that slot is highlighted and the appointment preview is displayed.
      - Given a slot is unavailable,
        When the cursor hovers over it,
        Then the slot is marked with a conflict icon and the cursor changes to a “not‑allowed” symbol.
    edge_cases:
      - Rapid cursor movement causing flickering of highlights.
      - Screen readers failing to announce slot status changes.
    dependencies:
      - FR-0164

  - id: FR-0167
    description: |
      After a successful reschedule, the system must provide an undo option that
      remains available for 30 seconds, allowing the user to revert the change.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a reschedule is completed,
        When the user clicks the undo button within 30 seconds,
        Then the appointment returns to its original slot and all related data is restored.
      - Given the 30‑second window expires,
        When the user attempts to undo,
        Then the undo action is disabled and a message indicates expiration.
    edge_cases:
      - Undo attempted after the appointment has been canceled by another user.
      - Undo attempted when the network connection is lost.
    dependencies:
      - FR-0165

  - id: FR-0168
    description: |
      The system must log every reschedule action, capturing the user performing
      the action, original and new slot times, and timestamps for audit purposes.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given a reschedule occurs,
        When the action is processed,
        Then a log entry is created containing user ID, appointment ID, original time, new time, and timestamp.
      - Given a log entry is queried,
        When an auditor requests it,
        Then the entry is returned with all required fields.
    edge_cases:
      - Log entry missing due to database write failure.
      - Log entry corrupted by concurrent write conflicts.
    dependencies:
      - FR-0165

  - id: FR-0169
    description: |
      Upon a successful reschedule, the system must send email and SMS notifications
      to the patient and the assigned doctor, confirming the new appointment time.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a reschedule is committed,
        When the system processes notifications,
        Then both email and SMS are sent to the patient and doctor within 10 seconds.
      - Given a notification fails to send,
        When the system retries,
        Then it attempts up to three times and logs the failure.
    edge_cases:
      - Patient’s phone number is invalid or blocked.
      - Email service is temporarily unavailable.
    dependencies:
      - FR-0165

  - id: FR-0170
    description: |
      The system must provide a user interface that allows a Clinic Scheduler to cancel an existing appointment
      directly from either the appointment list view or the appointment detail view.
    priority: Critical
    related_usecase:
      - USE_CASE-0028
    acceptance_criteria:
      - Given a scheduler is logged in and viewing the appointment list, when they click the “Cancel” button on an appointment, then the cancellation workflow is initiated.
      - Given a scheduler is viewing an appointment detail page, when they click the “Cancel” button, then the cancellation workflow is initiated.
    edge_cases:
      - The appointment has already been cancelled; the UI should display a message “Appointment already cancelled” and disable the cancel button.
      - The scheduler attempts to cancel an appointment that does not exist; the system returns a 404 error and logs the attempt.
    dependencies:
      - []

  - id: FR-0171
    description: |
      The system must enforce that a cancellation reason is entered before a scheduler can confirm the cancellation.
    priority: Critical
    related_usecase:
      - USE_CASE-0028
    acceptance_criteria:
      - Given the cancellation workflow is initiated, when the scheduler attempts to confirm without selecting or typing a reason, then the system displays a validation error and prevents submission.
      - Given the scheduler provides a reason, when they confirm, then the cancellation proceeds.
    edge_cases:
      - The reason field contains only whitespace; the system treats it as empty and shows a validation error.
      - The reason exceeds the maximum allowed length (e.g., 255 characters); the system truncates or rejects the input with a clear message.
    dependencies:
      - FR-0170

  - id: FR-0172
    description: |
      The system must record an audit log entry for every manual cancellation that includes the user ID, appointment ID, cancellation reason, and timestamp.
    priority: Critical
    related_usecase:
      - USE_CASE-0028
    acceptance_criteria:
      - Given a cancellation is performed, then an audit record is created in the audit table with all required fields populated.
      - The timestamp recorded must be in UTC and include timezone offset information.
    edge_cases:
      - The audit table is temporarily unavailable; the system retries up to 3 times before failing the cancellation.
      - The system clock is out of sync by more than 5 seconds; the timestamp recorded is still accurate relative to the server clock.
    dependencies:
      - FR-0171

  - id: FR-0173
    description: |
      The system must update the clinic calendar in real‑time so that the cancelled slot becomes available for booking immediately after a successful cancellation.
    priority: High
    related_usecase:
      - USE_CASE-0028
    acceptance_criteria:
      - Given a cancellation is successful, then the slot appears as “Available” in the calendar view within 2 seconds.
      - The slot remains unavailable for any other user until the cancellation is committed.
    edge_cases:
      - A second scheduler attempts to book the same slot within 1 second of the cancellation; the system ensures the slot is not double-booked.
      - The calendar view is cached; the system invalidates the cache immediately after cancellation.
    dependencies:
      - FR-0172

  - id: FR-0174
    description: |
      The system must restrict cancellation capability to users who possess the “Scheduler” role; other roles may view but not cancel appointments.
    priority: Critical
    related_usecase:
      - USE_CASE-0028
    acceptance_criteria:
      - Given a user with the Scheduler role, the “Cancel” button is visible and enabled.
      - Given a user without the Scheduler role, the “Cancel” button is hidden or disabled, and an attempt to trigger cancellation via API returns a 403 Forbidden.
    edge_cases:
      - A user’s role is changed from Scheduler to Viewer during an active cancellation session; the system revokes cancellation ability immediately.
      - The role assignment is cached; the system refreshes role permissions within 30 seconds of a change.
    dependencies:
      - FR-0170

  - id: FR-0175
    description: |
      The system must provide robust error handling for cancellation failures, ensuring the UI reverts any optimistic changes and displays a clear error message.
    priority: High
    related_usecase:
      - USE_CASE-0028
    acceptance_criteria:
      - Given a cancellation fails due to a database rollback, then the UI restores the original appointment state and shows an error dialog “Cancellation failed. Please try again.”
      - The error message includes a reference number that can be used in support tickets.
    edge_cases:
      - The failure occurs after the slot has already been marked available in the UI; the system reverts the slot to booked.
      - The failure occurs while the user is offline; the system queues the cancellation request and retries when connectivity is restored.
    dependencies:
      - FR-0170
      - FR-0171

  - id: FR-0176
    description: |
      The system must allow a user with the “Clinic Scheduler” role to force schedule an appointment in a time slot that differs from the AI’s suggested slot, after confirming the override.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a scheduler with override permission, when the scheduler selects a non‑AI suggested slot and confirms, then the appointment is created in the chosen slot.
      - Given the selected slot is already booked, when the scheduler attempts to force schedule, then the system displays an error and does not create the appointment.
    edge_cases:
      - Scheduler attempts to force schedule a slot that is in the past; system rejects with a “cannot schedule past appointments” message.
      - Scheduler tries to force schedule for a patient who already has an overlapping appointment; system rejects with a conflict notice.
    dependencies: []

  - id: FR-0177
    description: |
      The system must present a confirmation dialog that requires explicit user acknowledgement before finalizing a forced appointment.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given the scheduler initiates a forced schedule, when the confirmation dialog appears, then the scheduler must click “Confirm” to proceed.
      - Given the scheduler clicks “Cancel” on the confirmation dialog, then no appointment is created and the system returns to the scheduler’s view.
    edge_cases:
      - Confirmation dialog fails to load due to network latency; system retries once before showing an error.
    dependencies: []

  - id: FR-0178
    description: |
      The system must capture and store a mandatory reason for each forced appointment, entered by the scheduler during the override process.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given the scheduler confirms a forced appointment, when they provide a reason, then the reason is persisted in the appointment record.
      - Given the scheduler attempts to confirm without entering a reason, then the system blocks confirmation and prompts for a reason.
    edge_cases:
      - Reason exceeds maximum length (e.g., 500 characters); system truncates to 500 characters and logs a warning.
    dependencies: []

  - id: FR-0179
    description: |
      The system must create an immutable audit log entry for every forced appointment that records the scheduler’s identity, timestamp, original AI suggestion, chosen slot, and reason for override.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a forced appointment is created, then an audit log record containing all required fields is written to the audit store.
      - Given an audit log entry is queried, then it cannot be modified or deleted by standard users.
    edge_cases:
      - System crash occurs immediately after audit log write; audit log must still be present upon recovery.
    dependencies: []

  - id: FR-0180
    description: |
      The system must enforce role‑based access control, allowing only users with the “Clinic Scheduler” role or higher to perform forced scheduling.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a user without the “Clinic Scheduler” role attempts to access the forced scheduling feature, then the system denies access with a 403 response.
      - Given a user with the role accesses the feature, then the UI enables the override controls.
    edge_cases:
      - User’s role is revoked while an override session is active; system logs the event and aborts the override.
    dependencies: []

  - id: FR-0181
    description: The system must display a grid view of each provider’s open slots for the selected date range, with each slot showing start time, end time, and provider name.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given the dashboard is accessed by a Scheduler, when the page loads, then the grid displays all open slots for the current week.
      - Given a provider has no open slots in the selected range, when the grid renders, then a “No available slots” message is shown for that provider.
    edge_cases:
      - Slot data is missing for a provider; the grid should skip that provider and log an error.
      - Time zone mismatch between provider and scheduler; the system must convert times to the scheduler’s local time zone.
    dependencies: []

  - id: FR-0182
    description: The system must overlay historical usage bars on the slot grid, representing the percentage of occupied slots per week for the past month.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given historical usage data exists, when the dashboard renders, then a bar is displayed above each week column indicating occupancy percentage.
      - Given no historical data for a week, when the dashboard renders, then the bar is omitted and a tooltip explains “No data available”.
    edge_cases:
      - Historical data contains null values; the system should treat them as 0% occupancy.
      - Data granularity is daily instead of weekly; the system must aggregate correctly.
    dependencies:
      - FR-0181

  - id: FR-0183
    description: The system must provide interactive filters allowing the user to filter by provider, specialty, and custom date range.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given the user selects a specialty, when the filter is applied, then only providers of that specialty are displayed.
      - Given the user selects a custom date range, when the filter is applied, then the grid updates to show slots only within that range.
    edge_cases:
      - User selects an invalid date range (start date after end date); the system must display an error message and prevent the filter.
      - No providers match the selected specialty; the system shows “No providers found”.
    dependencies:
      - FR-0181

  - id: FR-0184
    description: The system must display a timestamp indicating the last data refresh, and the timestamp must be accurate to the most recent 15‑minute refresh cycle.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given the dashboard loads, when the timestamp is displayed, then it shows the exact time of the last successful data refresh.
      - Given the data has not refreshed in the last 15 minutes, when the dashboard loads, then the timestamp indicates “Last refreshed 15+ minutes ago”.
    edge_cases:
      - Data refresh fails; the system must still show the previous successful timestamp and log the failure.
      - System clock drift; the timestamp must be derived from a synchronized time source.
    dependencies:
      - FR-0181

  - id: FR-0185
    description: The system must allow a Scheduler to click on an open slot to drill down and view appointment details or initiate a new booking, provided the user has the appropriate role.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given a Scheduler clicks an open slot, when the action is performed, then a modal opens with appointment details or a booking form.
      - Given a user without booking permissions clicks a slot, when the action is performed, then a “Permission denied” message is shown.
    edge_cases:
      - Slot becomes unavailable between click and modal display; the system must refresh the slot status and notify the user.
      - Booking form submission fails due to validation errors; the system displays inline error messages.
    dependencies:
      - FR-0181
      - FR-0186

  - id: FR-0186
    description: The system must enforce role‑based access control, allowing only Administrators and Schedulers to view the full dashboard; other staff see a limited view with only aggregated data.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a user with the Scheduler role logs in, when they access the dashboard, then they see the full grid and filters.
      - Given a user with the Staff role logs in, when they access the dashboard, then they see only aggregated occupancy bars and no slot details.
    edge_cases:
      - User’s role changes during a session; the system must refresh the view to reflect the new permissions.
      - Role assignment errors in the identity provider; the system must fallback to a safe default (restricted view) and log the incident.
    dependencies: []

  - id: FR-0187
    description: The system must render the dashboard in a mobile‑responsive layout, ensuring usability on devices with screen widths less than 768px.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given a device with a screen width of 360px, when the dashboard loads, then the grid is scrollable horizontally and all controls are accessible via touch.
      - Given a user taps a filter button on mobile, when the filter is applied, then the grid updates without a full page reload.
    edge_cases:
      - Very narrow screens (<320px); the system must provide a collapsed menu for filters.
      - Touch interactions conflict with horizontal scrolling; the system must implement a gesture‑friendly design.
    dependencies:
      - FR-0181
      - FR-0183

  - id: FR-0188
    description: The system must provide an option to export the current dashboard view to a CSV file, including provider name, slot times, and occupancy percentage.
    priority: Low
    related_usecase: []
    acceptance_criteria:
      - Given a user clicks the “Export CSV” button, when the export completes, then a file named “provider_availability_<date>.csv” is downloaded.
      - Given the exported data is opened in a spreadsheet, when the file is parsed, then all columns match the displayed data.
    edge_cases:
      - Exporting when there is no data; the system must generate an empty CSV with header row.
      - Large data sets (>10,000 rows); the system must stream the file to avoid memory overload.
    dependencies:
      - FR-0181
      - FR-0182

  - id: FR-0189
    description: >
      The system shall allow a Clinic Manager to generate a performance report
      summarizing no‑show rates, average wait times, and utilization metrics
      for a selected time period.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a logged‑in Clinic Manager, when the manager requests a report
        for a valid date range, then the system returns the report within
        the defined performance window.
    edge_cases:
      - The selected date range contains no appointment data; the system
        displays an informative “No data available” message.
      - The requested date range exceeds the maximum allowed span
        (e.g., > 12 months); the system rejects the request with a clear
        error.
    dependencies: []

  - id: FR-0190
    description: >
      The system shall provide filtering controls to narrow the report by
      clinic, date range, and appointment type.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - When the manager selects a clinic, date range, and appointment type,
        the report displays metrics only for the intersection of those
        criteria.
    edge_cases:
      - The manager selects a future date range; the system returns
        “No data available”.
      - The manager selects a clinic with no appointments in the period;
        the system returns a summary with zeros.
    dependencies:
      - FR-0189

  - id: FR-0191
    description: >
      The system shall allow the manager to export the generated report
      in PDF, CSV, or Excel format.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - When the manager clicks the “Export” button and selects a format,
        the file is downloaded with the correct MIME type and file name.
    edge_cases:
      - The file size exceeds the maximum allowed download size (e.g., 50 MB);
        the system displays a warning and aborts the download.
      - The manager cancels the download mid‑stream; the system cleans up
        temporary files and shows a cancellation confirmation.
    dependencies:
      - FR-0189

  - id: FR-0192
    description: >
      The system shall support scheduling of recurring report generation
      (e.g., daily, weekly) and send an email notification to the
      Clinic Manager upon completion.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - When the manager schedules a daily report for 8 AM, the system
        generates the report at the specified time and sends an email
        with the report attached.
    edge_cases:
      - The scheduled time falls on a holiday; the system skips generation
        and logs the skip event.
      - The manager provides an invalid email address; the system
        rejects the schedule and displays an error.
    dependencies:
      - FR-0189

  - id: FR-0193
    description: >
      The system shall allow the manager to drill down from aggregate
      metrics to individual appointment details within the report.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - When the manager clicks a metric in the report, a detailed view
        opens showing individual appointments contributing to that metric.
    edge_cases:
      - The metric has no underlying appointments; the system shows
        “No detailed data available”.
      - The detailed view loads more records than the UI can display
        at once; the system provides pagination or infinite scroll.
    dependencies:
      - FR-0189

  - id: FR-0194
    description: >
      The system shall maintain an audit trail of all report generation
      activities, recording the user, timestamp, report parameters, and
      outcome (success/failure).
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - After any report generation attempt, an audit record exists in
        the audit log with all required fields populated.
    edge_cases:
      - The audit log service is temporarily unavailable; the system
        retries and records the failure in the log once service is
        restored.
      - A user session expires during report generation; the audit log
        records the session ID and the partial attempt.
    dependencies:
      - FR-0189

  - id: FR-0195
    description: "Clinic Manager can initiate an export of any available report from the Reports dashboard."
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - "Given the Reports dashboard is displayed, when the Clinic Manager clicks the 'Export' button, then an export dialog appears."
      - "Given the export dialog is displayed, when the Clinic Manager clicks 'Cancel', then the dialog closes without any action."
    edge_cases:
      - "The Reports dashboard contains no reports; the 'Export' button is disabled."
      - "The user has no permissions to export; clicking 'Export' shows an access denied message."
    dependencies: []

  - id: FR-0196
    description: "Clinic Manager can select the export format (CSV or PDF) before initiating the export."
    priority: High
    related_usecase: []
    acceptance_criteria:
      - "Given the export dialog is open, when the Clinic Manager selects 'CSV', then the format field is set to CSV."
      - "Given the export dialog is open, when the Clinic Manager selects 'PDF', then the format field is set to PDF."
    edge_cases:
      - "The user attempts to select an unsupported format; an error message is displayed."
      - "The default format is not set; the dialog prompts the user to choose a format."
    dependencies:
      - FR-0195

  - id: FR-0197
    description: "Clinic Manager can apply date range and filter criteria to the report before export."
    priority: High
    related_usecase: []
    acceptance_criteria:
      - "Given the export dialog is open, when the Clinic Manager selects a start date, an end date, and a filter, then the export parameters are updated accordingly."
      - "Given the export dialog is open, when the Clinic Manager clicks 'Reset', then all filter fields return to their default values."
    edge_cases:
      - "The selected date range is invalid (end date before start date); an error message is shown."
      - "No data matches the selected filters; the export button is disabled."
    dependencies:
      - FR-0195

  - id: FR-0198
    description: "The system generates the export file on the server and streams it to the Clinic Manager’s browser."
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - "Given the export dialog is submitted, when the system processes the request, then a file is generated in the selected format."
      - "Given the file is generated, when the system streams the file, then the Clinic Manager receives a downloadable link that opens the file in the browser or downloads it."
    edge_cases:
      - "The generated file exceeds 5 MB; the system aborts the export and shows an error message."
      - "The server fails during file generation (e.g., disk full); the system rolls back and reports a failure."
      - "Network interruption occurs while streaming; the system retries once and then fails with an appropriate message."
    dependencies:
      - FR-0195
      - FR-0196
      - FR-0197

  - id: FR-0199
    description: "After export completion, the system displays a success or failure notification with download link or error details."
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - "Given the export completes successfully, when the system finishes streaming, then a success toast appears with a download link."
      - "Given the export fails, when the system detects the failure, then an error toast appears with a user‑readable error message."
    edge_cases:
      - "The download link is clicked after the session expires; the system prompts re‑authentication."
      - "The error message contains sensitive data; it is sanitized before display."
    dependencies:
      - FR-0198

  - id: FR-0200
    description: "All export actions are logged to an audit trail with user ID, timestamp, and export parameters."
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - "Given an export action occurs, when the action is processed, then a log record is written containing user ID, timestamp, selected format, date range, and filter criteria."
      - "Given the audit log is queried, when an administrator requests logs for a specific user, then all relevant export actions are returned."
    edge_cases:
      - "The audit log storage becomes full; the system archives old logs and continues logging."
      - "A malicious user attempts to delete audit entries; the system prevents deletion and records the attempt."
    dependencies:
      - FR-0198

  - id: FR-0201
    description: Detect schedule conflicts in real‑time and generate an alert trigger within 5 minutes of the conflict occurring.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a new appointment is added that overlaps an existing appointment, when the scheduling engine processes the change, then the system must flag a conflict and create an alert trigger within 5 minutes.
      - Given multiple simultaneous overlapping appointments, when the system processes the batch, then all conflicts must be detected and corresponding alert triggers generated within 5 minutes.
    edge_cases:
      - Conflict detection when appointments are back‑to‑back with no buffer time.
      - Conflict detection when appointments span midnight or daylight‑saving time changes.
    dependencies: []

  - id: FR-0202
    description: Create a persistent alert record containing conflict details (staff, patient, time slot, conflict type) and a unique alert ID.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given an alert trigger from FR-0201, when the alert record is created, then it must include all required fields and be stored in the alert database.
      - Given an alert record, when queried by alert ID, the system must return the exact conflict details.
    edge_cases:
      - Attempt to create an alert with missing mandatory fields should result in a validation error.
      - Duplicate alert IDs should be prevented by the database unique constraint.
    dependencies:
      - FR-0201

  - id: FR-0203
    description: Deliver the alert to the Clinic Scheduler via the existing notification service using push, email, or in‑app channels as configured.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given an alert record, when the notification service is invoked, then the alert must be sent to all channels enabled for the Clinic Scheduler within 2 minutes of creation.
      - Given a failed delivery attempt, the system must retry up to 3 times with exponential back‑off before marking the delivery as failed.
    edge_cases:
      - Network partition causing temporary loss of connectivity to the notification service.
      - Notification service returning a 5xx error code.
    dependencies:
      - FR-0202

  - id: FR-0204
    description: Allow the Clinic Scheduler to acknowledge, ignore, or delegate an alert through the user interface or API.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given an active alert displayed to the Scheduler, when the Scheduler clicks “Acknowledge”, the alert status changes to “Acknowledged” and the change is logged.
      - Given an alert, when the Scheduler selects “Delegate” and assigns another staff member, the alert status updates to “Delegated” and the new assignee receives a notification.
    edge_cases:
      - Attempting to acknowledge an already acknowledged alert should be idempotent and not create duplicate logs.
      - Delegating to a staff member who is offline; the system must queue the notification.
    dependencies:
      - FR-0203

  - id: FR-0205
    description: Log all alert actions (creation, delivery, acknowledgment, delegation, ignoring) with timestamps and user identifiers for audit and reporting.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given any alert action, when the action is performed, then a log entry is persisted with action type, alert ID, user ID, and UTC timestamp.
      - Logs must be queryable by alert ID and time range within 1 second.
    edge_cases:
      - Log write failures due to database contention; the system must retry or buffer.
      - Log retention policy must purge logs older than 365 days automatically.
    dependencies:
      - FR-0201
      - FR-0202
      - FR-0203
      - FR-0204

  - id: FR-0206
    description: Provide a user interface that lists current alerts with status, priority indicators, and actions to resolve or delegate.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given the Scheduler opens the Alerts dashboard, then the UI displays all active alerts sorted by priority and creation time.
      - Given an alert in the list, the Scheduler can click “Resolve” or “Delegate” and the UI updates the status accordingly within 2 seconds.
    edge_cases:
      - UI rendering when the alert list contains thousands of entries; pagination or infinite scroll must be implemented.
      - Accessibility: screen readers must announce alert status changes.
    dependencies:
      - FR-0202
      - FR-0204

  - id: FR-0207
    description: Support multi‑channel notifications (push, email, SMS) for alerts, configurable per user preference.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a user preference set to “SMS only”, when an alert is triggered, the system sends only an SMS notification.
      - When the user preference includes “Push + Email”, both channels receive the alert within 2 minutes.
    edge_cases:
      - SMS provider rate limits exceeded; the system must queue and retry.
      - Push notification payload exceeding size limits; the system must truncate or use deep links.
    dependencies:
      - FR-0203

  - id: FR-0208
    description: Provide an API endpoint for historical alert search and reporting, supporting filters by date range, status, and staff.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a request for alerts between two dates, the API returns all alerts matching the criteria within 1 second.
      - The API supports pagination with a maximum of 200 records per page.
    edge_cases:
      - Querying with an invalid date format returns a 400 error with a clear message.
      - Requesting a date range that yields no results returns an empty array, not an error.
    dependencies:
      - FR-0205

  - id: FR-209
    description: Log every manual change made through the UI or API, capturing user identity, action type, timestamp (UTC), reason/comment (if provided), and affected record identifiers.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a user performs a manual create/update/delete operation, when the operation completes successfully, then a new audit log entry must be created with all required fields populated.
      - Given a transaction fails after the manual change, when the transaction is rolled back, then no audit log entry should be persisted.
    edge_cases:
      - The user provides an empty reason/comment field; the system must still record the change with a null reason.
      - The system experiences a brief network outage during log persistence; the log entry must be retried until successful or the transaction rolls back.
    dependencies: []

  - id: FR-210
    description: Store audit log entries in an immutable, tamper‑evident store that prevents modification or deletion by non‑admin users.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given an audit log entry exists, when a non‑admin user attempts to modify or delete it, then the operation must be rejected with an authorization error.
      - Given an audit log entry is written, when the system performs a hash‑chain verification, then the integrity of the entry must be intact.
    edge_cases:
      - Attempt to bypass immutability via direct database access; the system must detect and block such attempts.
      - Concurrent writes to the same record; the hash chain must remain consistent.
    dependencies:
      - FR-209

  - id: FR-211
    description: Provide a query interface for audit logs that supports filtering by date range, user, action type, and entity, and allows export of results in CSV or JSON format.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a user selects a date range, user filter, and action type, when the query is executed, then only audit log entries matching all selected criteria are returned.
      - Given the user requests an export, when the export is generated, then the file must contain all filtered entries in the selected format without data loss.
    edge_cases:
      - Query with no filters should return all entries up to the maximum page size.
      - Export request for more than 10,000 entries should be paginated and processed without timeouts.
    dependencies:
      - FR-209
      - FR-210

  - id: FR-212
    description: Trigger real‑time alerts for high‑risk changes (e.g., deletion of critical records) and log the alert details.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given a high‑risk change is detected, when the alert is triggered, then an email/SMS notification must be sent to the compliance officer and an alert record logged in the audit trail.
      - Given the alert is acknowledged, when the acknowledgment is recorded, then the alert status must update to “resolved”.
    edge_cases:
      - Network failure during alert dispatch; the system must retry until acknowledgment or timeout.
      - Duplicate high‑risk event; the system must prevent duplicate alerts for the same change.
    dependencies:
      - FR-209

  - id: FR-213
    description: Ensure audit trail completeness by persisting the audit log entry before committing the business transaction.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a manual change operation, when the transaction commits, then the corresponding audit log entry must have already been persisted.
      - Given a failure in log persistence, when the transaction attempts to commit, then the commit must be aborted and rolled back.
    edge_cases:
      - Log persistence delay exceeding transaction timeout; the system must roll back the transaction.
      - Concurrent transactions modifying the same record; each must have a distinct audit entry.
    dependencies:
      - FR-209

  - id: FR-214
    description: Enforce an audit log retention policy that automatically archives or deletes logs older than a configurable period (e.g., 7 years) while maintaining compliance.
    priority: Low
    related_usecase: []
    acceptance_criteria:
      - Given a log entry older than the retention period, when the retention job runs, then the entry must be archived to cold storage or deleted, preserving a tamper‑evident audit trail of the action.
      - Given an audit log is archived, when a compliance officer requests a historical audit, then the system must retrieve the archived entry within 5 seconds.
    edge_cases:
      - Retention period changes; the system must handle retroactive adjustments without data loss.
      - Archived logs exceed storage capacity; the system must alert administrators before deletion.
    dependencies:
      - FR-209
      - FR-210

  - id: FR-0215
    description: >
      The system must perform bidirectional synchronization of patient schedules,
      appointments, and clinical notes between the EHR and billing systems.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given an appointment created in the EHR, when the sync process runs,
        then the billing system receives the appointment record within 5 minutes.
      - Given a billing claim status update, when the sync process runs,
        then the EHR receives the updated claim status within 5 minutes.
    edge_cases:
      - Appointment record missing patient identifier.
      - Appointment times conflicting between systems.
    dependencies: []

  - id: FR-0216
    description: >
      The system must support event‑driven triggers that initiate an immediate sync
      when an appointment or claim event occurs in either system.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given an appointment creation event in the EHR, when the event is received,
        then the sync process starts within 30 seconds.
      - Given a claim status change event in the billing system, when the event is
        received, then the sync process starts within 30 seconds.
    edge_cases:
      - Event payload missing required fields.
      - Duplicate event notifications.
    dependencies: []

  - id: FR-0217
    description: >
      The system must perform scheduled batch synchronization to capture any
      missed or delayed events, running no more frequently than every 5 minutes.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given the scheduled job runs, then all unsynced records are processed
        within 5 minutes of the job start.
      - Given the job processes 10,000 appointments, then it completes in under 2 minutes.
    edge_cases:
      - Overlap of scheduled job with an event‑driven sync.
      - Extremely large data sets causing job to exceed time window.
    dependencies: []

  - id: FR-0218
    description: >
      The system must provide a data transformation layer that maps EHR data models
      to billing data models, including type conversions, date formatting, and
      code system translations.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given an EHR data payload, when the transformation layer is applied,
        then the resulting billing payload conforms to the billing system schema.
      - Given an unsupported code in the EHR payload, the transformation layer
        flags the record for manual review.
    edge_cases:
      - Unsupported or unknown medical codes.
      - Date formats that do not match expected patterns.
    dependencies: []

  - id: FR-0219
    description: >
      The system must detect duplicate records and resolve conflicts using a
      last‑write‑wins strategy or a configurable user‑approved rule set.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given two identical records with different timestamps, when a sync occurs,
        then the record with the most recent timestamp prevails.
      - Given a user‑approved rule for a specific conflict, when a sync occurs,
        then the rule determines the resulting record.
    edge_cases:
      - Simultaneous updates from both systems.
      - Conflicting updates with identical timestamps.
    dependencies: []

  - id: FR-0220
    description: >
      The system must maintain a comprehensive audit trail, logging every sync
      event, payload, status, and error details, searchable by patient ID,
      timestamp, and sync type.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given a sync event, then an audit log entry is created with status,
        timestamps, and payload identifiers.
      - Given a search query by patient ID, then the audit log returns all
        related sync events within 2 seconds.
    edge_cases:
      - Log storage reaching capacity.
      - Corrupted log entries due to disk failure.
    dependencies: []

  - id: FR-0221
    description: >
      The system must implement robust error handling, automatically retrying
      transient failures up to three times with exponential back‑off and flagging
      persistent failures for manual intervention.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given a transient network error, when a sync fails, then the system
        retries up to three times with exponential back‑off.
      - Given a persistent authentication failure, then the system flags the
        sync for manual review and notifies the support team.
    edge_cases:
      - Permanent server errors (5xx) from the billing system.
      - Rate limiting responses from the EHR API.
    dependencies: []

  - id: FR-0222
    description: >
      The system must provide an administrative UI that allows field mapping,
      sync schedule configuration, status monitoring, and failure log review.
    priority: Low
    related_usecase: []
    acceptance_criteria:
      - Given an admin user, when accessing the configuration page, then they
        can map at least five fields within 5 minutes.
      - Given a sync status page, then it displays current sync progress
        and any errors within 2 seconds.
    edge_cases:
      - Unauthorized user attempting to access the admin UI.
      - UI crash due to malformed mapping configuration.
    dependencies: []

  - id: FR-0223
    description: >
      The system must expose a secure RESTful API/SDK that allows external
      systems to trigger sync operations or retrieve sync status.
    priority: Low
    related_usecase: []
    acceptance_criteria:
      - Given a valid API key, when an external system calls the sync endpoint,
        then the sync is initiated and a 202 Accepted response is returned.
      - Given an invalid API key, when an external system calls the endpoint,
        then the system returns a 401 Unauthorized response.
    edge_cases:
      - Exceeding rate limits for API calls.
      - Malformed JSON payloads.
    dependencies: []

  - id: FR-0224
    description: The system shall allow a System Administrator to create, edit, and delete role definitions.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a logged‑in System Administrator, when they navigate to the Role Management screen, then they must see options to create, edit, or delete roles.
      - Given a new role name that does not exist, when the administrator submits the form, then the role is persisted and visible in the role list.
      - Given a role name that already exists, when the administrator attempts to create a duplicate, then the system displays a unique‑name validation error.
    edge_cases:
      - Attempting to delete a role that is currently assigned to one or more staff users should prompt a warning and prevent deletion until reassignment.
      - Creating a role with an empty name or only whitespace should result in a validation error.
    dependencies: []

  - id: FR-0225
    description: The system shall allow a System Administrator to assign a set of permissions (e.g., view, edit, delete) to each role.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a role exists, when the administrator selects the role and assigns permissions, then those permissions are persisted and displayed in the role detail view.
      - Given a permission set that includes at least one invalid permission value, when the administrator submits, then the system rejects the submission with an error message.
    edge_cases:
      - Assigning an empty permission set to a role should be allowed but must be clearly indicated as “no permissions” in the UI.
      - Attempting to assign a permission that is not defined in the policy engine should result in an error.
    dependencies:
      - FR-0224

  - id: FR-0226
    description: The system shall allow a System Administrator to assign one or more existing roles to individual staff users.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a staff user and an existing role, when the administrator assigns the role to the user, then the role appears in the user’s role list and the user’s effective permissions are updated accordingly.
      - Given a user who already has the role, when the administrator attempts to assign the same role again, then the system displays a duplicate‑role warning and does not duplicate the assignment.
    edge_cases:
      - Assigning a role to a user who is inactive or deactivated should be prevented with an appropriate message.
      - Assigning a role that grants no permissions should still be allowed but must be flagged in the UI as “no‑access role”.
    dependencies:
      - FR-0224
      - FR-0225

  - id: FR-0227
    description: The system shall propagate any permission changes (role creation, permission updates, role assignment changes) to all affected staff users within 1 hour of the change being made.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a permission change is made, when 60 minutes have elapsed, then all users who are affected by the change must have the new permissions reflected in their session or next login.
      - The system must log the propagation timestamp for each affected user.
    edge_cases:
      - If a user logs out before the propagation window, the next login must reflect the updated permissions.
      - System restarts or downtime during the propagation window must not delay the final enforcement beyond the 1‑hour guarantee.
    dependencies:
      - FR-0226

  - id: FR-0228
    description: The system shall maintain an immutable audit trail for all permission changes, recording the actor, timestamp, and details of the change.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Every create, edit, delete of roles, permissions, and role assignments must be logged with a unique audit entry.
      - The audit log must be tamper‑proof; attempts to modify an existing audit entry must be detected and flagged.
    edge_cases:
      - Bulk role updates performed via API must produce individual audit entries for each affected role.
      - Audit logs must remain accessible even if the primary database is restored from a backup.
    dependencies:
      - FR-0224
      - FR-0225
      - FR-0226

  - id: FR-0229
    description: The system shall provide real‑time UI feedback for unauthorized access attempts and enforce a threshold that no more than 1% of total access attempts are unauthorized.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - When a staff user attempts to access a restricted scheduling function without sufficient permissions, the system displays an immediate “Access Denied” message.
      - The system aggregates unauthorized attempt counts and flags when the threshold of 1% is exceeded, triggering an alert to the System Administrator.
    edge_cases:
      - Attempts made by users who have just been granted the necessary role but have not yet re‑authenticated should still be treated as unauthorized until session renewal.
      - System must not count legitimate attempts that fail due to transient network errors as unauthorized.
    dependencies:
      - FR-0224
      - FR-0226

  - id: FR-0230
    description: New staff members must be able to log in to the LMS and view the list of available dashboard training modules.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a new staff member on the login page, when they enter valid credentials, then they are redirected to the training module list page.
      - Given a new staff member on the login page, when they enter invalid credentials, then an error message “Invalid username or password” is displayed and no access is granted.
    edge_cases:
      - User attempts to log in with an account that is disabled; system must show “Account disabled” and deny access.
      - User’s password expires; system must prompt password reset before allowing access to modules.
    dependencies: []

  - id: FR-0231
    description: The system must display LMS‑compatible training content (video, slides, interactive widgets) within the module view.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a user is on a module page, when the module contains a video, then the video player loads and plays without buffering for the first 10 seconds.
      - Given a user is on a module page, when the module contains interactive widgets, then all widgets are rendered and responsive to user input.
    edge_cases:
      - Content file is corrupted; system displays a fallback message “Content unavailable”.
      - Unsupported file format; system logs an error and skips rendering that segment.
    dependencies:
      - FR-0230

  - id: FR-0232
    description: Users must be able to navigate forward and backward through the sections of a training module.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a user on section 1 of a module, when they click “Next”, then section 2 is displayed.
      - Given a user on section 3 of a module, when they click “Previous”, then section 2 is displayed.
    edge_cases:
      - User clicks “Next” on the last section; system displays “You have reached the end of the module”.
      - User clicks “Previous” on the first section; system displays “You are at the beginning of the module”.
    dependencies:
      - FR-0231

  - id: FR-0233
    description: At the end of each module, the system must present a quiz with at least 5 multiple‑choice questions and provide immediate feedback after each answer.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a user completes the final section, when they click “Start Quiz”, then a quiz of 5 questions appears.
      - Given a user selects an answer, when they submit, then the correct answer is highlighted and a short explanation is displayed.
    edge_cases:
      - User submits an answer without selecting an option; system prompts “Please select an answer”.
      - Quiz contains a question with no answer options; system logs an error and skips that question.
    dependencies:
      - FR-0232

  - id: FR-0234
    description: The system must track and display the user’s progress percentage completed, time spent, and quiz scores on a dashboard.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a user has completed 2 of 4 sections, the dashboard shows “Progress 50%”.
      - Given a user has spent 15 minutes on the module, the dashboard displays “Time spent 15 min”.
      - Given a user has taken the quiz and scored 4/5, the dashboard shows “Quiz score 80%”.
    edge_cases:
      - User logs out and logs back in; progress is retained and correctly displayed.
      - User clears browser cookies; progress is still retrievable from the server.
    dependencies:
      - FR-0233

  - id: FR-0235
    description: Upon successful completion of a module (quiz score ≥ 90 % and 100 % module completion), the system must issue a digital badge and record certification in the user’s profile.
    priority: Critical
    related_usecase: []
    acceptance_criteria:
      - Given a user scores 90 % or higher on the final quiz and has completed all sections, then a badge icon appears on their profile.
      - Given a user’s profile, when the badge is displayed, the system records the certification timestamp.
    edge_cases:
      - User scores 90 % but does not complete all sections; badge is not issued.
      - User attempts to claim a badge manually; system blocks the action and shows “Badge cannot be claimed manually”.
    dependencies:
      - FR-0234

  - id: FR-0236
    description: The system must expose an API endpoint that returns analytics data (completion rate, average quiz score, time spent) for managers.
    priority: Medium
    related_usecase: []
    acceptance_criteria:
      - Given a manager authenticates with an API key, when they request /api/analytics, then the response contains JSON with completion_rate, avg_quiz_score, avg_time_spent.
      - The API supports filtering by date range and module ID.
    edge_cases:
      - Manager requests data for a non‑existent module; system returns 404 with an explanatory message.
      - API key is expired; system returns 401 Unauthorized.
    dependencies:
      - FR-0230

  - id: FR-0237
    description: Training modules must be fully responsive and usable on desktop, tablet, and mobile browsers.
    priority: High
    related_usecase: []
    acceptance_criteria:
      - Given a user opens a module on a screen width ≤ 480 px, the layout adapts to a single‑column view without horizontal scrolling.
      - Given a user interacts with a video on a tablet, the video controls are touch‑friendly and accessible.
    edge_cases:
      - User rotates device from portrait to landscape; layout reflows without loss of content.
      - User uses a browser that does not support HTML5 video; system falls back to a downloadable MP4 link.
    dependencies:
      - FR-0231















non_functional_requirements:
  - id: NFR-0000
    description: |
      All data in transit must be encrypted using TLS 1.3, and all data at rest must be encrypted with AES‑256. Encryption keys shall be managed via a Hardware Security Module (HSM).
    related_fr:
      - FR-0000
      - FR-0001
      - FR-0002
      - FR-0008
      - FR-0007
    measurement:
      - The TLS handshake must negotiate TLS 1.3 for all client‑server connections.
      - AES‑256 encryption must be verified on a sample of stored tokens and audit logs.
      - Key rotation must occur at least every 90 days, and key usage logs must be retained for 12 months.

  - id: NFR-0001
    description: |
      The system must comply with HIPAA security and privacy rules, including audit logging retention for 24 months, breach notification procedures, and data minimization.
    related_fr:
      - FR-0004
    measurement:
      - Audit logs must be retained for 24 months and be immutable.
      - A breach notification workflow must be documented and tested annually.
      - Data minimization checks must confirm that only required fields are stored for authentication.

  - id: NFR-0002
    description: |
      End‑to‑end authentication (magic link generation, MFA, OAuth token acquisition, session creation) must resolve within 2 seconds for 99th percentile of users.
    related_fr:
      - FR-0000
      - FR-0001
      - FR-0002
      - FR-0008
    measurement:
      - Latency measured via automated performance tests; 99th percentile < 2 s.
      - Real‑time monitoring dashboards must alert if median latency exceeds 1 s.

  - id: NFR-0003
    description: |
      Email and SMS delivery for magic links and MFA codes must complete within 30 seconds for 95th percentile of messages.
    related_fr:
      - FR-0008
    measurement:
      - Delivery timestamps recorded; 95th percentile < 30 s.
      - Retry logic must not exceed 2 attempts.

  - id: NFR-0004
    description: |
      The authentication service must achieve 99.9 % uptime, with automatic failover to a secondary instance in the event of a primary failure.
    related_fr:
      - FR-0000
      - FR-0001
      - FR-0002
      - FR-0008
    measurement:
      - Uptime calculated from health‑check logs over a rolling 30‑day period.
      - Failover must occur within 30 seconds and restore service with minimal disruption.

  - id: NFR-0005
    description: |
      The system must scale to handle 10,000 concurrent login attempts during peak periods without degradation in response time.
    related_fr:
      - FR-0000
      - FR-0001
      - FR-0002
    measurement:
      - Load testing with 10,000 concurrent simulated users; response time must remain < 2 s.
      - CPU and memory usage must stay below 80 % during peak load.

  - id: NFR-0006
    description: |
      At least 95 % of patients surveyed post‑login must report confidence in the login process.
    related_fr:
      - FR-0000
      - FR-0001
      - FR-0003
    measurement:
      - Quarterly UX surveys; confidence score ≥ 95 % required.
      - Survey response rate must be ≥ 70 % of active users.

  - id: NFR-0007
    description: |
      MFA codes must expire 5 minutes after issuance, and the system must allow a maximum of 3 attempts per code.
    related_fr:
      - FR-0001
    measurement:
      - Code expiry verified via automated tests; 5 min timeout.
      - Attempt counter reset after successful verification or expiry.

  - id: NFR-0008
    description: |
      Session idle timeout must be 30 minutes, and session termination must invalidate all session tokens.
    related_fr:
      - FR-0007
    measurement:
      - Idle timeout enforced in session management module; verified via integration tests.
      - Logout flow must revoke session tokens and delete session cookies.

  - id: NFR-0009
    description: |
      Audit logs must be tamper‑evident, searchable, and protected from unauthorized access.
    related_fr:
      - FR-0004
    measurement:
      - Log integrity checks (hash chaining) must detect any alterations.
      - Access controls verified via penetration tests; only authorized roles can read logs.

  - id: NFR-0010
    description: |
      All third‑party integrations (email, SMS, OAuth provider) must be vetted and certified for HIPAA compliance before use.
    related_fr:
      - FR-0008
    measurement:
      - Vendor security assessments completed and signed off annually.
      - Compliance certificates stored in the system’s vendor registry.
  - id: NFR-0011
    description: The system must meet performance targets for API latency and UI rendering to ensure a responsive user experience.
    related_fr:
      - FR-0009
      - FR-0010
    measurement:
      - API latency: ≤ 1 second (measured from request sent to response received in production).
      - UI rendering time: ≤ 2 seconds (measured from data receipt to full slot list visible).
      - Verification: Continuous monitoring via Application Performance Monitoring (APM) tools and automated end‑to‑end tests.

  - id: NFR-0012
    description: The availability view must maintain high reliability and graceful degradation in case of scheduling API failures.
    related_fr:
      - FR-0009
      - FR-0013
    measurement:
      - Uptime: ≥ 99.9 % for the availability view over a 30‑day period.
      - Retry logic: automatic retry every 30 seconds if the scheduling API is unreachable.
      - Verification: Uptime monitoring dashboards and simulated API outages in testing environments.

  - id: NFR-0013
    description: The system must adhere to HIPAA security requirements and enforce secure data transmission.
    related_fr:
      - FR-0009
      - FR-0010
      - FR-0011
      - FR-0012
    measurement:
      - All data in transit is encrypted with TLS 1.2+.
      - Authentication is handled via OAuth 2.0 with short‑lived access tokens.
      - Regular penetration testing reports with no critical vulnerabilities.
      - Verification: Security audit logs, penetration test results, and compliance certifications.

  - id: NFR-0014
    description: The system must scale to support at least 10,000 concurrent patients per clinic without performance degradation.
    related_fr:
      - FR-0009
      - FR-0010
      - FR-0011
      - FR-0012
      - FR-0013
      - FR-0014
    measurement:
      - Concurrent user load: ≥ 10,000 users per clinic with API latency ≤ 1 second.
      - Verification: Load testing with tools such as k6 or JMeter and monitoring of resource utilization.

  - id: NFR-0015
    description: The user experience must enable at least 90 % of patients to find a suitable slot on the first page of results.
    related_fr:
      - FR-0009
    measurement:
      - Success rate: ≥ 90 % (tracked via analytics on slot selection behavior).
      - Verification: User analytics dashboards and A/B testing.

  - id: NFR-0016
    description: The availability feature must be available 24/7 and handle network interruptions gracefully.
    related_fr:
      - FR-0009
      - FR-0013
    measurement:
      - Availability: 24/7 with no planned downtime.
      - Offline handling: UI displays “You are offline” and queues actions when connectivity is restored.
      - Verification: Real‑time monitoring and automated offline simulation tests.

  - id: NFR-0017
    description: The UI must comply with WCAG 2.1 AA accessibility standards.
    related_fr:
      - FR-0009
      - FR-0010
    measurement:
      - Accessibility audit score: ≥ 95 % passing on tools like axe-core.
      - Verification: Automated accessibility scans and manual screen‑reader testing.

  - id: NFR-0018
    description: |
      End‑to‑end response time for the reschedule flow (UI submission → confirmation receipt) must not exceed 2 minutes under peak load conditions.
    related_fr:
      - FR-0015
      - FR-0016
      - FR-0017
      - FR-0018
      - FR-0019
    measurement:
      - "Measure total elapsed time from the moment the patient clicks **Submit** until the confirmation modal is displayed. Target: ≤ 2 minutes."
      - "Verify via automated performance tests with 95th percentile latency < 2 minutes under peak load (defined as 1,000 concurrent users)."

  - id: NFR-0019
    description: |
      The reschedule service must be available 99.9% of the time over a 30‑day period, excluding planned maintenance windows.
    related_fr:
      - FR-0015
      - FR-0019
    measurement:
      - "Uptime monitoring reports 99.9% availability (max 43.2 minutes of downtime per month)."
      - "Verify via external monitoring tools and internal logs."

  - id: NFR-0020
    description: |
      The system must scale to handle a 50% surge in appointment changes (e.g., during flu season) without a performance degradation of more than 10% relative to baseline metrics.
    related_fr:
      - FR-0015
    measurement:
      - "Load test with 1.5× baseline traffic; response time should not increase by more than 10%."
      - "Observe system metrics (CPU, memory, queue depth) to confirm no bottlenecks."

  - id: NFR-0021
    description: |
      All patient data must be encrypted in transit using TLS 1.3 and at rest using AES‑256. Role‑based access control must restrict actions to authorized users only.
    related_fr:
      - FR-0015
      - FR-0016
      - FR-0019
    measurement:
      - "Penetration testing confirms TLS 1.3 is enforced and no downgrade attacks are possible."
      - "Database encryption keys are rotated quarterly; audit logs confirm AES‑256 usage."
      - "RBAC policies are verified via automated policy checks; no unauthorized access is logged."

  - id: NFR-0022
    description: |
      The system must comply with HIPAA requirements, including secure audit logging, data minimization,


  - id: NFR-00023
    description: Reminder delivery latency must be under 2 seconds for 95 % of send requests, even during peak load.
    related_fr:
      - FR-00023
    measurement:
      - 95 % of reminder send operations complete within 2 seconds as measured by system metrics.
      - Verification: Load test with 10 000 concurrent reminder sends; capture latency distribution.

  - id: NFR-00024
    description: Response processing latency must be under 1 second for 95 % of patient replies.
    related_fr:
      - FR-00025
    measurement:
      - 95 % of reply events are recorded in the database within 1 second of receipt.
      - Verification: Instrument reply ingestion pipeline and measure end‑to‑end latency under realistic traffic.

  - id: NFR-00025
    description: The notification service must maintain 99.5 % uptime over a 30‑day period.
    related_fr:
      - FR-00023
      - FR-00025
      - FR-00026
    measurement:
      - Uptime measured via external monitoring tools (e.g., Pingdom, New Relic) shows <0.5 % downtime per month.
      - Verification: Continuous monitoring logs and SLA report.

  - id: NFR-00026
    description: All patient data (contact info, reminder content, replies) must be encrypted at rest and in transit in accordance with HIPAA requirements.
    related_fr:
      - FR-00030
    measurement:
      - Encryption key management follows NIST SP 800‑57 Part 1 guidelines.
      - Verification: Penetration testing and audit of encryption mechanisms.

  - id: NFR-00027
    description: The system must support up to 20 000 response events per day without performance degradation.
    related_fr:
      - FR-00025
    measurement:
      - Throughput measured at 20 000 events/day with latency <1 s.
      - Verification: Load test simulating 20 000 replies over 24 hours.

  - id: NFR-00028
    description: Audit logs must be retained for a minimum of 7 years in a tamper‑evident format.
    related_fr:
      - FR-00030
    measurement:
      - Log retention policy enforced by automated archival to immutable storage (e.g., WORM).
      - Verification: Audit trail review and policy compliance report.

  - id: NFR-00029
    description: The admin dashboard and patient portal must meet WCAG 2.1 AA accessibility standards.
    related_fr:
      - FR-00029
    measurement:
      - Accessibility audit score ≥ 90 % with no critical violations.
      - Verification: Automated accessibility testing (axe, Lighthouse) and manual review.

  - id: NFR-00030
    description: The system must handle a 50 % spike in reminder send volume during peak periods without exceeding 5 % of the 95 % latency threshold.
    related_fr:
      - FR-00023
    measurement:
      - During peak load test, 95 % of sends still complete within 2 seconds; peak latency does not exceed 2.6 seconds.
      - Verification: Stress testing with simulated peak traffic.

  - id: NFR-00031
    description: The system must comply with all HIPAA opt‑in/out requirements, including audit trails for consent changes.
    related_fr:
      - FR-00028
    measurement:
      - Consent change events logged with user ID, timestamp, and new status.
      - Verification: Compliance audit and review of consent logs.


  - id: NFR-0032
    description: The Preference page and associated APIs must meet performance targets to ensure a responsive user experience.
    related_fr:
      - FR-0031
      - FR-0032
      - FR-0034
    measurement:
      - Page load time <= 2 seconds on a 3G network as measured by automated browser tests.
      - API response time for save/update <= 0.8 seconds as measured by load‑testing tools.

  - id: NFR-0033
    description: The system must provide robust security and privacy controls for communication preference data.
    related_fr:
      - FR-0034
    measurement:
      - All data in transit must use TLS 1.2 or higher, verified by certificate pinning checks.
      - All preference data at rest must be encrypted using AES‑256, verified by audit logs.
      - Every change to preferences must be logged with user ID, timestamp, and before/after values, compliant with HIPAA/GDPR audit requirements.

  - id: NFR-0034
    description: The Preference API must exhibit high reliability and graceful error handling.
    related_fr:
      - FR-0034
    measurement:
      - 99.9 % uptime for the Preference API over a 30‑day period, verified by uptime monitoring.
      - Automatic retry of failed save/update operations up to 3 attempts before alerting operations staff.

  - id: NFR-0035
    description: The Preference UI must be accessible and provide a usable experience for all patients.
    related_fr:
      - FR-0031
      - FR-0032
      - FR-0033
    measurement:
      - WCAG 2.1 AA compliance as verified by automated accessibility testing tools (e.g., axe, Lighthouse).
      - All error messages must be displayed within 2 seconds of user action and be screen‑reader friendly.
      - Confirmation banners must be visible for at least 5 seconds after a successful save.

  - id: NFR-0036
    description: The system must scale to accommodate high concurrent usage without performance degradation.
    related_fr:
      - FR-0031
      - FR-0032
    measurement:
      - Handle 1 million concurrent patient sessions with page load times <= 2 seconds, verified by load‑testing simulation.
      - Messaging dispatch for preferences must be processed asynchronously with a maximum queue latency of 30 seconds under peak load.


  - id: NFR-0032
    description: The appointment list page must load within 2 seconds for 95 % of accesses.
    related_fr:
      - FR-0031
      - FR-0035
    measurement:
      - Target: Page load time < 2 seconds for 95 % of sessions.
      - Verification: Automated performance tests using load‑testing tools (e.g., JMeter) and continuous monitoring dashboards.

  - id: NFR-0033
    description: The appointment viewing feature shall have 99.9 % uptime over a 30‑day period.
    related_fr:
      - FR-0031
      - FR-0032
      - FR-0033
      - FR-0034
      - FR-0035
    measurement:
      - Target: 99.9 % availability.
      - Verification: System uptime logs, health‑check endpoints, and third‑party monitoring services (e.g., Pingdom).

  - id: NFR-0034
    description: The system shall encrypt patient appointment data in transit and at rest, and require multi‑factor authentication (MFA) for portal access.
    related_fr:
      - FR-0031
      - FR-0032
      - FR-0033
      - FR-0034
      - FR-0035
    measurement:
      - Target: TLS 1.2+ for all HTTPS traffic; AES‑256 encryption for stored data; MFA enabled for all portal logins.
      - Verification: Penetration testing reports, encryption audits, and MFA usage logs.

  - id: NFR-0035
    description: The appointment pages must comply with WCAG 2.1 AA accessibility standards.
    related_fr:
      - FR-0031
      - FR-0032
      - FR-0033
      - FR-0034
      - FR-0035
    measurement:
      - Target: Accessibility score ≥ 90 % on automated scan tools (e.g., axe), and successful manual testing with screen readers (NVDA/VoiceOver) and keyboard navigation.
      - Verification: Accessibility audit reports and user testing sessions with disabled participants.

  - id: NFR-0036
    description: The appointment viewing interface shall render correctly on iOS and Android browsers as well as on the native mobile app, ensuring consistent layout and functionality.
    related_fr:
      - FR-0031
      - FR-0032
      - FR-0033
      - FR-0034
      - FR-0035
    measurement:
      - Target: Responsive design passes layout tests on devices with screen widths 320 px to 1920 px.
      - Verification: Cross‑device testing using BrowserStack and in‑house device labs, with automated screenshot comparison.

  - id: NFR-0037
    description: Appointment data displayed must reflect the latest EHR state within 5 seconds of an update.
    related_fr:
      - FR-0034
    measurement:
      - Target: UI refresh time ≤ 5 seconds after EHR change.
      - Verification: Simulated EHR update events and UI timestamp checks in automated integration tests.

  - id: NFR-0043
    description: The end‑to‑end cancellation process (from click to status update) must complete in 2 seconds or less, 90% of the time.
    related_fr:
      - FR-0045
      - FR-0046
    measurement:
      - Response time measured from client click to confirmation message displayed must be ≤ 2s for 90% of requests.
      - Performance monitoring must capture and report average latency and 90th percentile latency.

  - id: NFR-0044
    description: The portal must maintain 99.9% uptime during business hours (8 AM–6 PM local time) for all cancellation-related features.
    related_fr: []
    measurement:
      - Availability monitored via uptime checks on the appointments API endpoints.
      - SLA report must show uptime ≥ 99.9% per month.

  - id: NFR-0045
    description: All cancellation actions must be protected by authentication (JWT or OAuth) and role‑based access control, ensuring only the owning patient can cancel.
    related_fr:
      - FR-0042
      - FR-0043
      - FR-0045
    measurement:
      - Unauthorized access attempts must be logged and blocked with HTTP 401/403.
      - Token expiration must trigger re‑authentication without losing unsaved state.

  - id: NFR-0046
    description: Audit logs for cancellations must be immutable, tamper‑proof, and retained for a minimum of 7 years.
    related_fr:
      - FR-0047
    measurement:
      - Audit entries must be stored in a write‑once storage layer (e.g., append‑only log) and verified by cryptographic hash chaining.
      - Retention policy verified by periodic export and archival.

  - id: NFR-0047
    description: The cancellation flow must be a single‑click action after the confirmation dialog, with no additional steps or required form fields.
    related_fr:
      - FR-0043
      - FR-0044
    measurement:
      - Usability test must confirm that 95% of users can cancel within 3 clicks (including the initial click and confirmation).
      - UI must not display additional input fields during cancellation.

  - id: NFR-0048
    description: The user interface for cancellation must meet WCAG 2.1 AA accessibility standards and be responsive on all devices.
    related_fr:
      - FR-0043
      - FR-0044
      - FR-0049
    measurement:
      - Accessibility audit (axe, Lighthouse) must score 100% on WCAG 2.1 AA criteria.
      - Responsive design must render correctly on screen widths from 320 px to 1920 px with no horizontal scroll.



  - id: NFR-0043
    description: All data transmissions must be encrypted using TLS 1.2 or higher (100% compliance).
    related_fr:
      - FR-0043
    measurement:
      - 100% of outbound HTTP/HTTPS requests must use TLS 1.2+.
      - Verification via automated network scanning that no connections use TLS 1.0 or TLS 1.1.

  - id: NFR-0044
    description: Zero security incidents involving patient data over a 12‑month period.
    related_fr:
      - FR-0047
    measurement:
      - 0 incidents logged in the incident management system where patient data was compromised.
      - Verification through quarterly audit reports and incident log reviews.

  - id: NFR-0045
    description: Audit logs must be exportable in HIPAA, GDPR, and local DPA compliant formats.
    related_fr:
      - FR-0045
    measurement:
      - Export function produces CSV, JSON, and XML compliant with regulatory schemas.
      - Verification by exporting a sample log and validating against the respective schemas.

  - id: NFR-0046
    description: Compliance with local data‑privacy laws, including data residency constraints (data stored only in approved regions).
    related_fr:
      - FR-0042
      - FR-0043
      - FR-0044
    measurement:
      - 100% of patient data resides in data centers located within the jurisdiction of the clinic.
      - Verification via data center location audit and data residency tagging.

  - id: NFR-0047
    description: Achieve 99.9% uptime for all compliance‑related services (encryption, RBAC, audit, incident workflow).
    related_fr:
      - FR-0042
      - FR-0043
      - FR-0044
      - FR-0045
      - FR-0046
      - FR-0047
      - FR-0048
    measurement:
      - System availability measured by uptime monitoring over a 30‑day period must be ≥ 99.9%.
      - Verification via external uptime monitoring services and internal logs.

  - id: NFR-0048
    description: Encryption/decryption processing time must be less than 200 ms per request.
    related_fr:
      - FR-0042
      - FR-0043
    measurement:
      - Average latency of encryption/decryption operations measured in a load test must be < 200 ms.
      - Verification via performance testing tools (e.g., JMeter, k6) and recorded metrics.

  - id: NFR-0049
    description: MFA for privileged roles must enforce a second factor for every authentication attempt.
    related_fr:
      - FR-0048
    measurement:
      - 100% of privileged login attempts must pass through the MFA challenge.
      - Verification through authentication logs and MFA service reports.

  - id: NFR-0050
    description: Penetration testing must be performed quarterly (or bi‑annual if required).
    related_fr:
      - FR-0047
    measurement:
      - A penetration test report must be produced and signed off every 90 days.
      - Verification via documented test schedule and signed reports.

  - id: NFR-0051
    description: Audit trail integrity must be ensured through cryptographic hash chaining.
    related_fr:
      - FR-0045
    measurement:
      - Each audit record must contain a hash of the previous record; hash chain verification must pass without errors.
      - Verification through automated integrity checks run nightly.

  - id: NFR-0043
    description: |
      The portal must achieve a performance target of 90% of page loads completing
      within 2 seconds, measured by synthetic tests and real‑user monitoring.
    related_fr:
      - FR-0042
      - FR-0043
      - FR-0044
      - FR-0045
    measurement:
      - 90% of all page load events recorded by RUM must have a total load time <= 2,000 ms.
      - Verification via a nightly synthetic test script that simulates 10,000 page loads and calculates the 90th percentile load time.

  - id: NFR-0044
    description: |
      95% of patients must report satisfaction with portal speed in post‑booking surveys.
    related_fr:
      - FR-0042
      - FR-0043
      - FR-0044
      - FR-0045
    measurement:
      - 95% of survey responses that include a speed rating must select "Very Fast" or "Fast".
      - Verification via monthly survey analysis report.

  - id: NFR-0045
    description: |
      The portal and CDN must maintain an uptime of 99.9% over any 30‑day period.
    related_fr:
      - FR-0043
      - FR-0047
    measurement:
      - Uptime calculated as (total available seconds / total seconds in period) * 100 >= 99.9%.
      - Verification via external uptime monitoring service logs.

  - id: NFR-0046
    description: |
      All portal traffic must use HTTPS 1.3 with TLS 1.3 enforced, and a Content Security Policy (CSP) must be applied to mitigate XSS.
    related_fr:
      - FR-0042
      - FR-0043
      - FR-0044
      - FR-0045
    measurement:
      - HTTPS 1.3 handshake confirmed for 100% of client connections.
      - CSP header present with directives: default-src 'self'; script-src 'self'; object-src 'none'.
      - Verification via automated security scanner and penetration testing report.

  - id: NFR-0047
    description: |
      The portal must comply with WCAG 2.1 AA accessibility guidelines for all dynamically loaded content.
    related_fr:
      - FR-0042
      - FR-0044
      - FR-0045
    measurement:
      - WCAG 2.1 AA audit score >= 95% for all pages.
      - Verification via automated accessibility testing tool (e.g., axe-core) integrated into CI pipeline.

  - id: NFR-0048
    description: |
      Web and API layers must auto‑scale based on the 95th percentile response time, ensuring no single instance exceeds 250 ms under normal load.
    related_fr:
      - FR-0044
      - FR-0045
    measurement:
      - 95th percentile response time <= 250 ms for all API endpoints during peak hours.
      - Auto‑scaling triggers when 95th percentile > 250 ms; verification via cloud provider auto‑scaling logs.

  - id: NFR-0064
    description: The system must process the patient’s accept or override action and persist the selection within 3 seconds of the user’s tap.
    related_fr:
      - FR-0063
      - FR-0064
      - FR-0066
    measurement:
      - Response time from UI tap to database write must be ≤ 3 seconds.
      - Verification: Instrument the backend to log timestamps for request receipt and DB commit; compute average latency across 95th percentile.
  - id: NFR-0065
    description: The system must record 99% of final selections in the appointment database without error.
    related_fr:
      - FR-0066
    measurement:
      - Success rate = (successful writes / total write attempts) * 100% ≥ 99%.
      - Verification: Monitor logs for 500 errors; calculate success ratio over a rolling 24‑hour period.
  - id: NFR-0066
    description: All patient data and booking requests must be transmitted over TLS 1.3 and audit logs must capture the final slot choice with timestamp and patient ID.
    related_fr:
      - FR-0066
      - FR-0067
    measurement:
      - All HTTP/HTTPS endpoints use TLS 1.3; verify via SSL Labs scan.
      - Audit log entries include patient ID, appointment ID, slot timestamp, and action type; verified by sampling log files.
  - id: NFR-0067
    description: The UI must meet WCAG 2.1 AA accessibility standards.
    related_fr:
      - FR-0062
      - FR-0063
      - FR-0064
    measurement:
      - Automated accessibility testing (axe, Lighthouse) score ≥ 90% with no critical violations.
      - Manual screen‑reader test passes for all interactive elements.
  - id: NFR-0068
    description: The backend service must handle 10× the current peak booking traffic without degradation of response time.
    related_fr:
      - FR-0066
    measurement:
      - Load test simulating 10× peak concurrent users; average response time ≤ 2 seconds; CPU and memory usage ≤ 80%.
  - id: NFR-0069
    description: The acceptance or override flow must complete for 90% of patients within 5 seconds to meet the success metric.
    related_fr:
      - FR-0063
      - FR-0064
    measurement:
      - Measure end‑to‑end latency from UI tap to confirmation display; 90th percentile latency ≤ 5 seconds.
  - id: NFR-0070
    description: The system must ensure data integrity by preventing duplicate appointment records for the same patient and slot.
    related_fr:
      - FR-0065
      - FR-0066
    measurement:
      - Duplicate insertion attempts trigger a 409 Conflict; verified by attempting to create the same appointment twice and observing the response code.

  - id: NFR-0064
    description: >
      Performance: 99.5% of booking attempts must pass the conflict check within 1
      second.
    related_fr:
      - FR-0062
      - FR-0068
    measurement:
      - "Latency measured via APM; 99.5% percentile latency ≤ 1,000 ms over a 30‑day period."
      - "Performance dashboards verify the metric; alerts trigger if threshold breached."

  - id: NFR-0065
    description: >
      Reliability: The conflict detection system must flag incorrect conflicts for
      no more than 0.5% of booking attempts.
    related_fr:
      - FR-0062
    measurement:
      - "Error rate calculated from audit logs; ≤ 0.5% over a 30‑day period."
      - "Manual review of flagged bookings confirms accuracy."

  - id: NFR-0066
    description: >
      Scalability: The system must support at least 200 concurrent booking attempts
      per second without degradation.
    related_fr:
      - FR-0062
    measurement:
      - "Load testing results show sustained 200 TPS with latency ≤ 1,000 ms."
      - "Horizontal scaling metrics confirm no resource bottlenecks."

  - id: NFR-0067
    description: >
      Availability: The Conflict Check microservice must maintain 99.9% uptime
      over a rolling 30‑day period.
    related_fr:
      - FR-0062
    measurement:
      - "Uptime monitored by health checks; SLA of 99.9% verified by uptime reports."
      - "Failover mechanisms activate within 30 seconds of failure."

  - id: NFR-0068
    description: >
      Security: All data in transit must use TLS 1.3 and all data at rest must be
      encrypted with AES‑256.
    related_fr:
      - FR-0062
      - FR-0063
    measurement:
      - "TLS 1.3 verified by SSL/TLS scanning tools."
      - "Database encryption keys rotated quarterly; encryption verified by audit."

  - id: NFR-0069
    description: >
      Observability: The system must log conflict check attempts and expose metrics
      for latency, error rates, and conflict outcomes.
    related_fr:
      - FR-0067
      - FR-0064
    measurement:
      - "Logs ingested into ELK stack; dashboards display real‑time metrics."
      - "Alerting configured for latency > 1,500 ms or error rate > 1%."

  - id: NFR-0070
    description: >
      Data Consistency: The conflict detection algorithm must run in a single
      database transaction to prevent double‑booking under high concurrency.
    related_fr:
      - FR-0063
    measurement:
      - "Transaction logs show atomic commit/rollback per conflict check."
      - "Consistency tests simulate concurrent bookings and confirm no overlaps."

  - id: NFR-0078
    description: The entire conflict resolution cycle, including data retrieval, rule application, slot generation, atomic commit, and notification, must complete within 30 seconds for 95 % of executions.
    related_fr:
      - FR-0084
    measurement:
      - Latency of `/resolve-conflict` endpoint must be ≤30 s for ≥95 % of requests.
      - Verify by instrumenting the API with a timer and aggregating metrics in Prometheus.

  - id: NFR-0079
    description: The resolution service must maintain 99.9 % uptime, measured over a 30‑day rolling window.
    related_fr: []
    measurement:
      - Uptime percentage calculated from health‑check metrics (HTTP 200 on `/healthz`).
      - Alert if downtime exceeds 0.1 % in any 30‑day period.

  - id: NFR-0080
    description: The system must achieve an automatic resolution success rate of ≥95 % within 30 seconds, with a double‑booking rate of <1 % after resolution.
    related_fr:
      - FR-0081
    measurement:
      - Track resolution success and double‑booking incidents in an event store; compute percentages monthly.
      - Verify by running regression tests against known conflict scenarios.

  - id: NFR-0081
    description: All data exchanges with external services must use TLS 1.3 or higher, and access to rule and conflict data must be protected by role‑based access control.
    related_fr:
      - FR-0085
    measurement:
      - SSL/TLS handshake verification via automated scans.
      - RBAC enforcement tested via penetration tests and unit tests.

  - id: NFR-0082
    description: The engine must handle up to 10,000 concurrent conflict resolution requests per minute without a >10 % increase in average latency.
    related_fr:
      - FR-0084
    measurement:
      - Load test using k6 to simulate 10k rps; measure latency distribution.
      - Verify horizontal scaling by adding instances and monitoring CPU/memory usage.

  - id: NFR-0083
    description: The system must expose metrics for resolution count, success rate, average latency, and double‑booking incidents, with alerts for anomalies exceeding 3 σ from the mean.
    related_fr:
      - FR-0084
    measurement:
      - Metrics published to Prometheus; alerts configured in Alertmanager.
      - Verify by injecting synthetic incidents and observing alert triggers.

  - id: NFR-0084
    description: The codebase must achieve ≥90 % unit test coverage and ≥80 % integration test coverage, with all tests passing in the CI pipeline before each release.
    related_fr: []
    measurement:
      - Coverage reports generated by coverage tools (e.g., Jacoco, Istanbul).
      - CI pipeline must fail if coverage thresholds are not met.

  - id: NFR-0085
    description: The engine must comply with GDPR for all personal data, ensuring that data is stored encrypted at rest and that users can request deletion within 30 days.
    related_fr:
      - FR-0083
    measurement:
      - Encryption verified via database audit logs.
      - Data deletion requests processed within 30 days, confirmed by audit trail entries.

    description: |
      Performance: End‑to‑end cancellation processing must complete within 5 seconds, and metrics updates must occur within 2 seconds of cancellation.
    related_fr:
      - FR-0077
      - FR-0078
      - FR-0079
    measurement:
      - Response time < 5 seconds measured by automated load tests.
      - Metrics update latency < 2 seconds measured by event timestamps.
      - Verification via performance monitoring dashboards.

  - id: NFR-0081
    description: |
      Transactional Integrity: The deletion of the appointment record and the update of the slot status must be atomic; partial updates are forbidden.
    related_fr:
      - FR-0077
      - FR-0078
    measurement:
      - All integration tests confirm that a rollback occurs on any failure during the transaction.
      - No orphaned slot or appointment records remain after a failed cancellation.
      - Verification through database consistency checks.

  - id: NFR-0082
    description: |
      Security: All cancellation requests must be authenticated via OAuth2, authorized with role‑based access control, and all data must be encrypted at rest and in transit.
    related_fr:
      - FR-0077
      - FR-0080
    measurement:
      - OAuth2 tokens validated with a 30‑minute expiry window.
      - Role checks enforce that only the appointment owner or a doctor can cancel.
      - TLS 1.2+ encryption for all API traffic.
      - Verification through security audits and penetration testing.

  - id: NFR-0083
    description: |
      Reliability: The cancellation service must maintain 99.9% availability, employing a circuit‑breaker pattern and graceful degradation in case of downstream failures.
    related_fr:
      - FR-0077
      - FR-0081
    measurement:
      - Uptime > 99.9% over a 30‑day period measured by uptime monitoring tools.
      - Circuit breaker trips after 5 consecutive failures and recovers after a cooldown period.
      - Verification through monitoring dashboards and incident logs.

  - id: NFR-0084
    description: |
      Scalability: The system must handle at least 200 cancellation requests per second without degradation in performance or reliability.
    related_fr:
      - FR-0077
      - FR-0081
    measurement:
      - Load tests demonstrate 200 req/s throughput with <5% increase in average latency.
      - System resources (CPU, memory) remain within acceptable thresholds.
      - Verification through automated load‑testing scripts.

  - id: NFR-0085
    description: |
      Observability: All cancellation events, errors, and performance metrics must be logged, traced, and exposed to monitoring systems with alerts for delays exceeding 5 seconds or error rates above 1%.
    related_fr:
      - FR-0077
      - FR-0081
    measurement:
      - Logs contain structured fields: request ID, user ID, appointment ID, status.
      - Tracing spans cover API entry, business logic, database operations, and notification dispatch.
      - Alerts triggered when latency > 5s or error rate > 1% within a 5‑minute window.
      - Verification via monitoring dashboards and alerting tools.

  - id: NFR-0091
    description: >
      The system must detect a no‑show and send the first notification within
      10 minutes of the scheduled appointment start time.
    related_fr:
      - FR-0092
      - FR-0094
    measurement:
      - "Detection latency ≤ 10 minutes (measured from scheduled start to
        status update)."
      - "Notification send time ≤ 10 minutes after detection (measured by
        system logs)."

  - id: NFR-0092
    description: >
      The system must handle at least 10,000 concurrent appointments without
      degradation in detection or notification performance.
    related_fr:
      - FR-0092
      - FR-0093
      - FR-0094
    measurement:
      - "CPU usage < 70% and memory usage < 80% under peak load."
      - "End‑to‑end latency for notification ≤ 2 seconds under load."

  - id: NFR-0093
    description: >
      The scheduling and notification subsystems must have a 99.5% uptime
      during business hours and 99.9% uptime overall.
    related_fr:
      - FR-0092
      - FR-0093
      - FR-0094
    measurement:
      - "Monthly uptime reports showing < 0.5% downtime for scheduling and
        < 0.1% for notifications."

  - id: NFR-0094
    description: >
      All patient data, including audit logs, must be stored encrypted at
      rest and in transit, and the system must comply with HIPAA and GDPR.
    related_fr:
      - FR-0095
    measurement:
      - "Encryption keys rotated quarterly."
      - "Compliance audit passed with zero critical findings."

  - id: NFR-0095
    description: >
      The system must automatically retry failed notification attempts up to
      three times with exponential back‑off, and mark the notification as
      failed after the third attempt.
    related_fr:
      - FR-0094
    measurement:
      - "Retry logic triggers after 30 s, 60 s, and 120 s intervals."
      - "Failed notifications logged with error codes."

  - id: NFR-0096
    description: >
      Notification messages must meet WCAG 2.1 AA accessibility standards
      for readability and color contrast.
    related_fr:
      - FR-0094
    measurement:
      - "Automated accessibility tests pass for all templates."
      - "Manual review confirms contrast ratios ≥ 4.5:1 for text."

  - id: NFR-0097
    description: >
      Audit logs must be tamper‑evident and immutable, with a hash chain
      verification process that can be audited monthly.
    related_fr:
      - FR-0095
    measurement:
      - "Hash chain integrity verified without errors."
      - "Audit logs stored in a write‑once, read‑many (WORM) storage system."

  - id: NFR-0098
    description: >
      The system must provide real‑time analytics on no‑show rates and
      reschedule acceptance rates, with a maximum data latency of 5 minutes.
    related_fr:
      - FR-0096
    measurement:
      - "Dashboard data refresh interval ≤ 5 minutes."
      - "API response time for analytics endpoints ≤ 1 second."

  - id: NFR-0991
    description: |
      All rule‑management operations must be accessible only to authenticated users with the Clinic Administrator role, and every action must be logged with user identity and timestamp.
    related_fr:
      - FR-0991
      - FR-0995
    measurement:
      - "Access control must enforce role checks before any rule operation; attempts by unauthorized users result in a 403 response."
      - "Audit logs must record the administrator’s user ID for each rule change within 1 s of the action."

  - id: NFR-0992
    description: |
      Validation and deployment of rule changes must complete within 5 seconds under normal load (up to 100 concurrent administrators).
    related_fr:
      - FR-0992
      - FR-0994
    measurement:
      - "End‑to‑end latency from form submission to confirmation must be ≤ 5 s in 95th percentile."
      - "Performance tests with 100 concurrent sessions must confirm the latency target."

  - id: NFR-0993
    description: |
      The rule‑management service and conflict‑resolution engine must maintain 99.99% availability, ensuring that rule changes and conflict decisions can be processed 24/7.
    related_fr:
      - FR-0991
      - FR-0994
      - FR-0996
    measurement:
      - "Uptime monitoring over a 30‑day period must show ≤ 0.01% downtime."
      - "Health‑check endpoints should return 200 OK when the system is operational."

  - id: NFR-0994
    description: |
      The rollback mechanism must guarantee 100% success in restoring the previous rule configuration when a deployment fails.
    related_fr:
      - FR-0997
    measurement:
      - "Automated rollback tests must pass without data loss in all simulated failure scenarios."
      - "Post‑rollback audit logs must contain a record of the restored state."

  - id: NFR-0995
    description: |
      The rule‑management UI must comply with WCAG 2.1 AA accessibility guidelines to support all administrators.
    related_fr:
      - FR-0991
    measurement:
      - "Automated accessibility scans must report zero critical or high‑severity issues."
      - "Manual testing with screen reader must confirm that all interactive elements are reachable and labeled."

  - id: NFR-0996
    description: |
      The rule engine must continue to process conflict decisions with no performance degradation when concurrent appointments increase to 10× the current peak load.
    related_fr:
      - FR-0994
    measurement:
      - "Conflict resolution latency must remain ≤ 2 s under 10× peak concurrent appointments."
      - "CPU and memory usage should not exceed 80% of allocated resources during peak load."

  - id: NFR-0997
    description: |
      All rule changes must be persisted with transactional consistency; partial updates must not leave the system in an inconsistent state.
    related_fr:
      - FR-0991
      - FR-0992
      - FR-0995
    measurement:
      - "Database transactions must commit or rollback atomically; no orphaned or half‑applied rules."
      - "Consistency checks run nightly must detect zero anomalies."

  - id: NFR-0106
    description: The audit logging subsystem must guarantee 100 % durability of events, even in the event of a system crash or power loss.
    related_fr:
      - FR-0109
    measurement:
      - Event loss percentage must be < 0.01 % over a 30‑day period, verified by periodic consistency checks.
      - Durability is verified by inducing a controlled crash after write and confirming event retrieval on restart.

  - id: NFR-0107
    description: Write latency for each audit log event must not exceed 50 ms, ensuring no perceptible impact on main transaction flows.
    related_fr:
      - FR-0106
      - FR-0107
    measurement:
      - Average write latency measured via instrumentation must be ≤ 50 ms, with 95 % of writes below this threshold.

  - id: NFR-0108
    description: Read queries (search, filter, export) must respond within 2 seconds for result sets up to 100 k records.
    related_fr:
      - FR-0110
      - FR-0111
    measurement:
      - Latency measured via load testing must be ≤ 2000 ms for 100 k records; 90 % of queries below 1 s.

  - id: NFR-0109
    description: The system must ingest up to 10 000 conflict events per minute without queue buildup or back‑pressure.
    related_fr:
      - FR-0106
      - FR-0107
    measurement:
      - Throughput measured under simulated load must reach ≥ 10 000 events/min with ≤ 5 % queue length growth.

  - id: NFR-0110
    description: The audit logging service must provide 99.9 % uptime over a 30‑day period, including fail‑over between cluster nodes.
    related_fr:
      - FR-0109
    measurement:
      - Availability measured via uptime monitoring; any downtime must be logged and investigated.

  - id: NFR-0111
    description: Audit logs must be encrypted at rest using AES‑256 encryption, complying with industry best practices.
    related_fr:
      - FR-0109
    measurement:
      - Encryption verified by inspecting storage format and ensuring that raw data is not readable without the decryption key.

  - id: NFR-0112
    description: Audit logs must be tamper‑evident, implemented via cryptographic hash chaining, and tamper attempts must be detectable.
    related_fr:
      - FR-0113
    measurement:
      - Periodic hash chain verification must detect any unauthorized modifications; any detection triggers an alert.

  - id: NFR-0113
    description: Audit logs must be retained for a minimum of five years, after which they are archived securely and marked immutable.
    related_fr:
      - FR-0112
    measurement:
      - Retention policy compliance verified by audit reports showing all entries older than five years are archived and immutable.

  - id: NFR-0114
    description: Role‑based access control must ensure that only users with the “Audit Admin” role can read audit logs; all other users are denied.
    related_fr:
      - FR-0114
    measurement:
      - Access control enforcement verified by attempting read operations with various roles and confirming expected outcomes.

  - id: NFR-0115
    description: The time‑zone conversion logic must achieve 100 % accuracy for all supported IANA zones, verified by unit tests.
    related_fr:
      - FR-0116
      - FR-0118
    measurement:
      - Unit tests must report 100 % correct conversion results across all test cases.
      - Verification method: Continuous integration pipeline runs tests on every build and fails if any conversion is incorrect.

  - id: NFR-0116
    description: The time‑zone conversion service must complete a single conversion in less than 10 ms to maintain UI responsiveness.
    related_fr:
      - FR-0116
      - FR-0120
    measurement:
      - Performance benchmark: average latency < 10 ms under a load of 1,000 concurrent requests.
      - Verification method: Load testing tool (e.g., k6) measuring response times.

  - id: NFR-0117
    description: The system must handle at least 10,000 concurrent time‑zone conversion requests without performance degradation.
    related_fr:
      - FR-0120
    measurement:
      - Scalability test: 10,000 concurrent requests with < 20 % increase in average latency.
      - Verification method: Stress test using a distributed load generator.

  - id: NFR-0118
    description: The time‑zone conversion API must be available 99.99 % of the time over a 30‑day period.
    related_fr:
      - FR-0120
    measurement:
      - Uptime monitoring reports 99.99 % availability.
      - Verification method: External uptime monitoring service (e.g., Pingdom) and internal health‑check logs.

  - id: NFR-0119
    description: All time‑zone data transmitted or persisted must be encrypted in transit using TLS 1.2 or higher and must not be logged in plaintext.
    related_fr:
      - FR-0115
      - FR-0116
      - FR-0117
    measurement:
      - Network traffic inspection shows TLS handshake and encrypted payloads.
      - Log review confirms absence of time‑zone data in logs.
      - Verification method: Security audit and penetration testing.

  - id: NFR-0120
    description: The user interface for time‑zone selection and conversion confirmation must comply with WCAG 2.1 AA accessibility guidelines.
    related_fr:
      - FR-0115
      - FR-0116
    measurement:
      - Automated accessibility scan reports no critical or major violations.
      - Manual review confirms keyboard navigation and screen reader support.
      - Verification method: Lighthouse audit and screen reader testing.

  - id: NFR-0121
    description: Replay latency must meet the business metric of replaying 99 % of queued changes within 5 minutes after reconnection.
    related_fr:
      - FR-0124
      - FR-0125
    measurement:
      - 99 % of replayed changes must complete within 5 minutes from the moment reconnection is detected.
      - Verification by monitoring replay timestamps in the audit trail.

  - id: NFR-0122
    description: Data integrity – no data loss or duplicate appointments during replay.
    related_fr:
      - FR-0126
    measurement:
      - 100 % of replayed changes must result in exactly one corresponding appointment in the external system.
      - Verification by cross‑checking local queue status against external calendar records after replay.

  - id: NFR-0123
    description: Local queue persistence latency must not exceed 200 ms per scheduling change.
    related_fr:
      - FR-0122
    measurement:
      - Latency measured from change submission to completion of write to local store must be ≤ 200 ms.
      - Verification via instrumentation logs.

  - id: NFR-0124
    description: Queue capacity and scalability – the system must handle up to 10,000 pending changes without performance degradation.
    related_fr:
      - FR-0123
    measurement:
      - Queue operations (enqueue, dequeue, retry) must maintain ≤ 500 ms latency when 10,000 items are queued.
      - Verification by load testing with 10,000 queued changes.

  - id: NFR-0125
    description: Security – all locally stored changes must be encrypted at rest using AES‑256.
    related_fr:
      - FR-0122
      - FR-0123
    measurement:
      - Encryption key length 256 bits, algorithm AES‑256 in CBC mode with PKCS7 padding.
      - Verification by inspecting storage format and running a penetration test.

  - id: NFR-0126
    description: Retry policy – maximum of 3 replay attempts per change before manual intervention.
    related_fr:
      - FR-0125
    measurement:
      - Retry counter per change must not exceed 3; after the third failure, change is marked as failed.
      - Verification via audit trail logs.

  - id: NFR-0127
    description: UI notification latency – user-facing notifications of pending or replayed changes must appear within 500 ms.
    related_fr:
      - FR-0128
    measurement:
      - Time from event trigger to notification display ≤ 500 ms.
      - Verification by front‑end performance monitoring.

  - id: NFR-0128
    description: Service availability – the replay service must achieve 99.95 % uptime during business hours.
    related_fr:
      - FR-0124
      - FR-0125
    measurement:
      - Uptime measured over 30‑day periods; downtime must not exceed 8.64 minutes per month.
      - Verification via uptime monitoring dashboards.

  - id: NFR-0129
    description: 99% of notifications must be delivered within 10 seconds of the slot event.
    related_fr:
      - FR-0129
      - FR-0130
      - FR-0131
    measurement:
      - 99% of sent notifications have a delivery latency <= 10 seconds.
      - Verify by sampling 1,000 random notifications per day and measuring time from event timestamp to delivery timestamp in the audit log.

  - id: NFR-0130
    description: The notification delivery system must retry up to 3 times for transient failures and use a fallback channel if the primary channel fails.
    related_fr:
      - FR-0129
      - FR-0130
      - FR-0131
    measurement:
      - Retry count <= 3 for each notification.
      - Fallback channel used when primary channel returns a non‑recoverable error.
      - Verify by inducing failures in the primary channel and observing retry logs.

  - id: NFR-0131
    description: The system must support sending up to 10,000 notifications per minute during peak booking hours without degradation.
    related_fr:
      - FR-0129
      - FR-0130
      - FR-0131
    measurement:
      - Throughput >= 10,000 notifications/min during load test.
      - System response time for queuing notifications <= 200 ms under peak load.
      - Verify through automated load testing with simulated 10,000 events per minute.

  - id: NFR-0132
    description: All push and email notifications must be end‑to‑end encrypted; SMS content must be stored securely.
    related_fr:
      - FR-0129
      - FR-0130
      - FR-0131
      - FR-0133
    measurement:
      - Encryption keys rotated every 90 days.
      - No plaintext notification content in transit or at rest.
      - Verify by penetration testing and key audit logs.

  - id: NFR-0133
    description: User contact data (phone numbers, email addresses) must be stored in a GDPR‑compliant manner, encrypted at rest, and access restricted to authorized services.
    related_fr:
      - FR-0132
    measurement:
      - Encryption at rest using AES‑256.
      - Access logs show only authorized services query contact data.
      - Verify by audit logs and compliance review.

  - id: NFR-0134
    description: The notification system must maintain an immutable audit trail of all sent notifications, including timestamps, delivery status, and acknowledgment status.
    related_fr:
      - FR-0133
    measurement:
      - Audit log entries are write‑only and tamper‑evident (e.g., using append‑only storage or blockchain).
      - 100% of notifications have an audit record.
      - Verify by sampling audit logs and checking for missing entries.

  - id: NFR-0135
    description: The notification service must achieve 99.9% uptime, excluding scheduled maintenance windows.
    related_fr:
      - FR-0129
      - FR-0130
      - FR-0131
      - FR-0132
      - FR-0133
    measurement:
      - Uptime calculated over 30‑day rolling window.
      - Verify through uptime monitoring and incident reports.

  - id: NFR-0136
    description: |
      Latency SLA: 95% of metric updates (calculation + broadcast) must complete within 2 seconds of the triggering event.
    related_fr:
      - FR-0134
      - FR-0135
    measurement:
      - Metric: Percentage of metric update cycles that finish <= 2 seconds.
      - Verification: Real‑time monitoring dashboard shows latency distribution; automated SLA checker flags breaches.

  - id: NFR-0137
    description: |
      Reliability: 100% of subsequent slot checks must use the latest crowd metric; no stale reads are permitted.
    related_fr:
      - FR-0136
    measurement:
      - Metric: percentage of slot check responses that include a metric timestamp within 5 seconds of the latest calculation timestamp.
      - Verification: Audit log comparison between calculation timestamps and slot check timestamps.

  - id: NFR-0138
    description: |
      Scalability: The system must handle up to 10,000 concurrent booking or cancellation events during peak periods without violating the 2‑second latency SLA.
    related_fr:
      - FR-0134
      - FR-0135
    measurement:
      - Metric: Peak concurrent event rate processed while maintaining < 2s latency for 95% of updates.
      - Verification: Load‑testing results and real‑world traffic monitoring.

  - id: NFR-0139
    description: |
      Security: All metric update messages transmitted between services must use TLS 1.3+ and be protected by fine‑grained role‑based access controls.
    related_fr:
      - FR-0135
    measurement:
      - Metric: percentage of inter‑service messages that establish a TLS 1.3+ session and include valid service identity.
      - Verification: TLS handshake logs and ACL audit trails.

  - id: NFR-0140
    description: |
      Observability: The system must expose Prometheus metrics for update latency and failure rates, ship logs to a centralized platform, and trigger alerts when SLA breaches or repeated failures occur.
    related_fr:
      - FR-0134
      - FR-0135
      - FR-0137
    measurement:
      - Metric: Availability of Prometheus endpoint; alert count per 24‑hour period; log ingestion latency < 5 seconds.
      - Verification: Prometheus query results, alert manager dashboards, and log aggregation platform checks.

  - id: NFR-0141
    description: Encryption and decryption operations must complete with a latency of no more than 2 ms per KB of data processed.
    related_fr:
      - FR-0139
      - FR-0140
      - FR-0141
    measurement:
      - Average latency measured over 1,000 encryption/decryption operations must be ≤ 2 ms per KB.
      - Latency must not exceed 4 ms per KB in any 99th percentile measurement.

  - id: NFR-0142
    description: Key‑management API responses must be ≤ 20 ms for 99.5 % of requests.
    related_fr:
      - FR-0142
      - FR-0143
    measurement:
      - 99.5 % of KMS API calls must return within 20 ms.
      - The maximum observed response time must not exceed 50 ms.

  - id: NFR-0143
    description: The encryption service must provide 99.95 % uptime over a 30‑day period.
    related_fr:
      - FR-0139
      - FR-0140
      - FR-0141
    measurement:
      - Service uptime calculated from health‑check logs must be ≥ 99.95 %.
      - Any downtime must be logged with cause and duration.

  - id: NFR-0144
    description: Key rotation must occur automatically every 90 days without manual intervention.
    related_fr:
      - FR-0143
    measurement:
      - Rotation events logged must occur at 90‑day intervals (±2 days).
      - No rotation event should be missed for more than 5 consecutive days.

  - id: NFR-0145
    description: Audit logs must be immutable, append‑only, and retained for at least 7 years.
    related_fr:
      - FR-0145
    measurement:
      - Log entries must be cryptographically signed and stored in a write‑once medium.
      - Log retention policy must be verified by audit logs covering a 7‑year window.

  - id: NFR-0146
    description: All stored data must be encrypted exclusively with AES‑256; no weaker algorithms may be used.
    related_fr:
      - FR-0139
      - FR-0140
    measurement:
      - Periodic scans of storage must report 100 % compliance with AES‑256 encryption.
      - Any detection of weaker encryption must trigger an alert and remediation workflow.

  - id: NFR-0147
    description: All network channels must enforce TLS 1.2+ and must not allow protocol downgrade attacks.
    related_fr:
      - FR-0141
      - FR-0147
    measurement:
      - TLS handshake logs must show TLS 1.2+ or higher for every connection.
      - No TLS 1.0 or 1.1 connections are allowed; any attempt is logged and blocked.

  - id: NFR-0148
    description: Key access must be restricted to authorized roles and require two‑factor authentication for key retrieval.
    related_fr:
      - FR-0144
    measurement:
      - 100 % of key‑retrieval attempts must include a successful 2FA challenge.
      - Unauthorized attempts must be logged and blocked.

  - id: NFR-0149
    description: Compliance reports must be generated within 5 minutes of the latest data ingestion event.
    related_fr:
      - FR-0146
    measurement:
      - Time from last data ingestion to report generation must be ≤ 5 minutes.
      - Report generation latency must be logged and verified against SLA.

  - id: NFR-0150
    description: The calendar UI must load within 2 seconds of the scheduler opening the view.
    related_fr:
      - FR-0148
      - FR-0149
      - FR-0150
      - FR-0153
    measurement:
      - Metric: Average UI load time (milliseconds) < 2000 ms.
      - Verification: Automated UI load tests run on a standard broadband connection; results logged and reviewed weekly.

  - id: NFR-0151
    description: The initial data fetch from the scheduling API must complete within 1 second on a standard broadband connection.
    related_fr:
      - FR-0148
      - FR-0149
      - FR-0150
    measurement:
      - Metric: Average API response time < 1000 ms.
      - Verification: API performance monitoring (e.g., New Relic) with threshold alerts.

  - id: NFR-0152
    description: The calendar view must be able to render up to 5,000 appointments without rendering time exceeding 2 seconds.
    related_fr:
      - FR-0148
      - FR-0149
    measurement:
      - Metric: Render time for 5,000 appointments < 2000 ms.
      - Verification: Load‑testing tool (e.g., k6) simulating 5,000 appointments; performance metrics captured.

  - id: NFR-0153
    description: The calendar service must achieve 99.9% uptime over a 30‑day period.
    related_fr:
      - FR-0148
      - FR-0149
      - FR-0150
      - FR-0151
      - FR-0152
      - FR-0153
      - FR-0154
      - FR-0155
      - FR-0156
      - FR-0157
      - FR-0158
    measurement:
      - Metric: Availability % ≥ 99.9% (calculated as 1 – (downtime / total time)).
      - Verification: Uptime monitoring (e.g., Pingdom) with weekly reports.

  - id: NFR-0154
    description: The system must enforce role‑based access control, ensuring that only schedulers can view confidential patient details.
    related_fr:
      - FR-0156
      - FR-0157
    measurement:
      - Metric: No unauthorized access attempts logged; all API responses include role validation.
      - Verification: Security audit logs reviewed monthly; penetration testing results.

  - id: NFR-0155
    description: The calendar UI must comply with WCAG 2.1 AA accessibility guidelines.
    related_fr:
      - FR-0155
      - FR-0157
    measurement:
      - Metric: Pass rate of automated accessibility tests ≥ 95% (axe-core, Lighthouse).
      - Verification: Quarterly accessibility audit and manual screen‑reader testing.

  - id: NFR-0156
    description: Conflict indicators must be intuitive, with tooltips explaining the conflict reason.
    related_fr:
      - FR-0149
      - FR-0153
    measurement:
      - Metric: User satisfaction score on conflict indicator usability ≥ 4.5/5 in bi‑annual survey.
      - Verification: User testing sessions with heat‑map analysis of tooltip interactions.

  - id: NFR-0157
    description: Client‑side caching of appointment data must be valid for 30 seconds and invalidate thereafter.
    related_fr:
      - FR-0154
    measurement:
      - Metric: Cache hit ratio ≥ 90% during peak usage; cache expiry correctly enforced.
      - Verification: Instrumented client logs and automated test cases verifying timestamp logic.

  - id: NFR-0158
    description: In the event of an API failure, the calendar view must display a graceful fallback message without crashing.
    related_fr:
      - FR-0148
      - FR-0149
    measurement:
      - Metric: No JavaScript errors logged; fallback message displayed within 1 second of API failure.
      - Verification: Failure simulation tests and error‑monitoring dashboards.

  - id: NFR-0159
    description: All appointment times displayed in the calendar must reflect the scheduler’s local time zone.
    related_fr:
      - FR-0148
      - FR-0157
    measurement:
      - Metric: Time zone conversion accuracy verified against UTC timestamps for 100 random appointments.
      - Verification: Automated unit tests comparing displayed times to expected local times.

  - id: NFR-0160
    description: Filter response time must be less than 2 seconds from the user initiating the filter action to the schedule view being fully rendered.
    related_fr:
      - FR-0161
    measurement:
      - Response time measured by end‑to‑end performance testing (API latency + UI rendering) must be < 2000 ms on a typical 3G network.
      - Verification: Use automated performance tests with simulated 3G conditions and record median latency for 100 filter operations.

  - id: NFR-0161
    description: The filter feature must be used in at least 90% of schedule view sessions to demonstrate adoption.
    related_fr:
      - FR-0161
    measurement:
      - Analytics event “filter_applied” must be logged in ≥ 90% of schedule view sessions over a 30‑day period.
      - Verification: Review analytics dashboards and calculate the ratio of sessions with at least one filter action.

  - id: NFR-0162
    description: The filter controls must comply with WCAG 2.1 AA accessibility guidelines.
    related_fr:
      - FR-0159
      - FR-0160
      - FR-0163
    measurement:
      - All interactive elements must have keyboard focus, visible focus indicators, and ARIA labels.
      - Verification: Conduct automated accessibility scans and manual keyboard navigation tests; no violations of AA level.

  - id: NFR-0163
    description: The filter API endpoint must support filtering on up to 200,000 appointments without exceeding 1.5 seconds latency.
    related_fr:
      - FR-0161
    measurement:
      - Load testing with 200k appointment records must show average API latency ≤ 1500 ms.
      - Verification: Execute performance test scripts against the staging environment and record latency statistics.

  - id: NFR-0164
    description: Only authenticated scheduler users with the appropriate role may access the filter endpoint; provider data should be masked for users without full privileges.
    related_fr:
      - FR-0161
    measurement:
      - Authentication middleware must enforce role checks; unauthorized requests return 403.
      - Verification: Penetration testing and role‑based access control validation.

  - id: NFR-0165
    description: |
      The drag‑and‑drop user interface must respond to user actions within 200 ms
      to provide a seamless experience.
    related_fr:
      - FR-0164
      - FR-0166
    measurement:
      - UI response time < 200 ms measured via front‑end performance profiling.
      - Verify by automated UI tests simulating drag actions and measuring latency.

  - id: NFR-0166
    description: |
      The backend commit of a reschedule must complete within 2 seconds
      from drop to database persistence and notification dispatch.
    related_fr:
      - FR-0165
      - FR-0167
      - FR-0169
    measurement:
      - Backend latency < 2 s measured with API instrumentation.
      - Verify by load testing with 500 concurrent drags and asserting commit time.

  - id: NFR-0167
    description: |
      The scheduling module, including the drag‑and‑drop feature, must maintain
      99.95 % uptime during business hours.
    related_fr:
      - FR-0164
      - FR-0165
      - FR-0166
      - FR-0167
      - FR-0168
      - FR-0169
    measurement:
      - Uptime calculated from monitoring metrics over a 30‑day period.
      - Verify via SLA monitoring and incident logs.

  - id: NFR-0168
    description: |
      The drag‑and‑drop interface must comply with WCAG 2.1 AA accessibility
      standards, ensuring keyboard navigation and screen‑reader support.
    related_fr:
      - FR-0164
      - FR-0166
    measurement:
      - Accessibility audit score ≥ 95 % using automated tools (e.g., axe).
      - Manual verification of keyboard focus order and ARIA labels.

  - id: NFR-0169
    description: |
      Audit logs of reschedule actions must be tamper‑evident and immutable
      for regulatory compliance.
    related_fr:
      - FR-0168
    measurement:
      - Log integrity verified by cryptographic hash chaining.
      - Confirmed through periodic audit scripts that detect altered entries.

  - id: NFR-0170
    description: |
      The system must support at least 500 concurrent drag interactions without
      exceeding a 200 ms UI response time or a 2 s backend commit time.
    related_fr:
      - FR-0164
      - FR-0165
    measurement:
      - Load test simulation of 500 simultaneous drags with performance metrics.
      - Verify by monitoring resource utilization and response times under load.

  - id: NFR-0171
    description: |
      The cancellation operation must complete (UI response and audit log write) within 1 second 95th percentile under normal load.
    related_fr:
      - FR-0170
      - FR-0171
      - FR-0172
      - FR-0173
    measurement:
      - Response time measured from “Cancel” button click to confirmation dialog display < 1s for 95% of requests.
      - Performance tests conducted with 100 concurrent scheduler sessions; 95th percentile latency < 1s.

  - id: NFR-0172
    description: |
      The cancellation success rate must be at least 99.5% (error rate < 0.5%) during clinic operating hours.
    related_fr:
      - FR-0170
      - FR-0171
      - FR-0175
    measurement:
      - Log analysis over a 30‑day period; successful cancellations / total cancellation attempts ≥ 99.5%.
      - Automated alert triggers if error rate exceeds 0.5% for more than 5 minutes.

  - id: NFR-0173
    description: |
      Audit logs for cancellations must be immutable and write‑once, ensuring no post‑hoc edits are possible.
    related_fr:
      - FR-0172
    measurement:
      - Audit table uses database triggers or append‑only tables; attempts to modify existing records result in a 403 error.
      - Periodic integrity checks confirm no audit record has been altered after creation.

  - id: NFR-0174
    description: |
      Audit logs must be encrypted at rest and access to them must be controlled via role‑based ACLs, complying with HIPAA/GDPR requirements.
    related_fr:
      - FR-0172
    measurement:
      - Encryption verified through database configuration audit; logs are stored in an encrypted column or encrypted file system.
      - Access logs show that only users with “Audit Viewer” role can read logs; all other roles receive a 403.

  - id: NFR-0175
    description: |
      The cancellation interface must meet WCAG 2.1 AA accessibility standards and provide a labeled mandatory reason field with a dropdown of predefined suggestions.
    related_fr:
      - FR-0171
    measurement:
      - Automated accessibility scan (e.g., axe) reports no AA violations on the cancellation page.
      - Dropdown list contains at least 10 predefined reasons; the field is labeled with * indicating mandatory.

  - id: NFR-0176
    description: |
      The system must complete the forced scheduling action—including UI confirmation, reason capture, appointment creation, and audit log writing—within 2 seconds of the scheduler’s final confirmation.
    related_fr:
      - FR-0176
      - FR-0177
      - FR-0179
    measurement:
      - Response time measured from “Confirm” click to appointment confirmation screen; target < 2.0 s.
      - Verification via automated performance tests simulating 100 concurrent forced schedules.

  - id: NFR-0177
    description: |
      Audit trail completeness for forced appointments must be 100 %—every forced appointment must have a corresponding audit log entry.
    related_fr:
      - FR-0179
    measurement:
      - Percentage of forced appointments with audit logs; target 100 %.
      - Verification through scheduled audit report comparing appointment table to audit log.

  - id: NFR-0178
    description: |
      The scheduling service must maintain 99.9 % uptime during business hours, ensuring forced scheduling is available at all times.
    related_fr:
      - FR-0176
      - FR-0177
      - FR-0179
    measurement:
      - Uptime measured by external monitoring over a 30‑day period; target 99.9 %.
      - Verification via uptime dashboards and incident logs.

  - id: NFR-0179
    description: |
      The forced scheduling UI—including confirmation dialog and reason entry—must meet WCAG 2.1 AA accessibility standards.
    related_fr:
      - FR-0177
    measurement:
      - Accessibility audit score ≥ 95 % with no critical violations.
      - Verification through automated WCAG testing tools (e.g., axe) and manual screen‑reader test.

  - id: NFR-0180
    description: |
      The audit logs for forced appointments must be immutable and tamper‑proof, stored in a write‑once, append‑only data store.
    related_fr:
      - FR-0179
    measurement:
      - Attempt to modify an audit log entry results in a permission error; target 0 % modification success.
      - Verification through security penetration tests and log integrity checks.

  - id: NFR-0181
    description: |
      The system must handle peak loads of up to 1,000 forced scheduling requests per hour without performance degradation beyond the 2‑second response time target.
    related_fr:
      - FR-0176
      - FR-0179
    measurement:
      - Load test simulating 1,000 forced schedules per hour; average response time remains < 2 s.
      - Verification via stress‑testing framework and monitoring metrics.

  - id: NFR-0182
    description: The dashboard must load and render completely within 2 seconds for 95% of requests under normal load conditions.
    related_fr:
      - FR-0181
      - FR-0182
      - FR-0183
      - FR-0184
      - FR-0185
      - FR-0186
      - FR-0187
    measurement:
      - Load time measured at the browser’s navigation timing API, target < 2000 ms for 95th percentile.
      - Verification by automated performance tests run against production‑like environment.

  - id: NFR-0183
    description: Availability data accuracy must be ≥ 98% compared to source system logs over a rolling 24‑hour period.
    related_fr:
      - FR-0181
      - FR-0184
    measurement:
      - Accuracy calculated as (correct slots / total slots) × 100; target ≥ 98%.
      - Verification by nightly reconciliation script comparing dashboard data to source logs.

  - id: NFR-0184
    description: The system must support up to 100 concurrent Scheduler users without degradation of load time or responsiveness.
    related_fr:
      - FR-0181
      - FR-0182
      - FR-0183
      - FR-0185
    measurement:
      - Stress test with 100 virtual users; all load times ≤ 2s and error rate < 0.1%.
      - Verification via load testing framework (e.g., JMeter or Locust).

  - id: NFR-0185
    description: The dashboard service must achieve 99.9% uptime, with a maximum mean time to recovery (MTTR) of 30 minutes for any outage.
    related_fr:
      - FR-0181
      - FR-0182
      - FR-0183
      - FR-0184
      - FR-0185
      - FR-0186
      - FR-0187
    measurement:
      - Uptime monitored by external APM; target ≥ 99.9% over a 30‑day period.
      - MTTR measured from incident detection to full service restoration; target ≤ 30 minutes.
      - Verification through incident logs and uptime reports.

  - id: NFR-0186
    description: All data transmitted between client and server must be encrypted using TLS 1.2 or higher, and all stored data must be encrypted at rest with AES‑256.
    related_fr:
      - FR-0181
      - FR-0182
      - FR-0183
      - FR-0184
      - FR-0185
      - FR-0186
      - FR-0187
    measurement:
      - TLS configuration verified by SSL Labs test; target score A.
      - Rest encryption verified via database audit logs and key management system.
      - Verification by security audit and penetration testing.

  - id: NFR-0187
    description: The dashboard must comply with WCAG 2.1 Level AA accessibility standards.
    related_fr:
      - FR-0181
      - FR-0183
      - FR-0187
    measurement:
      - Automated accessibility scan (e.g., axe-core) must report no AA violations.
      - Manual review of keyboard navigation and screen reader support.
      - Verification through accessibility testing report.

  - id: NFR-0188
    description: The API endpoints used by the dashboard must be versioned and any new filtering functionality must result in less than 50 lines of code change in the API layer.
    related_fr:
      - FR-0183
    measurement:
      - Code review metrics: lines added/modified in API files per new filter feature.
      - Verification via version control diff analysis.

  - id: NFR-0189
    description: The “Last refreshed” timestamp displayed on the dashboard must reflect the most recent successful data refresh within a 15‑minute window.
    related_fr:
      - FR-0184
    measurement:
      - Timestamp accuracy verified by comparing displayed time to system refresh log timestamps.
      - Verification through automated regression tests.

  - id: NFR-0190
    description: Role‑based authentication must be implemented using SAML/OIDC, with session tokens expiring after 30 minutes of inactivity.
    related_fr:
      - FR-0186
    measurement:
      - Authentication flow tested against identity provider; session timeout verified via client-side timer.
      - Verification by security testing and audit logs.

  - id: NFR-0191
    description: The system must provide audit logging for all dashboard accesses, including user ID, timestamp, and action performed, with logs retained for 90 days.
    related_fr:
      - FR-0181
      - FR-0182
      - FR-0183
      - FR-0184
      - FR-0185
      - FR-0186
      - FR-0187
    measurement:
      - Log entries verified to contain required fields and be stored in immutable audit store.
      - Verification via automated log integrity tests and compliance audit.

  - id: NFR-0192
    description: >
      Report generation must complete in less than 1 minute under
      normal operating conditions.
    related_fr:
      - FR-0189
    measurement:
      - Average generation time measured over 100 runs on the staging
        environment must be < 60 seconds.
      - Verification via automated performance test logs.

  - id: NFR-0193
    description: >
      Report data must be 100 % accurate compared to the source analytics
      data store.
    related_fr:
      - FR-0189
    measurement:
      - Data validation script compares report outputs to source data
        for a sample set; zero mismatches are required.
      - Verification through round‑trip validation tests.

  - id: NFR-0194
    description: >
      Role‑based access control (RBAC) must restrict report features
      to users with the “Clinic Manager” role only.
    related_fr:
      - FR-0189
      - FR-0190
      - FR-0191
      - FR-0192
      - FR-0193
      - FR-0194
    measurement:
      - Security tests attempt to access report endpoints with
        non‑manager roles; responses must be 403 Forbidden.
      - Audit log entries must record any unauthorized access attempts.

  - id: NFR-0195
    description: >
      System availability must be 99.9 % during business hours (8 AM–6 PM
      local time).
    related_fr:
      - FR-0189
      - FR-0190
      - FR-0191
      - FR-0192
      - FR-0193
      - FR-0194
    measurement:
      - Uptime monitoring over a 30‑day period shows < 0.1 % downtime.
      - Verification via uptime monitoring dashboards.

  - id: NFR-0196
    description: >
      The export dialog must require no more than three clicks from
      report generation to file download.
    related_fr:
      - FR-0191
    measurement:
      - Usability test with 10 managers counts clicks; average ≤ 3.
      - Verification through recorded click streams.

  - id: NFR-0197
    description: >
      The system must support 20 concurrent report generation requests
      without exceeding 2 seconds latency for UI rendering.
    related_fr:
      - FR-0189
    measurement:
      - Load test simulating 20 parallel users; UI response time must
        remain ≤ 2 s.
      - Verification via load test reports.

  - id: NFR-0198
    description: >
      Audit logs must be retained for a minimum of 365 days.
    related_fr:
      - FR-0194
    measurement:
      - Log retention policy audit shows all entries older than 365 days
        are archived and accessible.
      - Verification via log management system reports.

  - id: NFR-0199
    description: >
      All sensitive data must be encrypted at rest and transmitted
      over TLS 1.2+.
    related_fr:
      - FR-0189
      - FR-0190
      - FR-0191
      - FR-0192
      - FR-0193
      - FR-0194
    measurement:
      - Encryption scan confirms AES‑256 encryption at rest.
      - Network traffic analysis confirms TLS 1.2+ handshake.
      - Verification through security audit reports.

  - id: NFR-0200
    description: >
      The system shall return user‑friendly error messages within
      2 seconds of encountering an error.
    related_fr:
      - FR-0189
      - FR-0190
      - FR-0191
      - FR-0192
      - FR-0193
      - FR-0194
    measurement:
      - Automated error handling tests measure response time ≤ 2 s.
      - Verification through test logs and user feedback surveys.

  - id: NFR-0201
    description: "Export success rate must be at least 99 % (max 1 % failure rate)."
    related_fr:
      - FR-0198
      - FR-0199
    measurement:
      - "Metric: Export success rate calculated over the last 30 days."
      - "Verification: Automated monitoring reports a success rate of ≥ 99 %; alerts are raised if below threshold."

  - id: NFR-0202
    description: "Exported file size must be less than 5 MB for all supported report types."
    related_fr:
      - FR-0198
    measurement:
      - "Metric: File size in megabytes."
      - "Verification: File size is validated during generation; if > 5 MB, the export is aborted."

  - id: NFR-0203
    description: "Export operation must complete within 10 seconds on a 1 Gbps network for average‑size reports."
    related_fr:
      - FR-0198
    measurement:
      - "Metric: End‑to‑end export duration in seconds."
      - "Verification: Performance testing shows ≤ 10 s for reports up to 1 MB on a 1 Gbps link."

  - id: NFR-0204
    description: "System must support concurrent exports for up to 20 users without performance degradation."
    related_fr:
      - FR-0198
    measurement:
      - "Metric: Number of concurrent export processes and average completion time."
      - "Verification: Load testing with 20 simultaneous exports shows completion time remains within NFR‑0203 limits."

  - id: NFR-0205
    description: "Export files are generated in a secure sandbox and are accessible only to the requesting user until download completes."
    related_fr:
      - FR-0198
    measurement:
      - "Metric: Access control audit logs."
      - "Verification: Security scans confirm sandbox isolation; unauthorized access attempts are blocked."

  - id: NFR-0206
    description: "Export process complies with HIPAA (or applicable data privacy regulations) when protected health information is included."
    related_fr:
      - FR-0198
    measurement:
      - "Metric: Compliance audit results."
      - "Verification: External compliance review confirms that PHI is handled per HIPAA requirements."

  - id: NFR-0207
    description: "UI response time for export initiation must be less than 2 seconds."
    related_fr:
      - FR-0195
    measurement:
      - "Metric: Time from clicking 'Export' to opening the export dialog."
      - "Verification: End‑to‑end performance testing shows ≤ 2 s latency."

  - id: NFR-0208
    description: "Audit trail records for export actions must be retained for at least 365 days."
    related_fr:
      - FR-0200
    measurement:
      - "Metric: Log retention period."
      - "Verification: Log management policy enforces a 365‑day retention; automated tests confirm deletion after period."

  - id: NFR-0209
    description: The alert detection component must complete conflict detection and alert trigger generation within 5 minutes of a conflict occurrence.
    related_fr:
      - FR-0201
    measurement:
      - Latency between conflict occurrence and alert trigger ≤ 5 minutes.
      - Verification via end‑to‑end performance tests simulating conflict events.

  - id: NFR-0210
    description: The alerting component must achieve 99.9% uptime, ensuring alerts are not lost during scheduled maintenance or failures.
    related_fr:
      - FR-0201
      - FR-0203
    measurement:
      - Availability measured over a 30‑day period ≥ 99.9%.
      - Verification through monitoring dashboards and uptime reports.

  - id: NFR-0211
    description: All alert data must be encrypted in transit using TLS 1.2+ and at rest using AES‑256 encryption; access is controlled via role‑based permissions.
    related_fr:
      - FR-0203
      - FR-0204
    measurement:
      - TLS certificate validation passes in automated security scans.
      - Encryption key rotation policy verified quarterly.
      - Role‑based access logs confirm no unauthorized access attempts.

  - id: NFR-0212
    description: The system must scale to support at least 5× the projected peak scheduler load without performance degradation.
    related_fr:
      - FR-0201
      - FR-0203
      - FR-0206
    measurement:
      - Under simulated peak load (e.g., 10,000 concurrent appointments), latency remains ≤ 5 minutes and UI response ≤ 2 seconds.
      - Verification via load testing tools (e.g., JMeter, k6).

  - id: NFR-0213
    description: The alert dashboard UI must comply with WCAG 2.1 AA accessibility standards.
    related_fr:
      - FR-0206
    measurement:
      - Automated accessibility tests (e.g., axe-core) score ≥ 90/100.
      - Manual screen‑reader testing confirms all alerts are announced.

  - id: NFR-0214
    description: All APIs and data contracts must be versioned and fully documented to support maintainability.
    related_fr:
      - FR-0202
      - FR-0203
      - FR-0205
      - FR-0208
    measurement:
      - API documentation available in OpenAPI spec for each version.
      - Versioning follows semantic versioning (MAJOR.MINOR.PATCH).

  - id: NFR-0215
    description: The notification delivery system must achieve a 95% success rate for alerts delivered within 2 minutes of trigger.
    related_fr:
      - FR-0203
    measurement:
      - Delivery success rate tracked by monitoring dashboards; ≥ 95% over rolling 7‑day period.
      - Delivery latency measured; 95th percentile ≤ 2 minutes.

  - id: NFR-0216
    description: Alert logs must be retained for 365 days and be queryable for audit purposes.
    related_fr:
      - FR-0205
    measurement:
      - Log retention policy verified by audit logs.
      - Query performance for 1‑year retention dataset ≤ 2 seconds for standard queries.

  - id: NFR-217
    description: The audit trail must be 100% complete; no manual change should be lost from the audit log.
    related_fr:
      - FR-209
      - FR-213
    measurement:
      - Target: 100% audit log persistence rate.
      - Verification: Automated integration tests that perform a series of manual changes and verify corresponding log entries exist before transaction commit.

  - id: NFR-218
    description: Retrieval of audit log entries must complete in less than 2 seconds for up to 10,000 entries per page.
    related_fr:
      - FR-211
    measurement:
      - Target: Query latency < 2s for 10k rows.
      - Verification: Load testing with 10k records and measuring average response time; performance monitoring dashboards.

  - id: NFR-219
    description: Audit logs must be immutable and tamper‑evident; write access is restricted to privileged roles; read access requires authentication and authorization.
    related_fr:
      - FR-210
      - FR-211
    measurement:
      - Target: No successful unauthorized write or delete attempts; hash chain integrity checks pass 100% of the time.
      - Verification: Penetration testing, role‑based access control tests, and hash‑chain validation scripts.

  - id: NFR-220
    description: The logging system must scale to handle at least 1,000,000 log entries per day with linear storage growth and no performance degradation.
    related_fr:
      - FR-209
      - FR-210
    measurement:
      - Target: Storage growth rate ≤ 1.1× theoretical linear growth; query latency remains within NFR-218 limits at 1M logs/day.
      - Verification: Capacity planning simulations and performance benchmarking under high write load.

  - id: NFR-221
    description: The system must provide tamper‑evident logs using hash chaining or write‑once storage to satisfy regulatory compliance.
    related_fr:
      - FR-210
    measurement:
      - Target: Hash chain verification passes 100% of audit checks; no tampering detected.
      - Verification: Periodic integrity audits and automated hash‑chain validation tools.

  - id: NFR-0222
    description: >
      The system must achieve a sync latency of less than 5 minutes for 99% of
      events, ensuring timely data consistency.
    related_fr:
      - FR-0215
      - FR-0216
      - FR-0217
    measurement:
      - Metric: Sync latency percentage (events completed <5 min)
        Target: ≥ 99%
      - Verification: Continuous monitoring of sync timestamps in the audit log.

  - id: NFR-0223
    description: >
      The integration service and its endpoints must maintain 99.9% uptime
      over a 30‑day period.
    related_fr:
      - FR-0215
      - FR-0216
      - FR-0217
      - FR-0218
      - FR-0219
      - FR-0220
      - FR-0221
      - FR-0222
      - FR-0223
    measurement:
      - Metric: Service availability (uptime)
        Target: 99.9%
      - Verification: Uptime monitoring dashboards and incident logs.

  - id: NFR-0224
    description: >
      The system must comply with HIPAA regulations, ensuring encryption at
      rest and in transit, and role‑based access control for all data
      operations.
    related_fr:
      - FR-0215
      - FR-0216
      - FR-0217
      - FR-0218
      - FR-0219
      - FR-0220
      - FR-0221
      - FR-0222
      - FR-0223
    measurement:
      - Metric: Encryption status
        Target: TLS 1.2+ for all network traffic; AES‑256 for stored data
      - Verification: Security audit reports and penetration test results.

  - id: NFR-0225
    description: >
      The system must scale to handle a tenfold increase in patient load
      without exceeding the 5‑minute sync latency threshold.
    related_fr:
      - FR-0215
      - FR-0216
      - FR-0217
    measurement:
      - Metric: Latency under 10× load
        Target: < 5 minutes
      - Verification: Load testing results simulating 10× current volume.

  - id: NFR-0226
    description: >
      The system must be maintainable, with a modular architecture and
      at least 80% automated test coverage for core integration logic.
    related_fr:
      - FR-0215
      - FR-0216
      - FR-0217
      - FR-0218
      - FR-0219
      - FR-0220
      - FR-0221
      - FR-0222
      - FR-0223
    measurement:
      - Metric: Code coverage
        Target: ≥ 80% for integration modules
      - Verification: CI pipeline test reports.

  - id: NFR-0227
    description: >
      The administrative UI must respond within 2 seconds for all user
      interactions and provide clear, actionable error messages for common
      configuration issues.
    related_fr:
      - FR-0222
    measurement:
      - Metric: UI response time
        Target: ≤ 2 seconds
      - Metric: Error message clarity
        Target: ≥ 90% of error messages meet usability guidelines
      - Verification: Performance testing and user acceptance testing.

  - id: NFR-0230
    description: The Role Management UI must load and render within 2 seconds for 95% of users under typical load conditions.
    related_fr:
      - FR-0224
      - FR-0225
      - FR-0226
    measurement:
      - Average load time measured via automated browser performance tests, target <= 2,000 ms.
      - Verify by running 100 concurrent sessions and ensuring 95% meet the threshold.

  - id: NFR-0231
    description: Permission changes must propagate to all affected staff users within 1 hour of the change being made.
    related_fr:
      - FR-0227
    measurement:
      - Time between change timestamp and propagation timestamp logged for each user, target <= 60 minutes.
      - Verify by creating a test role change and monitoring propagation logs for all affected users.

  - id: NFR-0232
    description: The audit trail for permission changes must be tamper‑proof and stored in immutable storage.
    related_fr:
      - FR-0228
    measurement:
      - Audit logs stored in an append‑only, cryptographically signed storage system.
      - Verify by attempting to modify a log entry and confirming the system detects and records the tamper attempt.

  - id: NFR-0233
    description: Unauthorized access attempts must constitute less than 1% of total access attempts.
    related_fr:
      - FR-0229
    measurement:
      - Monthly audit report calculates unauthorized_attempts / total_attempts < 0.01.
      - Verify by simulating 10,000 access attempts with 100 unauthorized attempts and confirming the metric.

  - id: NFR-0234
    description: The permission service must achieve 99.9% uptime over a 30‑day period.
    related_fr:
      - FR-0224
      - FR-0225
      - FR-0226
      - FR-0227
      - FR-0228
      - FR-0229
    measurement:
      - Uptime measured by monitoring system availability, target >= 99.9%.
      - Verify via automated uptime monitoring over a 30‑day period and reporting the availability percentage.

  - id: NFR-0233
    description: Page load times for module content must be under 2 seconds on a 3G network and under 1 second on Wi‑Fi.
    related_fr:
      - FR-0231
      - FR-0237
    measurement:
      - Page load time measured via browser dev tools and network simulation must be ≤ 2000 ms on 3G.
      - Page load time measured on real Wi‑Fi connection must be ≤ 1000 ms.
      - Verification: automated performance tests run nightly against the staging environment.

  - id: NFR-0234
    description: Quiz rendering and submission response time must be less than 500 milliseconds.
    related_fr:
      - FR-0233
    measurement:
      - Response time measured from quiz start to first question display ≤ 500 ms.
      - Response time measured from answer submission to feedback display ≤ 500 ms.
      - Verification: load‑testing tool asserts latency thresholds.

  - id: NFR-0235
    description: The LMS content service must achieve 99.9 % uptime over a 30‑day period.
    related_fr:
      - FR-0231
      - FR-0236
    measurement:
      - Uptime calculated as (total seconds available – downtime) / total seconds available.
      - Target uptime: ≥ 99.9 % (≤ 43.2 minutes of downtime per month).
      - Verification: monitoring system (e.g., Prometheus + Alertmanager) reports uptime metrics.

  - id: NFR-0236
    description: The system must comply with WCAG 2.1 AA accessibility guidelines for all UI elements.
    related_fr:
      - FR-0231
      - FR-0233
      - FR-0237
    measurement:
      - All pages must pass automated accessibility scan (axe, Lighthouse) with no violations of level A or higher.
      - Manual screen‑reader test must confirm navigation and content readability.
      - Verification: quarterly accessibility audit reports.

  - id: NFR-0237
    description: The system must support at least two locales (English and Spanish) for all user‑facing text.
    related_fr:
      - FR-0231
      - FR-0237
    measurement:
      - Localization files contain translations for all UI strings in both locales.
      - Language selector on the UI must switch content instantly without page reload.
      - Verification: automated i18n test suite checks presence of both locales and correct rendering.

  - id: NFR-0238
    description: The API endpoint for analytics must handle up to 1,000 concurrent requests without performance degradation.
    related_fr:
      - FR-0236
    measurement:
      - API response time remains ≤ 300 ms under 1,000 concurrent connections.
      - Throughput must be ≥ 1,000 requests per second during peak load.
      - Verification: stress‑testing tool (e.g., k6) simulates concurrent load and records metrics.















